
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>evennia.contrib.tutorials.evadventure.commands &#8212; Evennia 1.0-dev documentation</title>
    <link rel="stylesheet" href="../../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../../" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <script src="../../../../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia 1.0-dev</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" accesskey="U">evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorials.evadventure.commands</a></li> 
      </ul>
        <div class="develop">develop branch</div>
    </div>  

    <div class="document">

      <div class="documentwrapper">
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/evennia_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com">Home page</a> </li>
  <li><a href="https://github.com/evennia/evennia">Evennia Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Blog</a>
  </li>
</ul>
<h3>Versions</h3>
<ul>
  <li><a href="commands.html">1.0-dev (develop branch)</a></li>
 <ul>
  <li><a href="../0.9.5/index.html">0.9.5 (v0.9.5 branch)</a></li>

</ul>

        </div>
      </div>
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evennia.contrib.tutorials.evadventure.commands</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">EvAdventure commands and cmdsets. We don&#39;t need that many stand-alone new</span>
<span class="sd">commands since a lot of functionality is managed in menus. These commands</span>
<span class="sd">are in additional to normal Evennia commands and should be added</span>
<span class="sd">to the CharacterCmdSet</span>

<span class="sd">New commands:</span>
<span class="sd">    attack/hit &lt;target&gt;[,...]</span>
<span class="sd">    inventory</span>
<span class="sd">    wield/wear &lt;item&gt;</span>
<span class="sd">    unwield/remove &lt;item&gt;</span>
<span class="sd">    give &lt;item or coin&gt; to &lt;character&gt;</span>
<span class="sd">    talk &lt;npc&gt;</span>

<span class="sd">To install, add the `EvAdventureCmdSet` from this module to the default character cmdset:</span>

<span class="sd">```python</span>
<span class="sd">    # in mygame/commands/default_cmds.py</span>

<span class="sd">    from evennia.contrib.tutorials.evadventure.commands import EvAdventureCmdSet  # &lt;---</span>

<span class="sd">    # ...</span>

<span class="sd">    class CharacterCmdSet(CmdSet):</span>
<span class="sd">        def at_cmdset_creation(self):</span>
<span class="sd">            # ...</span>
<span class="sd">            self.add(EvAdventureCmdSet)   # &lt;-----</span>

<span class="sd">```</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">evennia</span> <span class="kn">import</span> <span class="n">CmdSet</span><span class="p">,</span> <span class="n">Command</span><span class="p">,</span> <span class="n">InterruptCommand</span>
<span class="kn">from</span> <span class="nn">evennia.utils.evmenu</span> <span class="kn">import</span> <span class="n">EvMenu</span>
<span class="kn">from</span> <span class="nn">evennia.utils.utils</span> <span class="kn">import</span> <span class="n">inherits_from</span>

<span class="kn">from</span> <span class="nn">.combat_turnbased</span> <span class="kn">import</span> <span class="n">CombatFailure</span><span class="p">,</span> <span class="n">join_combat</span>
<span class="kn">from</span> <span class="nn">.enums</span> <span class="kn">import</span> <span class="n">WieldLocation</span>
<span class="kn">from</span> <span class="nn">.equipment</span> <span class="kn">import</span> <span class="n">EquipmentError</span>
<span class="kn">from</span> <span class="nn">.npcs</span> <span class="kn">import</span> <span class="n">EvAdventureTalkativeNPC</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">get_obj_stats</span>


<div class="viewcode-block" id="EvAdventureCommand"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.EvAdventureCommand">[docs]</a><span class="k">class</span> <span class="nc">EvAdventureCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base EvAdventure command. This is on the form</span>

<span class="sd">        command &lt;args&gt;</span>

<span class="sd">    where whitespace around the argument(s) are stripped.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="EvAdventureCommand.parse"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.EvAdventureCommand.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="CmdAttackTurnBased"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdAttackTurnBased">[docs]</a><span class="k">class</span> <span class="nc">CmdAttackTurnBased</span><span class="p">(</span><span class="n">EvAdventureCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attack a target or join an existing combat.</span>

<span class="sd">    Usage:</span>
<span class="sd">      attack &lt;target&gt;</span>
<span class="sd">      attack &lt;target&gt;, &lt;target&gt;, ...</span>

<span class="sd">    If the target is involved in combat already, you&#39;ll join combat with</span>
<span class="sd">    the first target you specify. Attacking multiple will draw them all into</span>
<span class="sd">    combat.</span>

<span class="sd">    This will start/join turn-based, combat, where you have a limited</span>
<span class="sd">    time to decide on your next action from a menu of options.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;attack&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;hit&quot;</span><span class="p">,)</span>

<div class="viewcode-block" id="CmdAttackTurnBased.parse"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdAttackTurnBased.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span></div>

<div class="viewcode-block" id="CmdAttackTurnBased.func"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdAttackTurnBased.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># find if</span>

        <span class="n">target_objs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">targets</span><span class="p">:</span>
            <span class="n">target_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">target_obj</span><span class="p">:</span>
                <span class="c1"># show a warning but don&#39;t abort</span>
                <span class="k">continue</span>
            <span class="n">target_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target_obj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target_objs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">join_combat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">,</span> <span class="o">*</span><span class="n">target_objs</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">CombatFailure</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;|r</span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">|n&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;|rFound noone to attack.|n&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdInventory"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdInventory">[docs]</a><span class="k">class</span> <span class="nc">CmdInventory</span><span class="p">(</span><span class="n">EvAdventureCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    View your inventory</span>

<span class="sd">    Usage:</span>
<span class="sd">      inventory</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;inventory&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;inv&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CmdInventory.func"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdInventory.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loadout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">display_loadout</span><span class="p">()</span>
        <span class="n">backpack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">display_backpack</span><span class="p">()</span>
        <span class="n">slot_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">display_slot_usage</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">loadout</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">backpack</span><span class="si">}</span><span class="se">\n</span><span class="s2">You use </span><span class="si">{</span><span class="n">slot_usage</span><span class="si">}</span><span class="s2"> equipment slots.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdWieldOrWear"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdWieldOrWear">[docs]</a><span class="k">class</span> <span class="nc">CmdWieldOrWear</span><span class="p">(</span><span class="n">EvAdventureCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wield a weapon/shield, or wear a piece of armor or a helmet.</span>

<span class="sd">    Usage:</span>
<span class="sd">      wield &lt;item&gt;</span>
<span class="sd">      wear &lt;item&gt;</span>

<span class="sd">    The item will automatically end up in the suitable spot, replacing whatever</span>
<span class="sd">    was there previously.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;wield&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;wear&quot;</span><span class="p">,)</span>

    <span class="n">out_txts</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">WieldLocation</span><span class="o">.</span><span class="n">BACKPACK</span><span class="p">:</span> <span class="s2">&quot;You shuffle the position of </span><span class="si">{key}</span><span class="s2"> around in your backpack.&quot;</span><span class="p">,</span>
        <span class="n">WieldLocation</span><span class="o">.</span><span class="n">TWO_HANDS</span><span class="p">:</span> <span class="s2">&quot;You hold </span><span class="si">{key}</span><span class="s2"> with both hands.&quot;</span><span class="p">,</span>
        <span class="n">WieldLocation</span><span class="o">.</span><span class="n">WEAPON_HAND</span><span class="p">:</span> <span class="s2">&quot;You hold </span><span class="si">{key}</span><span class="s2"> in your strongest hand, ready for action.&quot;</span><span class="p">,</span>
        <span class="n">WieldLocation</span><span class="o">.</span><span class="n">SHIELD_HAND</span><span class="p">:</span> <span class="s2">&quot;You hold </span><span class="si">{key}</span><span class="s2"> in your off hand, ready to protect you.&quot;</span><span class="p">,</span>
        <span class="n">WieldLocation</span><span class="o">.</span><span class="n">BODY</span><span class="p">:</span> <span class="s2">&quot;You strap </span><span class="si">{key}</span><span class="s2"> on yourself.&quot;</span><span class="p">,</span>
        <span class="n">WieldLocation</span><span class="o">.</span><span class="n">HEAD</span><span class="p">:</span> <span class="s2">&quot;You put </span><span class="si">{key}</span><span class="s2"> on your head.&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="CmdWieldOrWear.func"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdWieldOrWear.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># find the item among those in equipment</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">candidates</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">only_objs</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
            <span class="c1"># An &#39;item not found&#39; error will already have been reported; we add another line</span>
            <span class="c1"># here for clarity.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You must carry the item you want to wield or wear.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">use_slot</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;inventory_use_slot&quot;</span><span class="p">,</span> <span class="n">WieldLocation</span><span class="o">.</span><span class="n">BACKPACK</span><span class="p">)</span>

        <span class="c1"># check what is currently in this slot</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">slots</span><span class="p">[</span><span class="n">use_slot</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">current</span> <span class="o">==</span> <span class="n">item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You are already using </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># move it to the right slot based on the type of object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># inform the user of the change (and potential swap)</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Returning </span><span class="si">{</span><span class="n">current</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> to the backpack.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_txts</span><span class="p">[</span><span class="n">use_slot</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="CmdRemove"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdRemove">[docs]</a><span class="k">class</span> <span class="nc">CmdRemove</span><span class="p">(</span><span class="n">EvAdventureCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove a remove a weapon/shield, armor or helmet.</span>

<span class="sd">    Usage:</span>
<span class="sd">      remove &lt;item&gt;</span>
<span class="sd">      unwield &lt;item&gt;</span>
<span class="sd">      unwear &lt;item&gt;</span>

<span class="sd">    To remove an item from the backpack, use |wdrop|n instead.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;remove&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;unwield&quot;</span><span class="p">,</span> <span class="s2">&quot;unwear&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="CmdRemove.func"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdRemove.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>

        <span class="c1"># find the item among those in equipment</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="n">candidates</span><span class="o">=</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">only_objs</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
            <span class="c1"># An &#39;item not found&#39; error will already have been reported</span>
            <span class="k">return</span>

        <span class="n">current_slot</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">get_current_slot</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">current_slot</span> <span class="ow">is</span> <span class="n">WieldLocation</span><span class="o">.</span><span class="n">BACKPACK</span><span class="p">:</span>
            <span class="c1"># we don&#39;t allow dropping this way since it may be unexepected by users who forgot just</span>
            <span class="c1"># where their item currently is.</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;You already stashed away </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> in your backpack. Use &#39;drop&#39; if &quot;</span>
                <span class="s2">&quot;you want to get rid of it.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You stash </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> in your backpack.&quot;</span><span class="p">)</span></div></div>


<span class="c1"># give / accept menu</span>


<span class="k">def</span> <span class="nf">_rescind_gift</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called when giver rescinds their gift in `node_give` below.</span>
<span class="sd">    It means they entered &#39;cancel&#39; on the gift screen.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># kill the gift menu for the receiver immediately</span>
    <span class="n">receiver</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;receiver&quot;</span><span class="p">]</span>
    <span class="n">receiver</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">_evmenu</span><span class="o">.</span><span class="n">close_menu</span><span class="p">()</span>
    <span class="n">receiver</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The offer was rescinded.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;node_end&quot;</span>


<div class="viewcode-block" id="node_give"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.node_give">[docs]</a><span class="k">def</span> <span class="nf">node_give</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This will show to the giver until receiver accepts/declines. It allows them</span>
<span class="sd">    to rescind their offer.</span>

<span class="sd">    The `caller` here is the one giving the item. We also make sure to feed</span>
<span class="sd">    the &#39;item&#39; and &#39;receiver&#39; into the Evmenu.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;item&quot;</span><span class="p">]</span>
    <span class="n">receiver</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;receiver&quot;</span><span class="p">]</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">You are offering </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">receiver</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">(</span><span class="n">looker</span><span class="o">=</span><span class="n">caller</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">|wWaiting for them to accept or reject the offer ...|n</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;cancel&quot;</span><span class="p">,</span> <span class="s2">&quot;abort&quot;</span><span class="p">),</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Rescind your offer.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;goto&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">_rescind_gift</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">options</span></div>


<span class="k">def</span> <span class="nf">_accept_or_reject_gift</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called when receiver enters yes/no in `node_receive` below. We first need to</span>
<span class="sd">    figure out which.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;item&quot;</span><span class="p">]</span>
    <span class="n">giver</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;giver&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">raw_string</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;yes&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">):</span>
        <span class="c1"># they accepted - move the item!</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">giver</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># this will also add them to the equipment backpack, if possible</span>
                <span class="n">item</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;give&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">EquipmentError</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;$You(</span><span class="si">{</span><span class="n">giver</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">) $conj(try) to give &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> to $You(</span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">), but they can&#39;t accept it since their &quot;</span>
                    <span class="s2">&quot;inventory is full.&quot;</span><span class="p">,</span>
                    <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="n">giver</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">giver</span><span class="p">,</span> <span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">caller</span><span class="p">},</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;$You(</span><span class="si">{</span><span class="n">giver</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">) $conj(give) </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2"> to $You(</span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">), &quot;</span>
                    <span class="s2">&quot;and they accepted the offer.&quot;</span><span class="p">,</span>
                    <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="n">giver</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">giver</span><span class="p">,</span> <span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">caller</span><span class="p">},</span>
                <span class="p">)</span>
        <span class="n">giver</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">_evmenu</span><span class="o">.</span><span class="n">close_menu</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;node_end&quot;</span>


<div class="viewcode-block" id="node_receive"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.node_receive">[docs]</a><span class="k">def</span> <span class="nf">node_receive</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Will show to the receiver and allow them to accept/decline the offer for</span>
<span class="sd">    as long as the giver didn&#39;t rescind it.</span>

<span class="sd">    The `caller` here is the one receiving the item. We also make sure to feed</span>
<span class="sd">    the &#39;item&#39; and &#39;giver&#39; into the EvMenu.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;item&quot;</span><span class="p">]</span>
    <span class="n">giver</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;giver&quot;</span><span class="p">]</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="si">{</span><span class="n">giver</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">()</span><span class="si">}</span><span class="s2"> is offering you </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">:</span>

<span class="si">{</span><span class="n">get_obj_stats</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="si">}</span><span class="s2"></span>

<span class="s2">[Your inventory usage: </span><span class="si">{</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">display_slot_usage</span><span class="p">()</span><span class="si">}</span><span class="s2">]</span>
<span class="s2">|wDo you want to accept the given item? Y/[N]</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;_default&quot;</span><span class="p">,</span> <span class="s2">&quot;goto&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">_accept_or_reject_gift</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)},)</span>
    <span class="k">return</span> <span class="n">text</span><span class="p">,</span> <span class="n">options</span></div>


<div class="viewcode-block" id="node_end"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.node_end">[docs]</a><span class="k">def</span> <span class="nf">node_end</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">raw_string</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="CmdGive"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdGive">[docs]</a><span class="k">class</span> <span class="nc">CmdGive</span><span class="p">(</span><span class="n">EvAdventureCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Give item or money to another person. Items need to be accepted before</span>
<span class="sd">    they change hands. Money changes hands immediately with no wait.</span>

<span class="sd">    Usage:</span>
<span class="sd">      give &lt;item&gt; to &lt;receiver&gt;</span>
<span class="sd">      give &lt;number of coins&gt; [coins] to receiver</span>

<span class="sd">    If item name includes &#39; to &#39;, surround it in quotes.</span>

<span class="sd">    Examples:</span>
<span class="sd">      give apple to ranger</span>
<span class="sd">      give &quot;road to happiness&quot; to sad ranger</span>
<span class="sd">      give 10 coins to ranger</span>
<span class="sd">      give 12 to ranger</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;give&quot;</span>

<div class="viewcode-block" id="CmdGive.parse"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdGive.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parsing is a little more complex for this command.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
        <span class="k">if</span> <span class="s2">&quot; to &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s2">&quot;Usage: give &lt;item&gt; to &lt;recevier&gt;. Specify e.g. &#39;10 coins&#39; to pay money. &quot;</span>
                <span class="s2">&quot;Use quotes around the item name it if includes the substring &#39; to &#39;. &quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">InterruptCommand</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coins</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># make sure we can use &#39;...&#39; to include items with &#39; to &#39; in the name</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">end_ind</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">item_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="n">end_ind</span><span class="p">]</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">receiver_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; to &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">end_ind</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">item_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="n">end_ind</span><span class="p">]</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">receiver_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; to &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item_name</span><span class="p">,</span> <span class="n">receiver_name</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; to &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># a coin count rather than a normal name</span>
        <span class="k">if</span> <span class="s2">&quot; coins&quot;</span> <span class="ow">in</span> <span class="n">item_name</span><span class="p">:</span>
            <span class="n">item_name</span> <span class="o">=</span> <span class="n">item_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">item_name</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coins</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">item_name</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">item_name</span> <span class="o">=</span> <span class="n">item_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">receiver_name</span> <span class="o">=</span> <span class="n">receiver_name</span></div>

<div class="viewcode-block" id="CmdGive.func"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdGive.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>

        <span class="n">receiver</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">receiver_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">receiver</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># giving of coins is always accepted</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coins</span><span class="p">:</span>
            <span class="n">current_coins</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">coins</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coins</span> <span class="o">&gt;</span> <span class="n">current_coins</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You only have |y</span><span class="si">{</span><span class="n">current_coins</span><span class="si">}</span><span class="s2">|n coins to give.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c1"># do transaction</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">coins</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coins</span>
            <span class="n">receiver</span><span class="o">.</span><span class="n">coins</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coins</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;$You() $conj(give) $You(</span><span class="si">{</span><span class="n">receiver</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">) </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">coins</span><span class="si">}</span><span class="s2"> coins.&quot;</span><span class="p">,</span>
                <span class="n">from_obj</span><span class="o">=</span><span class="n">caller</span><span class="p">,</span>
                <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="n">receiver</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> <span class="n">receiver</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># giving of items require acceptance before it happens</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_name</span><span class="p">,</span> <span class="n">candidates</span><span class="o">=</span><span class="n">caller</span><span class="o">.</span><span class="n">equipment</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">only_objs</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># testing hook</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">at_pre_give</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="n">receiver</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c1"># before we start menus, we must check so either part is not already in a menu,</span>
        <span class="c1"># that would be annoying otherwise</span>
        <span class="k">if</span> <span class="n">receiver</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">_evmenu</span><span class="p">:</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">receiver</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">(</span><span class="n">looker</span><span class="o">=</span><span class="n">caller</span><span class="p">)</span><span class="si">}</span><span class="s2"> seems busy talking to someone else.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">caller</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">_evmenu</span><span class="p">:</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Close the current menu first.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># this starts evmenus for both parties</span>
        <span class="n">EvMenu</span><span class="p">(</span>
            <span class="n">receiver</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;node_receive&quot;</span><span class="p">:</span> <span class="n">node_receive</span><span class="p">,</span> <span class="s2">&quot;node_end&quot;</span><span class="p">:</span> <span class="n">node_end</span><span class="p">},</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">giver</span><span class="o">=</span><span class="n">caller</span>
        <span class="p">)</span>
        <span class="n">EvMenu</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;node_give&quot;</span><span class="p">:</span> <span class="n">node_give</span><span class="p">,</span> <span class="s2">&quot;node_end&quot;</span><span class="p">:</span> <span class="n">node_end</span><span class="p">},</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="n">receiver</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdTalk"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdTalk">[docs]</a><span class="k">class</span> <span class="nc">CmdTalk</span><span class="p">(</span><span class="n">EvAdventureCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start a conversations with shop keepers and other NPCs in the world.</span>

<span class="sd">    Args:</span>
<span class="sd">      talk &lt;npc&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;talk&quot;</span>

<div class="viewcode-block" id="CmdTalk.func"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.CmdTalk.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">inherits_from</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">EvAdventureTalkativeNPC</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">(</span><span class="n">looker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">)</span><span class="si">}</span><span class="s2"> does not seem very talkative.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>
        <span class="n">target</span><span class="o">.</span><span class="n">at_talk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="EvAdventureCmdSet"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.EvAdventureCmdSet">[docs]</a><span class="k">class</span> <span class="nc">EvAdventureCmdSet</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Groups all commands in one cmdset which can be added in one go to the DefaultCharacter cmdset.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;evadventure&quot;</span>

<div class="viewcode-block" id="EvAdventureCmdSet.at_cmdset_creation"><a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.evadventure.commands.html#evennia.contrib.tutorials.evadventure.commands.EvAdventureCmdSet.at_cmdset_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdAttackTurnBased</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdInventory</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdWieldOrWear</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdRemove</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdGive</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdTalk</span><span class="p">())</span></div></div>
</pre></div>

          </div>
        </div>
      </div>

    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia 1.0-dev</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" >evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorials.evadventure.commands</a></li> 
      </ul>
        <div class="develop">develop branch</div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>