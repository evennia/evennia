<!DOCTYPE html>

<html lang="en" data-content_root="../../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>evennia.contrib.tutorials.tutorial_world.mob &#8212; Evennia latest documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/nature.css?v=279e0f84" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=e4a91a55" />
    <script src="../../../../../_static/documentation_options.js?v=c6e86fd7"></script>
    <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" accesskey="U">evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorials.tutorial_world.mob</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evennia.contrib.tutorials.tutorial_world.mob</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module implements a simple mobile object with</span>
<span class="sd">a very rudimentary AI as well as an aggressive enemy</span>
<span class="sd">object based on that mobile class.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">evennia</span><span class="w"> </span><span class="kn">import</span> <span class="n">TICKER_HANDLER</span><span class="p">,</span> <span class="n">CmdSet</span><span class="p">,</span> <span class="n">Command</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">search_object</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">objects</span> <span class="k">as</span> <span class="n">tut_objects</span>


<div class="viewcode-block" id="CmdMobOnOff">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.CmdMobOnOff">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdMobOnOff</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Activates/deactivates Mob</span>

<span class="sd">    Usage:</span>
<span class="sd">        mobon &lt;mob&gt;</span>
<span class="sd">        moboff &lt;mob&gt;</span>

<span class="sd">    This turns the mob from active (alive) mode</span>
<span class="sd">    to inactive (dead) mode. It is used during</span>
<span class="sd">    building to  activate the mob once it&#39;s</span>
<span class="sd">    prepared.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;mobon&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="s2">&quot;moboff&quot;</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:superuser()&quot;</span>

<div class="viewcode-block" id="CmdMobOnOff.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.CmdMobOnOff.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses the mob&#39;s set_alive/set_dead methods</span>
<span class="sd">        to turn on/off the mob.&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Usage: mobon||moboff &lt;mob&gt;&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">mob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">mob</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstring</span> <span class="o">==</span> <span class="s2">&quot;mobon&quot;</span><span class="p">:</span>
            <span class="n">mob</span><span class="o">.</span><span class="n">set_alive</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mob</span><span class="o">.</span><span class="n">set_dead</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="MobCmdSet">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.MobCmdSet">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MobCmdSet</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Holds the admin command controlling the mob</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MobCmdSet.at_cmdset_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.MobCmdSet.at_cmdset_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdMobOnOff</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="Mob">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Mob</span><span class="p">(</span><span class="n">tut_objects</span><span class="o">.</span><span class="n">TutorialObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a state-machine AI mobile. It has several states which are</span>
<span class="sd">    controlled from setting various Attributes. All default to True:</span>

<span class="sd">        patrolling: if set, the mob will move randomly</span>
<span class="sd">            from room to room, but preferring to not return</span>
<span class="sd">            the way it came. If unset, the mob will remain</span>
<span class="sd">            stationary (idling) until attacked.</span>
<span class="sd">        aggressive: if set, will attack Characters in</span>
<span class="sd">            the same room using whatever Weapon it</span>
<span class="sd">            carries (see tutorial_world.objects.TutorialWeapon).</span>
<span class="sd">            if unset, the mob will never engage in combat</span>
<span class="sd">            no matter what.</span>
<span class="sd">        hunting: if set, the mob will pursue enemies trying</span>
<span class="sd">            to flee from it, so it can enter combat. If unset,</span>
<span class="sd">            it will return to patrolling/idling if fled from.</span>
<span class="sd">        immortal: If set, the mob cannot take any damage.</span>
<span class="sd">        irregular_echoes: list of strings the mob generates at irregular intervals.</span>
<span class="sd">        desc_alive: the physical description while alive</span>
<span class="sd">        desc_dead: the physical descripion while dead</span>
<span class="sd">        send_defeated_to: unique key/alias for location to send defeated enemies to</span>
<span class="sd">        defeat_msg: message to echo to defeated opponent</span>
<span class="sd">        defeat_msg_room: message to echo to room. Accepts %s as the name of the defeated.</span>
<span class="sd">        hit_msg: message to echo when this mob is hit. Accepts %s for the mob&#39;s key.</span>
<span class="sd">        weapon_ineffective_msg: message to echo for useless attacks</span>
<span class="sd">        death_msg: message to echo to room when this mob dies.</span>
<span class="sd">        patrolling_pace: how many seconds per tick, when patrolling</span>
<span class="sd">        aggressive_pace:   -&quot;-         attacking</span>
<span class="sd">        hunting_pace:      -&quot;-         hunting</span>
<span class="sd">        death_pace:        -&quot;-         returning to life when dead</span>

<span class="sd">        field &#39;home&#39; - the home location should set to someplace inside</span>
<span class="sd">           the patrolling area. The mob will use this if it should</span>
<span class="sd">           happen to roam into a room with no exits.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Mob.at_init">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.at_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When initialized from cache (after a server reboot), set up</span>
<span class="sd">        the AI state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The AI state machine (not persistent).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_patrolling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">patrolling</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_dead</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_attacking</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_hunting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_immortal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">immortal</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_dead</span></div>


<div class="viewcode-block" id="Mob.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called the first time the object is created.</span>
<span class="sd">        We set up the base properties and flags here.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MobCmdSet</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Main AI flags. We start in dead mode so we don&#39;t have to</span>
        <span class="c1"># chase the mob around when building.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">patrolling</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">immortal</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># db-store if it is dead or not</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_dead</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># specifies how much damage we divide away from non-magic weapons</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">damage_resistance</span> <span class="o">=</span> <span class="mf">100.0</span>
        <span class="c1"># pace (number of seconds between ticks) for</span>
        <span class="c1"># the respective modes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">patrolling_pace</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive_pace</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hunting_pace</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">death_pace</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># stay dead for 100 seconds</span>

        <span class="c1"># we store the call to the tickerhandler</span>
        <span class="c1"># so we can easily deactivate the last</span>
        <span class="c1"># ticker subscription when we switch.</span>
        <span class="c1"># since we will use the same idstring</span>
        <span class="c1"># throughout we only need to save the</span>
        <span class="c1"># previous interval we used.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">last_ticker_interval</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># store two separate descriptions, one for alive and</span>
        <span class="c1"># one for dead (corpse)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc_alive</span> <span class="o">=</span> <span class="s2">&quot;This is a moving object.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc_dead</span> <span class="o">=</span> <span class="s2">&quot;A dead body.&quot;</span>

        <span class="c1"># health stats</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">full_health</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">=</span> <span class="mi">20</span>

        <span class="c1"># when this mob defeats someone, we move the character off to</span>
        <span class="c1"># some other place (Dark Cell in the tutorial).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">send_defeated_to</span> <span class="o">=</span> <span class="s2">&quot;dark cell&quot;</span>
        <span class="c1"># text to echo to the defeated foe.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">defeat_msg</span> <span class="o">=</span> <span class="s2">&quot;You fall to the ground.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">defeat_msg_room</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> falls to the ground.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">weapon_ineffective_msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Your weapon just passes through your enemy, causing almost no effect!&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">death_msg</span> <span class="o">=</span> <span class="s2">&quot;After the last hit </span><span class="si">%s</span><span class="s2"> evaporates.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hit_msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> wails, shudders and writhes.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">irregular_msgs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;the enemy looks about.&quot;</span><span class="p">,</span> <span class="s2">&quot;the enemy changes stance.&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="s2">&quot;This is an object with simple state AI, using a ticker to move.&quot;</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_ticker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">hook_key</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set how often the given hook key should</span>
<span class="sd">        be &quot;ticked&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            interval (int or None): The number of seconds</span>
<span class="sd">                between ticks</span>
<span class="sd">            hook_key (str or None): The name of the method</span>
<span class="sd">                (on this mob) to call every interval</span>
<span class="sd">                seconds.</span>
<span class="sd">            stop (bool, optional): Just stop the</span>
<span class="sd">                last ticker without starting a new one.</span>
<span class="sd">                With this set, the interval and hook_key</span>
<span class="sd">                arguments are unused.</span>

<span class="sd">        In order to only have one ticker</span>
<span class="sd">        running at a time, we make sure to store the</span>
<span class="sd">        previous ticker subscription so that we can</span>
<span class="sd">        easily find and stop it before setting a</span>
<span class="sd">        new one. The tickerhandler is persistent so</span>
<span class="sd">        we need to remember this across reloads.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">idstring</span> <span class="o">=</span> <span class="s2">&quot;tutorial_mob&quot;</span>  <span class="c1"># this doesn&#39;t change</span>
        <span class="n">last_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">last_ticker_interval</span>
        <span class="n">last_hook_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">last_hook_key</span>
        <span class="k">if</span> <span class="n">last_interval</span> <span class="ow">and</span> <span class="n">last_hook_key</span><span class="p">:</span>
            <span class="c1"># we have a previous subscription, kill this first.</span>
            <span class="n">TICKER_HANDLER</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span>
                <span class="n">interval</span><span class="o">=</span><span class="n">last_interval</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">last_hook_key</span><span class="p">),</span> <span class="n">idstring</span><span class="o">=</span><span class="n">idstring</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">last_ticker_interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">last_hook_key</span> <span class="o">=</span> <span class="n">hook_key</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stop</span><span class="p">:</span>
            <span class="c1"># set the new ticker</span>
            <span class="n">TICKER_HANDLER</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook_key</span><span class="p">),</span> <span class="n">idstring</span><span class="o">=</span><span class="n">idstring</span>
            <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_target</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scan the given location for suitable targets (this is defined</span>
<span class="sd">        as Characters) to attack.  Will ignore superusers.</span>

<span class="sd">        Args:</span>
<span class="sd">            location (Object): the room to scan.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The first suitable target found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">obj</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">contents_get</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">has_account</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">obj</span><span class="o">.</span><span class="n">is_superuser</span>
        <span class="p">]</span>
        <span class="k">return</span> <span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">targets</span> <span class="k">else</span> <span class="kc">None</span>

<div class="viewcode-block" id="Mob.set_alive">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.set_alive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_alive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mob to &quot;alive&quot; mode. This effectively</span>
<span class="sd">        resurrects it from the dead state.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">full_health</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_dead</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc_alive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_immortal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">immortal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_patrolling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">patrolling</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">patrolling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_patrolling</span><span class="p">()</span></div>


<div class="viewcode-block" id="Mob.set_dead">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.set_dead">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_dead</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mob to &quot;dead&quot; mode. This turns it off</span>
<span class="sd">        and makes sure it can take no more damage.</span>
<span class="sd">        It also starts a ticker for when it will return.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_dead</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_patrolling</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_attacking</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_hunting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_immortal</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># we shall return after some time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_ticker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">death_pace</span><span class="p">,</span> <span class="s2">&quot;set_alive&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.start_idle">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.start_idle">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_idle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Starts just standing around. This will kill</span>
<span class="sd">        the ticker and do nothing more.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_ticker</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.start_patrolling">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.start_patrolling">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_patrolling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the patrolling state by</span>
<span class="sd">        registering us with the ticker-handler</span>
<span class="sd">        at a leasurely pace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">patrolling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_idle</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_ticker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">patrolling_pace</span><span class="p">,</span> <span class="s2">&quot;do_patrol&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_patrolling</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_hunting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_attacking</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># for the tutorial, we also heal the mob in this mode</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">full_health</span></div>


<div class="viewcode-block" id="Mob.start_hunting">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.start_hunting">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_hunting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the hunting state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hunting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_patrolling</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_ticker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hunting_pace</span><span class="p">,</span> <span class="s2">&quot;do_hunt&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_patrolling</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_hunting</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_attacking</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="Mob.start_attacking">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.start_attacking">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_attacking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the attacking state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_hunting</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_ticker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive_pace</span><span class="p">,</span> <span class="s2">&quot;do_attack&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_patrolling</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_hunting</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_attacking</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Mob.do_patrol">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.do_patrol">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_patrol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called repeatedly during patrolling mode.  In this mode, the</span>
<span class="sd">        mob scans its surroundings and randomly chooses a viable exit.</span>
<span class="sd">        One should lock exits with the traverse:has_account() lock in</span>
<span class="sd">        order to block the mob from moving outside its area while</span>
<span class="sd">        allowing account-controlled characters to move normally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">irregular_msgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">irregular_msgs</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive</span><span class="p">:</span>
            <span class="c1"># first check if there are any targets in the room.</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_attacking</span><span class="p">()</span>
                <span class="k">return</span>
        <span class="c1"># no target found, look for an exit.</span>
        <span class="n">exits</span> <span class="o">=</span> <span class="p">[</span><span class="n">exi</span> <span class="k">for</span> <span class="n">exi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">exits</span> <span class="k">if</span> <span class="n">exi</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;traverse&quot;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">exits</span><span class="p">:</span>
            <span class="c1"># randomly pick an exit</span>
            <span class="n">exit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">exits</span><span class="p">)</span>
            <span class="c1"># move there.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">exit</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no exits! teleport to home to get away.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.do_hunting">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.do_hunting">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_hunting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called regularly when in hunting mode. In hunting mode the mob</span>
<span class="sd">        scans adjacent rooms for enemies and moves towards them to</span>
<span class="sd">        attack if possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">irregular_msgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">irregular_msgs</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive</span><span class="p">:</span>
            <span class="c1"># first check if there are any targets in the room.</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_attacking</span><span class="p">()</span>
                <span class="k">return</span>
        <span class="c1"># no targets found, scan surrounding rooms</span>
        <span class="n">exits</span> <span class="o">=</span> <span class="p">[</span><span class="n">exi</span> <span class="k">for</span> <span class="n">exi</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">exits</span> <span class="k">if</span> <span class="n">exi</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;traverse&quot;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">exits</span><span class="p">:</span>
            <span class="c1"># scan the exits destination for targets</span>
            <span class="k">for</span> <span class="n">exit</span> <span class="ow">in</span> <span class="n">exits</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_target</span><span class="p">(</span><span class="n">exit</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
                    <span class="c1"># a target found. Move there.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">exit</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="c1"># if we get to this point we lost our</span>
            <span class="c1"># prey. Resume patrolling.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_patrolling</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># no exits! teleport to home to get away.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mob.do_attack">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.do_attack">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">do_attack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called regularly when in attacking mode. In attacking mode</span>
<span class="sd">        the mob will bring its weapons to bear on any targets</span>
<span class="sd">        in the room.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">irregular_msgs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">irregular_msgs</span><span class="p">))</span>
        <span class="c1"># first make sure we have a target</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_target</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
            <span class="c1"># no target, start looking for one</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_hunting</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="c1"># we use the same attack commands as defined in</span>
        <span class="c1"># tutorial_world.objects.TutorialWeapon, assuming that</span>
        <span class="c1"># the mob is given a Weapon to attack with.</span>
        <span class="n">attack_cmd</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="s2">&quot;thrust&quot;</span><span class="p">,</span> <span class="s2">&quot;pierce&quot;</span><span class="p">,</span> <span class="s2">&quot;stab&quot;</span><span class="p">,</span> <span class="s2">&quot;slash&quot;</span><span class="p">,</span> <span class="s2">&quot;chop&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attack_cmd</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>

        <span class="c1"># analyze the current state</span>
        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># we reduced the target to &lt;= 0 health. Move them to the</span>
            <span class="c1"># defeated room</span>
            <span class="n">target</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">defeat_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">defeat_msg_room</span> <span class="o">%</span> <span class="n">target</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
            <span class="n">send_defeated_to</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">send_defeated_to</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">send_defeated_to</span><span class="p">:</span>
                <span class="n">target</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">send_defeated_to</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">log_err</span><span class="p">(</span>
                    <span class="s2">&quot;Mob: mob.db.send_defeated_to not found: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">send_defeated_to</span>
                <span class="p">)</span></div>


    <span class="c1"># response methods - called by other objects</span>

<div class="viewcode-block" id="Mob.at_hit">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.at_hit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_hit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weapon</span><span class="p">,</span> <span class="n">attacker</span><span class="p">,</span> <span class="n">damage</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Someone landed a hit on us. Check our status</span>
<span class="sd">        and start attacking if not already doing so.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># health not set - this can&#39;t be damaged.</span>
            <span class="n">attacker</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">weapon_ineffective_msg</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_immortal</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">weapon</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">magic</span><span class="p">:</span>
                <span class="c1"># not a magic weapon - divide away magic resistance</span>
                <span class="n">damage</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">damage_resistance</span>
                <span class="n">attacker</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">weapon_ineffective_msg</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hit_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">-=</span> <span class="n">damage</span>

        <span class="c1"># analyze the result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># we are dead!</span>
            <span class="n">attacker</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">death_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_dead</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># still alive, start attack if not already attacking</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_attacking</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_attacking</span><span class="p">()</span></div>


<div class="viewcode-block" id="Mob.at_new_arrival">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.mob.html#evennia.contrib.tutorials.tutorial_world.mob.Mob.at_new_arrival">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_new_arrival</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_character</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is triggered whenever a new character enters the room.</span>
<span class="sd">        This is called by the TutorialRoom the mob stands in and</span>
<span class="sd">        allows it to be aware of changes immediately without needing</span>
<span class="sd">        to poll for them all the time. For example, the mob can react</span>
<span class="sd">        right away, also when patrolling on a very slow ticker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># the room actually already checked all we need, so</span>
        <span class="c1"># we know it is a valid target.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">aggressive</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">is_attacking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_attacking</span><span class="p">()</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/evennia_logo.png" alt="Logo of Evennia"/>
            </a></p>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com/docs/latest/index.html">Documentation Top</a> </li>
  <li><a href="https://www.evennia.com">Evennia Home</a> </li>
  <li><a href="https://github.com/evennia/evennia">Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Blog</a>
  </li>
</ul>
<h3>Doc Versions</h3>
<ul>
  
    <li>
      <a href="https://www.evennia.com/docs/latest/index.html">latest (main branch)</a>
    </li>
  
  
    <li>
      <a href="https://www.evennia.com/docs/5.x/index.html">v5.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/4.x/index.html">v4.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/3.x/index.html">v3.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/2.x/index.html">v2.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/1.x/index.html">v1.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/0.x/index.html">v0.9.5 branch (outdated)</a>
    </li>
  
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" >evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorials.tutorial_world.mob</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>