<!DOCTYPE html>

<html lang="en" data-content_root="../../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>evennia.contrib.tutorials.tutorial_world.rooms &#8212; Evennia latest documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/nature.css?v=279e0f84" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=e4a91a55" />
    <script src="../../../../../_static/documentation_options.js?v=c6e86fd7"></script>
    <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" accesskey="U">evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorials.tutorial_world.rooms</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evennia.contrib.tutorials.tutorial_world.rooms</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Room Typeclasses for the TutorialWorld.</span>

<span class="sd">This defines special types of Rooms available in the tutorial. To keep</span>
<span class="sd">everything in one place we define them together with the custom</span>
<span class="sd">commands needed to control them. Those commands could also have been</span>
<span class="sd">in a separate module (e.g. if they could have been re-used elsewhere.)</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="c1"># the system error-handling module is defined in the settings. We load the</span>
<span class="c1"># given setting here using utils.object_from_module. This way we can use</span>
<span class="c1"># it regardless of if we change settings later.</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">django.conf</span><span class="w"> </span><span class="kn">import</span> <span class="n">settings</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">evennia</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">TICKER_HANDLER</span><span class="p">,</span>
    <span class="n">CmdSet</span><span class="p">,</span>
    <span class="n">Command</span><span class="p">,</span>
    <span class="n">DefaultExit</span><span class="p">,</span>
    <span class="n">DefaultRoom</span><span class="p">,</span>
    <span class="n">create_object</span><span class="p">,</span>
    <span class="n">default_cmds</span><span class="p">,</span>
    <span class="n">search_object</span><span class="p">,</span>
    <span class="n">syscmdkeys</span><span class="p">,</span>
    <span class="n">utils</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.objects</span><span class="w"> </span><span class="kn">import</span> <span class="n">LightSource</span>

<span class="n">_SEARCH_AT_RESULT</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">object_from_module</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">SEARCH_AT_RESULT</span><span class="p">)</span>

<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Tutorial room - parent room class</span>
<span class="c1">#</span>
<span class="c1"># This room is the parent of all rooms in the tutorial.</span>
<span class="c1"># It defines a tutorial command on itself (available to</span>
<span class="c1"># all those who are in a tutorial room).</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>

<span class="c1">#</span>
<span class="c1"># Special command available in all tutorial rooms</span>


<div class="viewcode-block" id="CmdTutorial">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorial">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdTutorial</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get help during the tutorial</span>

<span class="sd">    Usage:</span>
<span class="sd">      tutorial [obj]</span>

<span class="sd">    This command allows you to get behind-the-scenes info</span>
<span class="sd">    about an object or the current location.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;tutorial&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;tut&quot;</span><span class="p">]</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdTutorial.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorial.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All we do is to scan the current location for an Attribute</span>
<span class="sd">        called `tutorial_info` and display that.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span>  <span class="c1"># this is the room the command is defined on</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">helptext</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">helptext</span><span class="p">:</span>
            <span class="n">helptext</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; |G</span><span class="si">{</span><span class="n">helptext</span><span class="si">}</span><span class="s2">|n&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">helptext</span> <span class="o">=</span> <span class="s2">&quot; |RSorry, there is no tutorial help available here.|n&quot;</span>
        <span class="n">helptext</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> (Write &#39;give up&#39; if you want to abandon your quest.)&quot;</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">helptext</span><span class="p">)</span></div>
</div>



<span class="c1"># for the @detail command we inherit from MuxCommand, since</span>
<span class="c1"># we want to make use of MuxCommand&#39;s pre-parsing of &#39;=&#39; in the</span>
<span class="c1"># argument.</span>
<div class="viewcode-block" id="CmdTutorialSetDetail">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorialSetDetail">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdTutorialSetDetail</span><span class="p">(</span><span class="n">default_cmds</span><span class="o">.</span><span class="n">MuxCommand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sets a detail on a room</span>

<span class="sd">    Usage:</span>
<span class="sd">        @detail &lt;key&gt; = &lt;description&gt;</span>
<span class="sd">        @detail &lt;key&gt;;&lt;alias&gt;;... = description</span>

<span class="sd">    Example:</span>
<span class="sd">        @detail walls = The walls are covered in ...</span>
<span class="sd">        @detail castle;ruin;tower = The distant ruin ...</span>

<span class="sd">    This sets a &quot;detail&quot; on the object this command is defined on</span>
<span class="sd">    (TutorialRoom for this tutorial). This detail can be accessed with</span>
<span class="sd">    the TutorialRoomLook command sitting on TutorialRoom objects (details</span>
<span class="sd">    are set as a simple dictionary on the room). This is a Builder command.</span>

<span class="sd">    We custom parse the key for the ;-separator in order to create</span>
<span class="sd">    multiple aliases to the detail all at once.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;@detail&quot;</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:perm(Builder)&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdTutorialSetDetail.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorialSetDetail.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        All this does is to check if the object has</span>
<span class="sd">        the set_detail method and uses it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Usage: @detail key = description&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;set_detail&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Details cannot be set on </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">):</span>
            <span class="c1"># loop over all aliases, if any (if not, this will just be</span>
            <span class="c1"># the one key to loop over)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">set_detail</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Detail set: &#39;</span><span class="si">%s</span><span class="s2">&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lhs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhs</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="CmdTutorialLook">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorialLook">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdTutorialLook</span><span class="p">(</span><span class="n">default_cmds</span><span class="o">.</span><span class="n">CmdLook</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    looks at the room and on details</span>

<span class="sd">    Usage:</span>
<span class="sd">        look &lt;obj&gt;</span>
<span class="sd">        look &lt;room detail&gt;</span>
<span class="sd">        look *&lt;account&gt;</span>

<span class="sd">    Observes your location, details at your location or objects</span>
<span class="sd">    in your vicinity.</span>

<span class="sd">    Tutorial: This is a child of the default Look command, that also</span>
<span class="sd">    allows us to look at &quot;details&quot; in the room.  These details are</span>
<span class="sd">    things to examine and offers some extra description without</span>
<span class="sd">    actually having to be actual database objects. It uses the</span>
<span class="sd">    return_detail() hook on TutorialRooms for this.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># we don&#39;t need to specify key/locks etc, this is already</span>
    <span class="c1"># set by the parent.</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdTutorialLook.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorialLook.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handle the looking. This is a copy of the default look</span>
<span class="sd">        code except for adding in the details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># we use quiet=True to turn off automatic error reporting.</span>
            <span class="c1"># This tells search that we want to handle error messages</span>
            <span class="c1"># ourself. This also means the search function will always</span>
            <span class="c1"># return a list (with 0, 1 or more elements) rather than</span>
            <span class="c1"># result/None.</span>
            <span class="n">looking_at_obj</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">args</span><span class="p">,</span>
                <span class="c1"># note: excludes room/room aliases</span>
                <span class="n">candidates</span><span class="o">=</span><span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">contents</span> <span class="o">+</span> <span class="n">caller</span><span class="o">.</span><span class="n">contents</span><span class="p">,</span>
                <span class="n">use_nicks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">looking_at_obj</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># no target found or more than one target found (multimatch)</span>
                <span class="c1"># look for a detail that may match</span>
                <span class="n">detail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">return_detail</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># no detail found, delegate our result to the normal</span>
                    <span class="c1"># error message handler.</span>
                    <span class="n">_SEARCH_AT_RESULT</span><span class="p">(</span><span class="n">looking_at_obj</span><span class="p">,</span> <span class="n">caller</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># we found a match, extract it from the list and carry on</span>
                <span class="c1"># normally with the look handling.</span>
                <span class="n">looking_at_obj</span> <span class="o">=</span> <span class="n">looking_at_obj</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">looking_at_obj</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">location</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">looking_at_obj</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You have no location to look at!&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">looking_at_obj</span><span class="p">,</span> <span class="s2">&quot;return_appearance&quot;</span><span class="p">):</span>
            <span class="c1"># this is likely due to us having an account instead</span>
            <span class="n">looking_at_obj</span> <span class="o">=</span> <span class="n">looking_at_obj</span><span class="o">.</span><span class="n">character</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">looking_at_obj</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">caller</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="p">):</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Could not find &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span> <span class="o">%</span> <span class="n">args</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># get object&#39;s appearance</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">looking_at_obj</span><span class="o">.</span><span class="n">return_appearance</span><span class="p">(</span><span class="n">caller</span><span class="p">))</span>
        <span class="c1"># the object&#39;s at_desc() method.</span>
        <span class="n">looking_at_obj</span><span class="o">.</span><span class="n">at_desc</span><span class="p">(</span><span class="n">looker</span><span class="o">=</span><span class="n">caller</span><span class="p">)</span>
        <span class="k">return</span></div>
</div>



<div class="viewcode-block" id="CmdTutorialGiveUp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorialGiveUp">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdTutorialGiveUp</span><span class="p">(</span><span class="n">default_cmds</span><span class="o">.</span><span class="n">MuxCommand</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Give up the tutorial-world quest and return to Limbo, the start room of the</span>
<span class="sd">    server.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;give up&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;abort&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="CmdTutorialGiveUp.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdTutorialGiveUp.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">outro_room</span> <span class="o">=</span> <span class="n">OutroRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">outro_room</span><span class="p">:</span>
            <span class="n">outro_room</span> <span class="o">=</span> <span class="n">outro_room</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s2">&quot;That didn&#39;t work (seems like a bug). &quot;</span>
                <span class="s2">&quot;Try to use the |wteleport|n command instead.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">outro_room</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;teleport&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TutorialRoomCmdSet">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialRoomCmdSet">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TutorialRoomCmdSet</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the simple tutorial cmdset. This will overload the look</span>
<span class="sd">    command in the default CharacterCmdSet since it has a higher</span>
<span class="sd">    priority (ChracterCmdSet has prio 0)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;tutorial_cmdset&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="TutorialRoomCmdSet.at_cmdset_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialRoomCmdSet.at_cmdset_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add the tutorial-room commands&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdTutorial</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdTutorialSetDetail</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdTutorialLook</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdTutorialGiveUp</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="TutorialRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TutorialRoom</span><span class="p">(</span><span class="n">DefaultRoom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the base room type for all rooms in the tutorial world.</span>
<span class="sd">    It defines a cmdset on itself for reading tutorial info about the location.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TutorialRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called when room is first created&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;This is a tutorial room. It allows you to use the &#39;tutorial&#39; command.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="n">TutorialRoomCmdSet</span><span class="p">)</span></div>


<div class="viewcode-block" id="TutorialRoom.at_object_receive">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialRoom.at_object_receive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_arrival</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When an object enter a tutorial room we tell other objects in</span>
<span class="sd">        the room about it by trying to call a hook on them. The Mob object</span>
<span class="sd">        uses this to cheaply get notified of enemies without having</span>
<span class="sd">        to constantly scan for them.</span>

<span class="sd">        Args:</span>
<span class="sd">            new_arrival (Object): the object that just entered this room.</span>
<span class="sd">            source_location (Object): the previous location of new_arrival.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_arrival</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
            <span class="c1"># currently running batchcommand</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">new_arrival</span><span class="o">.</span><span class="n">has_account</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">new_arrival</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
            <span class="c1"># this is a character</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents_get</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">new_arrival</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;at_new_arrival&quot;</span><span class="p">):</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">at_new_arrival</span><span class="p">(</span><span class="n">new_arrival</span><span class="p">)</span></div>


<div class="viewcode-block" id="TutorialRoom.return_detail">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialRoom.return_detail">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">return_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailkey</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This looks for an Attribute &quot;obj_details&quot; and possibly</span>
<span class="sd">        returns the value of it.</span>

<span class="sd">        Args:</span>
<span class="sd">            detailkey (str): The detail being looked at. This is</span>
<span class="sd">                case-insensitive.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">details</span>
        <span class="k">if</span> <span class="n">details</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">detailkey</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="TutorialRoom.set_detail">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialRoom.set_detail">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_detail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detailkey</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This sets a new detail, using an Attribute &quot;details&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            detailkey (str): The detail identifier to add (for</span>
<span class="sd">                aliases you need to add multiple keys to the</span>
<span class="sd">                same description). Case-insensitive.</span>
<span class="sd">            description (str): The text to return when looking</span>
<span class="sd">                at the given detailkey.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">details</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">detailkey</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">details</span> <span class="o">=</span> <span class="p">{</span><span class="n">detailkey</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">description</span><span class="p">}</span></div>
</div>



<div class="viewcode-block" id="TutorialStartExit">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialStartExit">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TutorialStartExit</span><span class="p">(</span><span class="n">DefaultExit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is like a normal exit except it makes the `intro` command available</span>
<span class="sd">    on itself. We put it on the exit in order to provide this command to the</span>
<span class="sd">    Limbo room without modifying Limbo itself - deleting the tutorial exit</span>
<span class="sd">    will also  clean up the intro command.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TutorialStartExit.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TutorialStartExit.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdSetEvenniaIntro</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</div>



<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Weather room - room with a ticker</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>

<span class="c1"># These are rainy weather strings</span>
<span class="n">WEATHER_STRINGS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;The rain coming down from the iron-grey sky intensifies.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A gust of wind throws the rain right in your face. Despite your cloak you shiver.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The rainfall eases a bit and the sky momentarily brightens.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;For a moment it looks like the rain is slowing, then it begins anew with renewed force.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The rain pummels you with large, heavy drops. You hear the rumble of thunder in the distance.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The wind is picking up, howling around you, throwing water droplets in your face. It&#39;s cold.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Bright fingers of lightning flash over the sky, moments later followed by a deafening rumble.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;It rains so hard you can hardly see your hand in front of you. You&#39;ll soon be drenched to the bone.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Lightning strikes in several thundering bolts, striking the trees in the forest to your west.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You hear the distant howl of what sounds like some sort of dog or wolf.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Large clouds rush across the sky, throwing their load of rain over the world.&quot;</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="WeatherRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.WeatherRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WeatherRoom</span><span class="p">(</span><span class="n">TutorialRoom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This should probably better be called a rainy room...</span>

<span class="sd">    This sets up an outdoor room typeclass. At irregular intervals,</span>
<span class="sd">    the effects of weather will show in the room. Outdoor rooms should</span>
<span class="sd">    inherit from this.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="WeatherRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.WeatherRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when object is first created.</span>
<span class="sd">        We set up a ticker to update this room regularly.</span>

<span class="sd">        Note that we could in principle also use a Script to manage</span>
<span class="sd">        the ticking of the room; the TickerHandler works fine for</span>
<span class="sd">        simple things like this though.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="c1"># subscribe ourselves to a ticker to repeatedly call the hook</span>
        <span class="c1"># &quot;update_weather&quot; on this object. The interval is randomized</span>
        <span class="c1"># so as to not have all weather rooms update at the same time.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
        <span class="n">TICKER_HANDLER</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">interval</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update_weather</span><span class="p">,</span> <span class="n">idstring</span><span class="o">=</span><span class="s2">&quot;tutorial&quot;</span>
        <span class="p">)</span>
        <span class="c1"># this is parsed by the &#39;tutorial&#39; command on TutorialRooms.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="s2">&quot;This room has a Script running that has it echo a weather-related message at irregular intervals.&quot;</span></div>


<div class="viewcode-block" id="WeatherRoom.update_weather">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.WeatherRoom.update_weather">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by the tickerhandler at regular intervals. Even so, we</span>
<span class="sd">        only update 20% of the time, picking a random weather message</span>
<span class="sd">        when we do. The tickerhandler requires that this hook accepts</span>
<span class="sd">        any arguments and keyword arguments (hence the *args, **kwargs</span>
<span class="sd">        even though we don&#39;t actually use them in this example)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">:</span>
            <span class="c1"># only update 20 % of the time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="s2">&quot;|w</span><span class="si">%s</span><span class="s2">|n&quot;</span> <span class="o">%</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">WEATHER_STRINGS</span><span class="p">))</span></div>
</div>



<span class="n">SUPERUSER_WARNING</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: You are playing as a superuser (</span><span class="si">{name}</span><span class="s2">). Use the </span><span class="si">{quell}</span><span class="s2"> command to</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;play without superuser privileges (many functions and puzzles ignore the </span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;presence of a superuser, making this mode useful for exploring things behind </span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;the scenes later).</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="c1"># ------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Intro Room - unique room</span>
<span class="c1">#</span>
<span class="c1"># This room marks the start of the tutorial. It sets up properties on</span>
<span class="c1"># the player char that is needed for the tutorial.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="CmdEvenniaIntro">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdEvenniaIntro">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdEvenniaIntro</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Start the Evennia intro wizard.</span>

<span class="sd">    Usage:</span>
<span class="sd">        intro</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;intro&quot;</span>

<div class="viewcode-block" id="CmdEvenniaIntro.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdEvenniaIntro.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.intro_menu</span><span class="w"> </span><span class="kn">import</span> <span class="n">init_menu</span>

        <span class="c1"># quell also superusers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Auto-quelling permissions while in intro ...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">(</span><span class="s2">&quot;quell&quot;</span><span class="p">)</span>
        <span class="n">init_menu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CmdSetEvenniaIntro">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdSetEvenniaIntro">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdSetEvenniaIntro</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;Evennia Intro StartSet&quot;</span>

<div class="viewcode-block" id="CmdSetEvenniaIntro.at_cmdset_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdSetEvenniaIntro.at_cmdset_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdEvenniaIntro</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="IntroRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.IntroRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IntroRoom</span><span class="p">(</span><span class="n">TutorialRoom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intro room</span>

<span class="sd">    properties to customize:</span>
<span class="sd">     char_health - integer &gt; 0 (default 20)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="IntroRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.IntroRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the room is first created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The first room of the tutorial. &quot;</span>
            <span class="s2">&quot;This assigns the health Attribute to &quot;</span>
            <span class="s2">&quot;the account.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="IntroRoom.at_object_receive">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.IntroRoom.at_object_receive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Assign properties on characters</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
            <span class="c1"># currently running batchcommand</span>
            <span class="k">return</span>

        <span class="c1"># setup character for the tutorial</span>
        <span class="n">health</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">char_health</span> <span class="ow">or</span> <span class="mi">20</span>

        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">has_account</span><span class="p">:</span>
            <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">=</span> <span class="n">health</span>
            <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health_max</span> <span class="o">=</span> <span class="n">health</span>

        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">78</span> <span class="o">+</span> <span class="n">SUPERUSER_WARNING</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">78</span>
            <span class="n">character</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;|r</span><span class="si">%s</span><span class="s2">|n&quot;</span> <span class="o">%</span> <span class="n">string</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">character</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">quell</span><span class="o">=</span><span class="s2">&quot;|wquell|r&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># quell user if they have account and is not currently running the batch processor</span>
            <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">account</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">character</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
                <span class="n">character</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">(</span><span class="s2">&quot;quell&quot;</span><span class="p">)</span>
                <span class="n">character</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;(Auto-quelling while in tutorial-world)&quot;</span><span class="p">)</span></div>
</div>



<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Bridge - unique room</span>
<span class="c1">#</span>
<span class="c1"># Defines a special west-eastward &quot;bridge&quot;-room, a large room that takes</span>
<span class="c1"># several steps to cross. It is complete with custom commands and a</span>
<span class="c1"># chance of falling off the bridge. This room has no regular exits,</span>
<span class="c1"># instead the exitings are handled by custom commands set on the account</span>
<span class="c1"># upon first entering the room.</span>
<span class="c1">#</span>
<span class="c1"># Since one can enter the bridge room from both ends, it is</span>
<span class="c1"># divided into five steps:</span>
<span class="c1">#       westroom &lt;- 0 1 2 3 4 -&gt; eastroom</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="CmdEast">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdEast">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdEast</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Go eastwards across the bridge.</span>

<span class="sd">    Tutorial info:</span>
<span class="sd">        This command relies on the caller having two Attributes</span>
<span class="sd">        (assigned by the room when entering):</span>
<span class="sd">            - east_exit: a unique name or dbref to the room to go to</span>
<span class="sd">              when exiting east.</span>
<span class="sd">            - west_exit: a unique name or dbref to the room to go to</span>
<span class="sd">              when exiting west.</span>
<span class="sd">       The room must also have the following Attributes</span>
<span class="sd">           - tutorial_bridge_posistion: the current position on</span>
<span class="sd">             on the bridge, 0 - 4.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;east&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdEast.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdEast.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;move one step eastwards&quot;&quot;&quot;</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>

        <span class="n">bridge_step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bridge_step</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="c1"># we have reached the far east end of the bridge.</span>
            <span class="c1"># Move to the east room.</span>
            <span class="n">eexit</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">east_exit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">eexit</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">eexit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;traverse&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;No east exit was found for this room. Contact an admin.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span> <span class="o">=</span> <span class="n">bridge_step</span>
        <span class="c1"># since we are really in one room, we have to notify others</span>
        <span class="c1"># in the room when we move.</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> steps eastwards across the bridge.&quot;</span> <span class="o">%</span> <span class="n">caller</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">caller</span>
        <span class="p">)</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">(</span><span class="s2">&quot;look&quot;</span><span class="p">)</span></div>
</div>



<span class="c1"># go back across the bridge</span>
<div class="viewcode-block" id="CmdWest">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdWest">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdWest</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Go westwards across the bridge.</span>

<span class="sd">    Tutorial info:</span>
<span class="sd">       This command relies on the caller having two Attributes</span>
<span class="sd">       (assigned by the room when entering):</span>
<span class="sd">           - east_exit: a unique name or dbref to the room to go to</span>
<span class="sd">             when exiting east.</span>
<span class="sd">           - west_exit: a unique name or dbref to the room to go to</span>
<span class="sd">             when exiting west.</span>
<span class="sd">       The room must also have the following property:</span>
<span class="sd">           - tutorial_bridge_posistion: the current position on</span>
<span class="sd">             on the bridge, 0 - 4.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;west&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdWest.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdWest.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;move one step westwards&quot;&quot;&quot;</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>

        <span class="n">bridge_step</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">bridge_step</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># we have reached the far west end of the bridge.</span>
            <span class="c1"># Move to the west room.</span>
            <span class="n">wexit</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">west_exit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">wexit</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">wexit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;traverse&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;No west exit was found for this room. Contact an admin.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span> <span class="o">=</span> <span class="n">bridge_step</span>
        <span class="c1"># since we are really in one room, we have to notify others</span>
        <span class="c1"># in the room when we move.</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> steps westwards across the bridge.&quot;</span> <span class="o">%</span> <span class="n">caller</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">caller</span>
        <span class="p">)</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">(</span><span class="s2">&quot;look&quot;</span><span class="p">)</span></div>
</div>



<span class="n">BRIDGE_POS_MESSAGES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;You are standing |wvery close to the the bridge&#39;s western foundation|n.&quot;</span>
    <span class="s2">&quot; If you go west you will be back on solid ground ...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The bridge slopes precariously where it extends eastwards&quot;</span>
    <span class="s2">&quot; towards the lowest point - the center point of the hang bridge.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are |whalfways|n out on the unstable bridge.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The bridge slopes precariously where it extends westwards&quot;</span>
    <span class="s2">&quot; towards the lowest point - the center point of the hang bridge.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are standing |wvery close to the bridge&#39;s eastern foundation|n.&quot;</span>
    <span class="s2">&quot; If you go east you will be back on solid ground ...&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">BRIDGE_MOODS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;The bridge sways in the wind.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The hanging bridge creaks dangerously.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You clasp the ropes firmly as the bridge sways and creaks under you.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;From the castle you hear a distant howling sound, like that of a large dog or other beast.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The bridge creaks under your feet. Those planks does not seem very sturdy.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Far below you the ocean roars and throws its waves against the cliff,&quot;</span>
    <span class="s2">&quot; as if trying its best to reach you.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Parts of the bridge come loose behind you, falling into the chasm far below!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A gust of wind causes the bridge to sway precariously.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Under your feet a plank comes loose, tumbling down. For a moment you dangle over the abyss ...&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The section of rope you hold onto crumble in your hands,&quot;</span>
    <span class="s2">&quot; parts of it breaking apart. You sway trying to regain balance.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">FALL_MESSAGE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Suddenly the plank you stand on gives way under your feet! You fall!&quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">You try to grab hold of an adjoining plank, but all you manage to do is to &quot;</span>
    <span class="s2">&quot;divert your fall westwards, towards the cliff face. This is going to hurt ... &quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... The world goes dark ...</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="p">)</span>


<div class="viewcode-block" id="CmdLookBridge">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdLookBridge">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdLookBridge</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    looks around at the bridge.</span>

<span class="sd">    Tutorial info:</span>
<span class="sd">        This command assumes that the room has an Attribute</span>
<span class="sd">        &quot;fall_exit&quot;, a unique name or dbref to the place they end upp</span>
<span class="sd">        if they fall off the bridge.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;look&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdLookBridge.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdLookBridge.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Looking around, including a chance to fall.&quot;&quot;&quot;</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>
        <span class="n">bridge_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span>
        <span class="c1"># this command is defined on the room, so we get it through self.obj</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span>
        <span class="c1"># randomize the look-echo</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;|c</span><span class="si">%s</span><span class="s2">|n</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="n">location</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
            <span class="n">BRIDGE_POS_MESSAGES</span><span class="p">[</span><span class="n">bridge_position</span><span class="p">],</span>
            <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">BRIDGE_MOODS</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">chars</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">contents_get</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">caller</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">has_account</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">chars</span><span class="p">:</span>
            <span class="c1"># we create the You see: message manually here</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> You see: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;|c</span><span class="si">%s</span><span class="s2">|n&quot;</span> <span class="o">%</span> <span class="n">char</span><span class="o">.</span><span class="n">key</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># there is a chance that we fall if we are on the western or central</span>
        <span class="c1"># part of the bridge.</span>
        <span class="k">if</span> <span class="n">bridge_position</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
            <span class="c1"># we fall 5% of time.</span>
            <span class="n">fall_exit</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">fall_exit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fall_exit</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;|r</span><span class="si">%s</span><span class="s2">|n&quot;</span> <span class="o">%</span> <span class="n">FALL_MESSAGE</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">fall_exit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;fall&quot;</span><span class="p">)</span>
                <span class="c1"># inform others on the bridge</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                    <span class="s2">&quot;A plank gives way under </span><span class="si">%s</span><span class="s2">&#39;s feet and &quot;</span>
                    <span class="s2">&quot;they fall from the bridge!&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span>
                <span class="p">)</span></div>
</div>



<span class="c1"># custom help command</span>
<div class="viewcode-block" id="CmdBridgeHelp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdBridgeHelp">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdBridgeHelp</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overwritten help command while on the bridge.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;help&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">]</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;Tutorial world&quot;</span>

<div class="viewcode-block" id="CmdBridgeHelp.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdBridgeHelp.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements the command.&quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;You are trying hard not to fall off the bridge ...&quot;</span>
            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">What you can do is trying to cross the bridge |weast|n&quot;</span>
            <span class="s2">&quot; or try to get back to the mainland |wwest|n).&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="BridgeCmdSet">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.BridgeCmdSet">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BridgeCmdSet</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This groups the bridge commands. We will store it on the room.&quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;Bridge commands&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># this gives it precedence over the normal look/help commands.</span>

<div class="viewcode-block" id="BridgeCmdSet.at_cmdset_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.BridgeCmdSet.at_cmdset_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called at first cmdset creation&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdTutorial</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdEast</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdWest</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdLookBridge</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdBridgeHelp</span><span class="p">())</span></div>
</div>



<span class="n">BRIDGE_WEATHER</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;The rain intensifies, making the planks of the bridge even more slippery.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;A gust of wind throws the rain right in your face.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The rainfall eases a bit and the sky momentarily brightens.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The bridge shakes under the thunder of a closeby thunder strike.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The rain pummels you with large, heavy drops. You hear the distinct howl of a large hound in the distance.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The wind is picking up, howling around you and causing the bridge to sway from side to side.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Some sort of large bird sweeps by overhead, giving off an eery screech. Soon it has disappeared in the gloom.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;The bridge sways from side to side in the wind.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Below you a particularly large wave crashes into the rocks.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;From the ruin you hear a distant, otherwordly howl. Or maybe it was just the wind.&quot;</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="BridgeRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.BridgeRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">BridgeRoom</span><span class="p">(</span><span class="n">WeatherRoom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The bridge room implements an unsafe bridge. It also enters the player into</span>
<span class="sd">    a state where they get new commands so as to try to cross the bridge.</span>

<span class="sd">     We want this to result in the account getting a special set of</span>
<span class="sd">     commands related to crossing the bridge. The result is that it</span>
<span class="sd">     will take several steps to cross it, despite it being represented</span>
<span class="sd">     by only a single room.</span>

<span class="sd">     We divide the bridge into steps:</span>

<span class="sd">        self.db.west_exit     -   -  |  -   -     self.db.east_exit</span>
<span class="sd">                              0   1  2  3   4</span>

<span class="sd">     The position is handled by a variable stored on the character</span>
<span class="sd">     when entering and giving special move commands will</span>
<span class="sd">     increase/decrease the counter until the bridge is crossed.</span>

<span class="sd">     We also has self.db.fall_exit, which points to a gathering</span>
<span class="sd">     location to end up if we happen to fall off the bridge (used by</span>
<span class="sd">     the CmdLookBridge command).</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="BridgeRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.BridgeRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setups the room&quot;&quot;&quot;</span>
        <span class="c1"># this will start the weather room&#39;s ticker and tell</span>
        <span class="c1"># it to call update_weather regularly.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="c1"># this identifies the exits from the room (should be the command</span>
        <span class="c1"># needed to leave through that exit). These are defaults, but you</span>
        <span class="c1"># could of course also change them after the room has been created.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">west_exit</span> <span class="o">=</span> <span class="s2">&quot;cliff&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">east_exit</span> <span class="o">=</span> <span class="s2">&quot;gate&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">fall_exit</span> <span class="o">=</span> <span class="s2">&quot;cliffledge&quot;</span>
        <span class="c1"># add the cmdset on the room.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">BridgeCmdSet</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># since the default Character&#39;s at_look() will access the room&#39;s</span>
        <span class="c1"># return_description (this skips the cmdset) when</span>
        <span class="c1"># first entering it, we need to explicitly turn off the room</span>
        <span class="c1"># as a normal view target - once inside, our own look will</span>
        <span class="c1"># handle all return messages.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;view:false()&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BridgeRoom.update_weather">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.BridgeRoom.update_weather">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_weather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called at irregular intervals and makes the passage</span>
<span class="sd">        over the bridge a little more interesting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="c1"># send a message most of the time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="s2">&quot;|w</span><span class="si">%s</span><span class="s2">|n&quot;</span> <span class="o">%</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">BRIDGE_WEATHER</span><span class="p">))</span></div>


<div class="viewcode-block" id="BridgeRoom.at_object_receive">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.BridgeRoom.at_object_receive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This hook is called by the engine whenever the player is moved</span>
<span class="sd">        into this room.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
            <span class="c1"># currently running batchcommand</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">has_account</span><span class="p">:</span>
            <span class="c1"># we only run this if the entered object is indeed a player object.</span>
            <span class="c1"># check so our east/west exits are correctly defined.</span>
            <span class="n">wexit</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">west_exit</span><span class="p">)</span>
            <span class="n">eexit</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">east_exit</span><span class="p">)</span>
            <span class="n">fexit</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">fall_exit</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">wexit</span> <span class="ow">and</span> <span class="n">eexit</span> <span class="ow">and</span> <span class="n">fexit</span><span class="p">):</span>
                <span class="n">character</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                    <span class="s2">&quot;The bridge&#39;s exits are not properly configured. &quot;</span>
                    <span class="s2">&quot;Contact an admin. Forcing west-end placement.&quot;</span>
                <span class="p">)</span>
                <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">source_location</span> <span class="o">==</span> <span class="n">eexit</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="c1"># we assume we enter from the same room we will exit to</span>
                <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if not from the east, then from the west!</span>
                <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">character</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">(</span><span class="s2">&quot;look&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="BridgeRoom.at_object_leave">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.BridgeRoom.at_object_leave">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">target_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is triggered when the player leaves the bridge room.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">has_account</span><span class="p">:</span>
            <span class="c1"># clean up the position attribute</span>
            <span class="k">del</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span></div>
</div>



<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Dark Room - a room with states</span>
<span class="c1">#</span>
<span class="c1"># This room limits the movemenets of its denizens unless they carry an active</span>
<span class="c1"># LightSource object (LightSource is defined in</span>
<span class="c1">#                     tutorialworld.objects.LightSource)</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------------------------</span>


<span class="n">DARK_MESSAGES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;It is pitch black. You are likely to be eaten by a grue.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;It&#39;s pitch black. You fumble around but cannot find anything.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You don&#39;t see a thing. You feel around, managing to bump your fingers hard against something. Ouch!&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You don&#39;t see a thing! Blindly grasping the air around you, you find nothing.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;It&#39;s totally dark here. You almost stumble over some un-evenness in the ground.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You are completely blind. For a moment you think you hear someone breathing nearby ... &quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ... surely you must be mistaken.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Blind, you think you find some sort of object on the ground, but it turns out to be just a stone.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Blind, you bump into a wall. The wall seems to be covered with some sort of vegetation,&quot;</span>
    <span class="s2">&quot; but its too damp to burn.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;You can&#39;t see anything, but the air is damp. It feels like you are far underground.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ALREADY_LIGHTSOURCE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;You don&#39;t want to stumble around in blindness anymore. You already &quot;</span>
    <span class="s2">&quot;found what you need. Let&#39;s get light already!&quot;</span>
<span class="p">)</span>

<span class="n">FOUND_LIGHTSOURCE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Your fingers bump against a splinter of wood in a corner.&quot;</span>
    <span class="s2">&quot; It smells of resin and seems dry enough to burn! &quot;</span>
    <span class="s2">&quot;You pick it up, holding it firmly. Now you just need to&quot;</span>
    <span class="s2">&quot; |wlight|n it using the flint and steel you carry with you.&quot;</span>
<span class="p">)</span>


<div class="viewcode-block" id="CmdLookDark">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdLookDark">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdLookDark</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Look around in darkness</span>

<span class="sd">    Usage:</span>
<span class="sd">      look</span>

<span class="sd">    Look around in the darkness, trying</span>
<span class="sd">    to find something.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;look&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;feel&quot;</span><span class="p">,</span> <span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="s2">&quot;feel around&quot;</span><span class="p">,</span> <span class="s2">&quot;fiddle&quot;</span><span class="p">]</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdLookDark.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdLookDark.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the command.</span>

<span class="sd">        This works both as a look and a search command; there is a</span>
<span class="sd">        random chance of eventually finding a light source.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span>

        <span class="c1"># count how many searches we&#39;ve done</span>
        <span class="n">nr_searches</span> <span class="o">=</span> <span class="n">caller</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">dark_searches</span>
        <span class="k">if</span> <span class="n">nr_searches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nr_searches</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">dark_searches</span> <span class="o">=</span> <span class="n">nr_searches</span>

        <span class="k">if</span> <span class="n">nr_searches</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.90</span><span class="p">:</span>
            <span class="c1"># we don&#39;t find anything</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">DARK_MESSAGES</span><span class="p">))</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">dark_searches</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># we could have found something!</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">caller</span><span class="o">.</span><span class="n">contents</span> <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">inherits_from</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">LightSource</span><span class="p">)):</span>
                <span class="c1">#  we already carry a LightSource object.</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">ALREADY_LIGHTSOURCE</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># don&#39;t have a light source, create a new one.</span>
                <span class="n">create_object</span><span class="p">(</span><span class="n">LightSource</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;splinter&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">caller</span><span class="p">)</span>
                <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">FOUND_LIGHTSOURCE</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CmdDarkHelp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdDarkHelp">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdDarkHelp</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Help command for the dark state.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;help&quot;</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdDarkHelp.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdDarkHelp.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the the help command with a not-so-useful help</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Can&#39;t help you until you find some light! Try looking/feeling around for something to burn. &quot;</span>
            <span class="s2">&quot;You shouldn&#39;t give up even if you don&#39;t find anything right away.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CmdDarkNoMatch">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdDarkNoMatch">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdDarkNoMatch</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a system command. Commands with special keys are used to</span>
<span class="sd">    override special sitations in the game. The CMD_NOMATCH is used</span>
<span class="sd">    when the given command is not found in the current command set (it</span>
<span class="sd">    replaces Evennia&#39;s default behavior or offering command</span>
<span class="sd">    suggestions)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="n">syscmdkeys</span><span class="o">.</span><span class="n">CMD_NOMATCH</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>

<div class="viewcode-block" id="CmdDarkNoMatch.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.CmdDarkNoMatch.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Implements the command.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
            <span class="s2">&quot;Until you find some light, there&#39;s not much you can do. &quot;</span>
            <span class="s2">&quot;Try feeling around, maybe you&#39;ll find something helpful!&quot;</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="DarkCmdSet">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkCmdSet">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DarkCmdSet</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Groups the commands of the dark room together.  We also import the</span>
<span class="sd">    default say command here so that players can still talk in the</span>
<span class="sd">    darkness.</span>

<span class="sd">    We give the cmdset the mergetype &quot;Replace&quot; to make sure it</span>
<span class="sd">    completely replaces whichever command set it is merged onto</span>
<span class="sd">    (usually the default cmdset)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;darkroom_cmdset&quot;</span>
    <span class="n">mergetype</span> <span class="o">=</span> <span class="s2">&quot;Replace&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">2</span>

<div class="viewcode-block" id="DarkCmdSet.at_cmdset_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkCmdSet.at_cmdset_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;populate the cmdset.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdTutorial</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdLookDark</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdDarkHelp</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdDarkNoMatch</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">default_cmds</span><span class="o">.</span><span class="n">CmdSay</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">default_cmds</span><span class="o">.</span><span class="n">CmdQuit</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">default_cmds</span><span class="o">.</span><span class="n">CmdHome</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="DarkRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DarkRoom</span><span class="p">(</span><span class="n">TutorialRoom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A dark room. This tries to start the DarkState script on all</span>
<span class="sd">    objects entering. The script is responsible for making sure it is</span>
<span class="sd">    valid (that is, that there is no light source shining in the room).</span>

<span class="sd">    The is_lit Attribute is used to define if the room is currently lit</span>
<span class="sd">    or not, so as to properly echo state changes.</span>

<span class="sd">    Since this room (in the tutorial) is meant as a sort of catch-all,</span>
<span class="sd">    we also make sure to heal characters ending up here, since they</span>
<span class="sd">    may have been beaten up by the ghostly apparition at this point.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DarkRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when object is first created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="s2">&quot;This is a room with custom command sets on itself.&quot;</span>
        <span class="c1"># the room starts dark.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_lit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DarkCmdSet</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="DarkRoom.at_init">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkRoom.at_init">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when room is first recached (such as after a reload)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">()</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_carries_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the given object carries anything that gives light.</span>

<span class="sd">        Note that we do NOT look for a specific LightSource typeclass,</span>
<span class="sd">        but for the Attribute is_giving_light - this makes it easy to</span>
<span class="sd">        later add other types of light-giving items. We also accept</span>
<span class="sd">        if there is a light-giving object in the room overall (like if</span>
<span class="sd">        a splinter was dropped in the room)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">is_superuser</span>
            <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span>
            <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_giving_light</span>
            <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">contents</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_giving_light</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_heal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Heal a character.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">health</span> <span class="o">=</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health_max</span> <span class="ow">or</span> <span class="mi">20</span>
        <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">=</span> <span class="n">health</span>

<div class="viewcode-block" id="DarkRoom.check_light_state">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkRoom.check_light_state">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">check_light_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method checks if there are any light sources in the room.</span>
<span class="sd">        If there isn&#39;t it makes sure to add the dark cmdset to all</span>
<span class="sd">        characters in the room. It is called whenever characters enter</span>
<span class="sd">        the room and also by the Light sources when they turn on.</span>

<span class="sd">        Args:</span>
<span class="sd">            exclude (Object): An object to not include in the light check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_carries_light</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="k">if</span> <span class="n">obj</span> <span class="o">!=</span> <span class="n">exclude</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;view:all()&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">DarkCmdSet</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_lit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">(</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">has_account</span><span class="p">):</span>
                <span class="c1"># this won&#39;t do anything if it is already removed</span>
                <span class="n">char</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The room is lit up.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># noone is carrying light - darken the room</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_lit</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;view:false()&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">DarkCmdSet</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">(</span><span class="n">obj</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">has_account</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">char</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You are Superuser, so you are not affected by the dark state.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># put players in darkness</span>
                    <span class="n">char</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The room is completely dark.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="DarkRoom.at_object_receive">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkRoom.at_object_receive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when an object enters the room.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
            <span class="c1"># currently running batchcommand</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">()</span>  <span class="c1"># this should remove the DarkCmdSet</span>

        <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">has_account</span><span class="p">:</span>
            <span class="c1"># a puppeted object, that is, a Character</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_heal</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="c1"># in case the new guy carries light with them</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">()</span></div>


<div class="viewcode-block" id="DarkRoom.at_object_leave">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.DarkRoom.at_object_leave">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">target_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        In case people leave with the light, we make sure to clear the</span>
<span class="sd">        DarkCmdSet if necessary.  This also works if they are</span>
<span class="sd">        teleported away.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># since this hook is called while the object is still in the room,</span>
        <span class="c1"># we exclude it from the light check, to ignore any light sources</span>
        <span class="c1"># it may be carrying.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">obj</span><span class="p">)</span></div>
</div>



<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Teleport room - puzzles solution</span>
<span class="c1">#</span>
<span class="c1"># This is a sort of puzzle room that requires a certain</span>
<span class="c1"># attribute on the entering character to be the same as</span>
<span class="c1"># an attribute of the room. If not, the character will</span>
<span class="c1"># be teleported away to a target location. This is used</span>
<span class="c1"># by the Obelisk - grave chamber puzzle, where one must</span>
<span class="c1"># have looked at the obelisk to get an attribute set on</span>
<span class="c1"># oneself, and then pick the grave chamber with the</span>
<span class="c1"># matching imagery for this attribute.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="TeleportRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TeleportRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TeleportRoom</span><span class="p">(</span><span class="n">TutorialRoom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Teleporter - puzzle room.</span>

<span class="sd">    Important attributes (set at creation):</span>
<span class="sd">      puzzle_key    - which attr to look for on character</span>
<span class="sd">      puzzle_value  - what char.db.puzzle_key must be set to</span>
<span class="sd">      success_teleport_to -  where to teleport in case if success</span>
<span class="sd">      success_teleport_msg - message to echo while teleporting to success</span>
<span class="sd">      failure_teleport_to - where to teleport to in case of failure</span>
<span class="sd">      failure_teleport_msg - message to echo while teleporting to failure</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TeleportRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TeleportRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Called at first creation&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="c1"># what character.db.puzzle_clue must be set to, to avoid teleportation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">puzzle_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># target of successful teleportation. Can be a dbref or a</span>
        <span class="c1"># unique room name.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">success_teleport_msg</span> <span class="o">=</span> <span class="s2">&quot;You are successful!&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">success_teleport_to</span> <span class="o">=</span> <span class="s2">&quot;treasure room&quot;</span>
        <span class="c1"># the target of the failure teleportation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">failure_teleport_msg</span> <span class="o">=</span> <span class="s2">&quot;You fail!&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">failure_teleport_to</span> <span class="o">=</span> <span class="s2">&quot;dark cell&quot;</span></div>


<div class="viewcode-block" id="TeleportRoom.at_object_receive">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.TeleportRoom.at_object_receive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This hook is called by the engine whenever the player is moved into</span>
<span class="sd">        this room.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">character</span><span class="o">.</span><span class="n">has_account</span> <span class="ow">or</span> <span class="n">character</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
            <span class="c1"># only act on player characters or when not building.</span>
            <span class="k">return</span>

        <span class="c1"># determine if the puzzle is a success or not</span>
        <span class="n">is_success</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">puzzle_clue</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">puzzle_value</span><span class="p">)</span>
        <span class="n">teleport_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">success_teleport_to</span> <span class="k">if</span> <span class="n">is_success</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">failure_teleport_to</span>
        <span class="c1"># note that this returns a list</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">search_object</span><span class="p">(</span><span class="n">teleport_to</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># we cannot move anywhere since no valid target was found.</span>
            <span class="n">character</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;no valid teleport target for </span><span class="si">%s</span><span class="s2"> was found.&quot;</span> <span class="o">%</span> <span class="n">teleport_to</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">is_superuser</span><span class="p">:</span>
            <span class="c1"># superusers don&#39;t get teleported</span>
            <span class="n">character</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Superuser block: You would have been teleported to </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="c1"># perform the teleport</span>
        <span class="k">if</span> <span class="n">is_success</span><span class="p">:</span>
            <span class="n">character</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">success_teleport_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">character</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">failure_teleport_msg</span><span class="p">)</span>
        <span class="c1"># teleport quietly to the new place</span>
        <span class="n">character</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">move_hooks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;teleport&quot;</span><span class="p">)</span>
        <span class="c1"># we have to call this manually since we turn off move_hooks</span>
        <span class="c1"># - this is necessary to make the target dark room aware of an</span>
        <span class="c1"># already carried light.</span>
        <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">at_object_receive</span><span class="p">(</span><span class="n">character</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>
</div>



<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Outro room - unique exit room</span>
<span class="c1">#</span>
<span class="c1"># Cleans up the character from all tutorial-related properties.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="OutroRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.OutroRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">OutroRoom</span><span class="p">(</span><span class="n">TutorialRoom</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Outro room.</span>

<span class="sd">    Called when exiting the tutorial, cleans the</span>
<span class="sd">    character of tutorial-related attributes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="OutroRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.OutroRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the room is first created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The last room of the tutorial. &quot;</span>
            <span class="s2">&quot;This cleans up all temporary Attributes &quot;</span>
            <span class="s2">&quot;the tutorial may have assigned to the &quot;</span>
            <span class="s2">&quot;character.&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="OutroRoom.at_object_receive">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.OutroRoom.at_object_receive">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_receive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do cleanup.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">batch_batchmode</span><span class="p">:</span>
            <span class="c1"># currently running batchcommand</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">has_account</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health_max</span>
            <span class="k">del</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span>
            <span class="k">del</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">last_climbed</span>
            <span class="k">del</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">puzzle_clue</span>
            <span class="k">del</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">combat_parry_mode</span>
            <span class="k">del</span> <span class="n">character</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_bridge_position</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">character</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">typeclass_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;evennia.contrib.tutorials.tutorial_world&quot;</span><span class="p">):</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
            <span class="n">character</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s2">&quot;tutorial_world&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OutroRoom.at_object_leave">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.tutorials.tutorial_world.rooms.html#evennia.contrib.tutorials.tutorial_world.rooms.OutroRoom.at_object_leave">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">character</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">move_type</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">character</span><span class="o">.</span><span class="n">account</span><span class="p">:</span>
            <span class="n">character</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">execute_cmd</span><span class="p">(</span><span class="s2">&quot;unquell&quot;</span><span class="p">)</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/evennia_logo.png" alt="Logo of Evennia"/>
            </a></p>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com/docs/latest/index.html">Documentation Top</a> </li>
  <li><a href="https://www.evennia.com">Evennia Home</a> </li>
  <li><a href="https://github.com/evennia/evennia">Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Blog</a>
  </li>
</ul>
<h3>Doc Versions</h3>
<ul>
  
    <li>
      <a href="https://www.evennia.com/docs/latest/index.html">latest (main branch)</a>
    </li>
  
  
    <li>
      <a href="https://www.evennia.com/docs/5.x/index.html">v5.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/4.x/index.html">v4.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/3.x/index.html">v3.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/2.x/index.html">v2.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/1.x/index.html">v1.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/0.x/index.html">v0.9.5 branch (outdated)</a>
    </li>
  
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" >evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorials.tutorial_world.rooms</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>