<!DOCTYPE html>

<html lang="en" data-content_root="../../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>evennia.contrib.game_systems.crafting.example_recipes &#8212; Evennia latest documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/nature.css?v=279e0f84" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=e4a91a55" />
    <script src="../../../../../_static/documentation_options.js?v=c6e86fd7"></script>
    <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" accesskey="U">evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.game_systems.crafting.example_recipes</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evennia.contrib.game_systems.crafting.example_recipes</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">How to make a sword - example crafting tree for the crafting system.</span>

<span class="sd">See the `SwordSmithingBaseRecipe` in this module for an example of extendng the</span>
<span class="sd">recipe with a mocked &#39;skill&#39; system (just random chance in our case). The skill</span>
<span class="sd">system used is game-specific but likely to be needed for most &#39;real&#39; crafting</span>
<span class="sd">systems.</span>

<span class="sd">Note that &#39;tools&#39; are references to the tools used - they don&#39;t need to be in</span>
<span class="sd">the inventory of the crafter. So when &#39;blast furnace&#39; is given below, it is a</span>
<span class="sd">reference to a blast furnace used, not suggesting the crafter is carrying it</span>
<span class="sd">around with them.</span>

<span class="sd">## Sword crafting tree</span>

<span class="sd">::</span>

<span class="sd">    # base materials (consumables)</span>

<span class="sd">    iron ore, ash, sand, coal, oak wood, water, fur</span>

<span class="sd">    # base tools (marked with [T] for clarity and assumed to already exist)</span>

<span class="sd">    blast furnace[T], furnace[T], crucible[T], anvil[T],</span>
<span class="sd">    hammer[T], knife[T], cauldron[T]</span>

<span class="sd">    # recipes for making a sword</span>

<span class="sd">    pig iron = iron ore + 2xcoal + blast furnace[T]</span>
<span class="sd">    crucible_steel = pig iron + ash + sand + 2xcoal + crucible[T]</span>
<span class="sd">    sword blade = crucible steel + hammer[T] + anvil[T] + furnace[T]</span>
<span class="sd">    sword pommel = crucible steel + hammer[T] + anvil[T] + furnace[T]</span>
<span class="sd">    sword guard = crucible steel + hammer[T] + anvil[T] + furnace[T]</span>

<span class="sd">    rawhide = fur + knife[T]</span>
<span class="sd">    oak bark + cleaned oak wood = oak wood + knife[T]</span>
<span class="sd">    leather = rawhide + oak bark + water + cauldron[T]</span>

<span class="sd">    sword handle = cleaned oak wood + knife[T]</span>

<span class="sd">    sword = sword blade + sword guard + sword pommel</span>
<span class="sd">            + sword handle + leather + knife[T] + hammer[T] + furnace[T]</span>


<span class="sd">## Recipes used for spell casting</span>

<span class="sd">This is a simple example modifying the base Recipe to use as a way</span>
<span class="sd">to describe magical spells instead. It combines tools with</span>
<span class="sd">a skill (an attribute on the caster) in order to produce a magical effect.</span>

<span class="sd">The example `CmdCast` command can be added to the CharacterCmdset in</span>
<span class="sd">`mygame/commands/default_cmdsets` to test it out. The &#39;effects&#39; are</span>
<span class="sd">just mocked for the example.</span>

<span class="sd">::</span>
<span class="sd">    # base tools (assumed to already exist)</span>

<span class="sd">    spellbook[T], wand[T]</span>

<span class="sd">    # skill (stored as Attribute on caster)</span>

<span class="sd">    firemagic skill level10+</span>

<span class="sd">    # recipe for fireball</span>

<span class="sd">    fireball = spellbook[T] + wand[T] + [firemagic skill lvl10+]</span>

<span class="sd">----</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">randint</span><span class="p">,</span> <span class="n">random</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">evennia.commands.command</span><span class="w"> </span><span class="kn">import</span> <span class="n">Command</span><span class="p">,</span> <span class="n">InterruptCommand</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.crafting</span><span class="w"> </span><span class="kn">import</span> <span class="n">CraftingRecipe</span><span class="p">,</span> <span class="n">CraftingValidationError</span><span class="p">,</span> <span class="n">craft</span>

<span class="c1"># ------------------------------------------------------------</span>
<span class="c1"># Sword recipe</span>
<span class="c1"># ------------------------------------------------------------</span>


<div class="viewcode-block" id="PigIronRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.PigIronRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PigIronRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pig iron is a high-carbon result of melting iron in a blast furnace.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;pig iron&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blast furnace&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;iron ore&quot;</span><span class="p">,</span> <span class="s2">&quot;coal&quot;</span><span class="p">,</span> <span class="s2">&quot;coal&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Pig Iron ingot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;An ingot of crude pig iron.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;pig iron&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="CrucibleSteelRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.CrucibleSteelRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CrucibleSteelRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mixing pig iron with impurities like ash and sand and melting it in a</span>
<span class="sd">    crucible produces a medieval level of steel (like damascus steel).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;crucible steel&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;crucible&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;pig iron&quot;</span><span class="p">,</span> <span class="s2">&quot;ash&quot;</span><span class="p">,</span> <span class="s2">&quot;sand&quot;</span><span class="p">,</span> <span class="s2">&quot;coal&quot;</span><span class="p">,</span> <span class="s2">&quot;coal&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Crucible steel ingot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;An ingot of multi-colored crucible steel.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;crucible steel&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<span class="k">class</span><span class="w"> </span><span class="nc">_SwordSmithingBaseRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A parent for all metallurgy sword-creation recipes. Those have a chance to</span>
<span class="sd">    failure but since steel is not lost in the process you can always try</span>
<span class="sd">    again.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">success_message</span> <span class="o">=</span> <span class="s2">&quot;Your smithing work bears fruit and you craft </span><span class="si">{outputs}</span><span class="s2">!&quot;</span>
    <span class="n">failed_message</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;You work and work but you are not happy with the result. You need to start over.&quot;</span>
    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">craft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Making a sword blade takes skill. Here we emulate this by introducing a</span>
<span class="sd">        random chance of failure (in a real game this could be a skill check</span>
<span class="sd">        against a skill found on `self.crafter`). In this case you can always</span>
<span class="sd">        start over since steel is not lost but can be re-smelted again for</span>
<span class="sd">        another try.</span>

<span class="sd">        Args:</span>
<span class="sd">            validated_inputs (list): all consumables/tools being used.</span>
<span class="sd">            **kwargs: any extra kwargs passed during crafting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            any: The result of the craft, or None if a failure.</span>

<span class="sd">        Notes:</span>
<span class="sd">            Depending on if we return a crafting result from this</span>
<span class="sd">            method or not, `success_message` or `failure_message`</span>
<span class="sd">            will be echoed to the crafter.</span>

<span class="sd">            (for more control we could also message directly and raise</span>
<span class="sd">            crafting.CraftingError to abort craft process on failure).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="c1"># 80% chance of success. This will spawn the sword and show</span>
            <span class="c1"># success-message.</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">craft</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fail and show failed message</span>
            <span class="k">return</span> <span class="kc">None</span>


<div class="viewcode-block" id="SwordBladeRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.SwordBladeRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SwordBladeRecipe</span><span class="p">(</span><span class="n">_SwordSmithingBaseRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A [sword]blade requires hammering the steel out into shape using heat and</span>
<span class="sd">    force. This also includes the tang, which is the base for the hilt (the</span>
<span class="sd">    part of the sword you hold on to).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sword blade&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hammer&quot;</span><span class="p">,</span> <span class="s2">&quot;anvil&quot;</span><span class="p">,</span> <span class="s2">&quot;furnace&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;crucible steel&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Sword blade&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A long blade that may one day become a sword.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;sword blade&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="SwordPommelRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.SwordPommelRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SwordPommelRecipe</span><span class="p">(</span><span class="n">_SwordSmithingBaseRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The pommel is the &#39;button&#39; or &#39;ball&#39; etc the end of the sword hilt, holding</span>
<span class="sd">    it together.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sword pommel&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hammer&quot;</span><span class="p">,</span> <span class="s2">&quot;anvil&quot;</span><span class="p">,</span> <span class="s2">&quot;furnace&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;crucible steel&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Sword pommel&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The pommel for a future sword.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;sword pommel&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="SwordGuardRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.SwordGuardRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SwordGuardRecipe</span><span class="p">(</span><span class="n">_SwordSmithingBaseRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The guard stops the hand from accidentally sliding off the hilt onto the</span>
<span class="sd">    sword&#39;s blade and also protects the hand when parrying.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sword guard&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hammer&quot;</span><span class="p">,</span> <span class="s2">&quot;anvil&quot;</span><span class="p">,</span> <span class="s2">&quot;furnace&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;crucible steel&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Sword guard&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The cross-guard for a future sword.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;sword guard&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="RawhideRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.RawhideRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RawhideRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rawhide is animal skin cleaned and stripped of hair.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;rawhide&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;knife&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;fur&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rawhide&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Animal skin, cleaned and with hair removed.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;rawhide&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="OakBarkRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.OakBarkRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">OakBarkRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The actual thing needed for tanning leather is Tannin, but we skip</span>
<span class="sd">    the step of refining tannin from the bark and use the bark as-is.</span>

<span class="sd">    This produces two outputs - the bark and the cleaned wood.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;oak bark&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;knife&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;oak wood&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Oak bark&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Bark of oak, stripped from the core wood.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;oak bark&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Oak Wood (cleaned)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Oakwood core, stripped of bark.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;cleaned oak wood&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">},</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="LeatherRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.LeatherRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">LeatherRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Leather is produced by tanning rawhide in a process traditionally involving</span>
<span class="sd">    the chemical Tannin. Here we abbreviate this process a bit. Maybe a</span>
<span class="sd">    &#39;tanning rack&#39; tool should be required too ...</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;leather&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cauldron&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rawhide&quot;</span><span class="p">,</span> <span class="s2">&quot;oak bark&quot;</span><span class="p">,</span> <span class="s2">&quot;water&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Piece of Leather&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A piece of leather.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;leather&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="SwordHandleRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.SwordHandleRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SwordHandleRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The handle is the part of the hilt between the guard and the pommel where</span>
<span class="sd">    you hold the sword. It consists of wooden pieces around the steel tang. It</span>
<span class="sd">    is wrapped in leather, but that will be added at the end.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sword handle&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;knife&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cleaned oak wood&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Sword handle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;Two pieces of wood to be be fitted onto a sword&#39;s tang as its handle.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;sword handle&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">]</span></div>



<div class="viewcode-block" id="SwordRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.SwordRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SwordRecipe</span><span class="p">(</span><span class="n">_SwordSmithingBaseRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A finished sword consists of a Blade ending in a non-sharp part called the</span>
<span class="sd">    Tang. The cross Guard is put over the tang against the edge of the blade.</span>
<span class="sd">    The Handle is put over the tang to give something easier to hold. The</span>
<span class="sd">    Pommel locks everything in place. The handle is wrapped in leather</span>
<span class="sd">    strips for better grip.</span>

<span class="sd">    This covers only a single &#39;sword&#39; type.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;sword&quot;</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hammer&quot;</span><span class="p">,</span> <span class="s2">&quot;furnace&quot;</span><span class="p">,</span> <span class="s2">&quot;knife&quot;</span><span class="p">]</span>
    <span class="n">consumable_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sword blade&quot;</span><span class="p">,</span> <span class="s2">&quot;sword guard&quot;</span><span class="p">,</span> <span class="s2">&quot;sword pommel&quot;</span><span class="p">,</span> <span class="s2">&quot;sword handle&quot;</span><span class="p">,</span> <span class="s2">&quot;leather&quot;</span><span class="p">]</span>
    <span class="n">output_prototypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Sword&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A bladed weapon.&quot;</span><span class="p">,</span>
            <span class="c1"># setting the tag as well - who knows if one can make something from this too!</span>
            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s2">&quot;sword&quot;</span><span class="p">,</span> <span class="s2">&quot;crafting_material&quot;</span><span class="p">)],</span>
        <span class="p">}</span>
        <span class="c1"># obviously there would be other properties of a &#39;sword&#39; added here</span>
        <span class="c1"># too, depending on how combat works in the your game!</span>
    <span class="p">]</span>
    <span class="c1"># this requires more precision</span>
    <span class="n">exact_consumable_order</span> <span class="o">=</span> <span class="kc">True</span></div>



<span class="c1"># ------------------------------------------------------------</span>
<span class="c1"># Recipes for spell casting</span>
<span class="c1"># ------------------------------------------------------------</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_MagicRecipe</span><span class="p">(</span><span class="n">CraftingRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base &#39;recipe&#39; to represent magical spells.</span>

<span class="sd">    We *could* treat this just like the sword above - by combining the wand and spellbook to make a</span>
<span class="sd">    fireball object that the user can then throw with another command. For this example we instead</span>
<span class="sd">    generate &#39;magical effects&#39; as strings+values that we would then supposedly inject into a</span>
<span class="sd">    combat system or other resolution system.</span>

<span class="sd">    We also assume that the crafter has skills set on itself as plain Attributes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># all spells require a spellbook and a wand (so there!)</span>
    <span class="n">tool_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;spellbook&quot;</span><span class="p">,</span> <span class="s2">&quot;wand&quot;</span><span class="p">]</span>

    <span class="n">error_tool_missing_message</span> <span class="o">=</span> <span class="s2">&quot;Cannot cast spells without </span><span class="si">{missing}</span><span class="s2">.&quot;</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s2">&quot;You successfully cast the spell!&quot;</span>
    <span class="c1"># custom properties</span>
    <span class="n">skill_requirement</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># this should be on the form [(skillname, min_level)]</span>
    <span class="n">skill_roll</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># skill to roll for success</span>
    <span class="n">desired_effects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># on the form [(effect, value), ...]</span>
    <span class="n">failure_effects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># &#39;&#39;</span>
    <span class="n">error_too_low_skill_level</span> <span class="o">=</span> <span class="s2">&quot;Your skill </span><span class="si">{skill_name}</span><span class="s2"> is too low to cast </span><span class="si">{spell}</span><span class="s2">.&quot;</span>
    <span class="n">error_no_skill_roll</span> <span class="o">=</span> <span class="s2">&quot;You must have the skill </span><span class="si">{skill_name}</span><span class="s2"> to cast the spell </span><span class="si">{spell}</span><span class="s2">.&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">pre_craft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is where we do input validation. We want to do the</span>
<span class="sd">        normal validation of the tools, but also check for a skill</span>
<span class="sd">        on the crafter. This must set the result on `self.validated_inputs`.</span>
<span class="sd">        We also set the crafter&#39;s relevant skill value on `self.skill_roll_value`.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Any optional extra kwargs passed during initialization of</span>
<span class="sd">                the recipe class.</span>

<span class="sd">        Raises:</span>
<span class="sd">            CraftingValidationError: If validation fails. At this point the crafter</span>
<span class="sd">                is expected to have been informed of the problem already.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this will check so the spellbook and wand are at hand.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">pre_craft</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># at this point we have the items available, let&#39;s also check for the skill. We</span>
        <span class="c1"># assume the  crafter has the skill available as an Attribute</span>
        <span class="c1"># on itself.</span>

        <span class="n">crafter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crafter</span>
        <span class="k">for</span> <span class="n">skill_name</span><span class="p">,</span> <span class="n">min_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill_requirements</span><span class="p">:</span>
            <span class="n">skill_value</span> <span class="o">=</span> <span class="n">crafter</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">skill_name</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">skill_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">skill_value</span> <span class="o">&lt;</span> <span class="n">min_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error_too_low_skill_level</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">skill_name</span><span class="o">=</span><span class="n">skill_name</span><span class="p">,</span> <span class="n">spell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="n">CraftingValidationError</span>

        <span class="c1"># get the value of the skill to roll</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">skill_roll_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crafter</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_roll</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill_roll_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_no_skill_roll</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">skill_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">skill_roll</span><span class="p">,</span> <span class="n">spell</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">CraftingValidationError</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">do_craft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &#39;Craft&#39; the magical effect. When we get to this point we already know we have all the</span>
<span class="sd">        prequisite for creating the effect. In this example we will store the effect on the crafter;</span>
<span class="sd">        maybe this enhances the crafter or makes a new attack available to them in combat.</span>

<span class="sd">        An alternative to this would of course be to spawn an actual object for the effect, like</span>
<span class="sd">        creating a potion or an actual fireball-object to throw (this depends on how your combat</span>
<span class="sd">        works).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># we do a simple skill check here.</span>
        <span class="k">if</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">skill_roll_value</span><span class="p">:</span>
            <span class="c1"># a success!</span>
            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">desired_effects</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># a failure!</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">failure_effects</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">post_craft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">craft_result</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Always called at the end of crafting, regardless of successful or not.</span>

<span class="sd">        Since we get a custom craft result (True/False, effects) we need to</span>
<span class="sd">        wrap the original post_craft to output the error messages for us</span>
<span class="sd">        correctly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">craft_result</span><span class="p">:</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">craft_result</span>
        <span class="c1"># default post_craft just checks if craft_result is truthy or not.</span>
        <span class="c1"># we don&#39;t care about its return value since we already have craft_result.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">post_craft</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">craft_result</span>


<div class="viewcode-block" id="FireballRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.FireballRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FireballRecipe</span><span class="p">(</span><span class="n">_MagicRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Fireball is a magical effect that can be thrown at a target to cause damage.</span>

<span class="sd">    Note that the magic-effects are just examples, an actual rule system would</span>
<span class="sd">    need to be created to understand what they mean when used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;fireball&quot;</span>
    <span class="n">skill_requirements</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;firemagic&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>  <span class="c1"># skill &#39;firemagic&#39; lvl 10 or higher</span>
    <span class="n">skill_roll</span> <span class="o">=</span> <span class="s2">&quot;firemagic&quot;</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s2">&quot;A ball of flame appears!&quot;</span>
    <span class="n">desired_effects</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;target_fire_damage&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ranged_attack&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;mana_cost&quot;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)]</span>
    <span class="n">failure_effects</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;self_fire_damage&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;mana_cost&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span></div>



<div class="viewcode-block" id="HealingRecipe">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.HealingRecipe">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HealingRecipe</span><span class="p">(</span><span class="n">_MagicRecipe</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Healing magic will restore a certain amount of health to the target over time.</span>

<span class="sd">    Note that the magic-effects are just examples, an actual rule system would</span>
<span class="sd">    need to be created to understand what they mean.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;heal&quot;</span>
    <span class="n">skill_requirements</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;bodymagic&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;empathy&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
    <span class="n">skill_roll</span> <span class="o">=</span> <span class="s2">&quot;bodymagic&quot;</span>
    <span class="n">success_message</span> <span class="o">=</span> <span class="s2">&quot;You successfully extend your healing aura.&quot;</span>
    <span class="n">desired_effects</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;healing&quot;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;mana_cost&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
    <span class="n">failure_effects</span> <span class="o">=</span> <span class="p">[]</span></div>



<div class="viewcode-block" id="CmdCast">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.CmdCast">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CmdCast</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cast a magical spell.</span>

<span class="sd">    Usage:</span>
<span class="sd">        cast &lt;spell&gt; &lt;target&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;cast&quot;</span>

<div class="viewcode-block" id="CmdCast.parse">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.CmdCast.parse">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simple parser, assuming spellname doesn&#39;t have spaces.</span>
<span class="sd">        Stores result in self.target and self.spellname.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spellname</span><span class="p">,</span> <span class="o">*</span><span class="n">target</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spellname</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">spellname</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You must specify a spell name.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">InterruptCommand</span>

        <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">InterruptCommand</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span></div>


<div class="viewcode-block" id="CmdCast.func">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.game_systems.crafting.example_recipes.html#evennia.contrib.game_systems.crafting.example_recipes.CmdCast.func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># all items carried by the caller could work</span>
        <span class="n">possible_tools</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">contents</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># if this completes without an exception, the caster will have</span>
            <span class="c1"># a new magic_effect set on themselves, ready to use or apply in some way.</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">effects</span> <span class="o">=</span> <span class="n">craft</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spellname</span><span class="p">,</span> <span class="o">*</span><span class="n">possible_tools</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">CraftingValidationError</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You don&#39;t know of a spell called &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spellname</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Applying the magical effect to target would happen below.</span>
        <span class="c1"># self.caller.db.active_spells[self.spellname] holds all the effects</span>
        <span class="c1"># of this particular prepared spell. For a fireball you could perform</span>
        <span class="c1"># an attack roll here and apply damage if you hit. For healing you would heal the target</span>
        <span class="c1"># (which could be yourself) by a number of health points given by the recipe.</span>
        <span class="n">effect_txt</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">eff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">eff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">eff</span> <span class="ow">in</span> <span class="n">effects</span><span class="p">)</span>
        <span class="n">success_txt</span> <span class="o">=</span> <span class="s2">&quot;|gsucceeded|n&quot;</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s2">&quot;|rfailed|n&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Casting the spell </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spellname</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">success_txt</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;causing the following effects: </span><span class="si">{</span><span class="n">effect_txt</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/evennia_logo.png" alt="Logo of Evennia"/>
            </a></p>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com/docs/latest/index.html">Documentation Top</a> </li>
  <li><a href="https://www.evennia.com">Evennia Home</a> </li>
  <li><a href="https://github.com/evennia/evennia">Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Blog</a>
  </li>
</ul>
<h3>Doc Versions</h3>
<ul>
  
    <li>
      <a href="https://www.evennia.com/docs/latest/index.html">latest (main branch)</a>
    </li>
  
  
    <li>
      <a href="https://www.evennia.com/docs/5.x/index.html">v5.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/4.x/index.html">v4.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/3.x/index.html">v3.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/2.x/index.html">v2.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/1.x/index.html">v1.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/0.x/index.html">v0.9.5 branch (outdated)</a>
    </li>
  
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" >evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.game_systems.crafting.example_recipes</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>