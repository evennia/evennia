<!DOCTYPE html>

<html lang="en" data-content_root="../../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>evennia.contrib.grid.xyzgrid.tests &#8212; Evennia latest documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/nature.css?v=279e0f84" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/custom.css?v=e4a91a55" />
    <script src="../../../../../_static/documentation_options.js?v=c6e86fd7"></script>
    <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" accesskey="U">evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.grid.xyzgrid.tests</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evennia.contrib.grid.xyzgrid.tests</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Tests for the XYZgrid system.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">randint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">unittest</span><span class="w"> </span><span class="kn">import</span> <span class="n">mock</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">django.test</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">parameterized</span><span class="w"> </span><span class="kn">import</span> <span class="n">parameterized</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">evennia.utils.test_resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseEvenniaCommandTest</span><span class="p">,</span> <span class="n">BaseEvenniaTest</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">commands</span><span class="p">,</span> <span class="n">xymap</span><span class="p">,</span> <span class="n">xymap_legend</span><span class="p">,</span> <span class="n">xyzgrid</span><span class="p">,</span> <span class="n">xyzroom</span>

<span class="n">MAP1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2"> + 0 1 2</span>

<span class="s2"> 1 #-#</span>
<span class="s2">   | |</span>
<span class="s2"> 0 #-#</span>

<span class="s2"> + 0 1 2</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP1_DISPLAY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#</span>
<span class="s2">| |</span>
<span class="s2">#-#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="n">MAP2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2"> + 0 1 2 3 4 5</span>

<span class="s2"> 5 #-#-#-#-#</span>
<span class="s2">       |   |</span>
<span class="s2"> 4     #---#</span>
<span class="s2">       |   |</span>
<span class="s2"> 3 #   |   #-#</span>
<span class="s2">   |   |     |</span>
<span class="s2"> 2 #-#-#-#---#</span>
<span class="s2">   |   |</span>
<span class="s2"> 1 #-#-#---#-#</span>
<span class="s2">     |     |</span>
<span class="s2"> 0   #-#-#-#</span>

<span class="s2"> + 0 1 2 3 4 5</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP2_DISPLAY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#-#-#-#</span>
<span class="s2">    |   |</span>
<span class="s2">    #---#</span>
<span class="s2">    |   |</span>
<span class="s2">#   |   #-#</span>
<span class="s2">|   |     |</span>
<span class="s2">#-#-#-#---#</span>
<span class="s2">|   |</span>
<span class="s2">#-#-#---#-#</span>
<span class="s2">  |     |</span>
<span class="s2">  #-#-#-#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">MAP3</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">   + 0 1 2 3 4 5</span>

<span class="s2">   5 #-#---#   #</span>
<span class="s2">       |  / \ /</span>
<span class="s2">   4   # /   #</span>
<span class="s2">       |/    |</span>
<span class="s2">   3   #     #</span>
<span class="s2">       |\   / \</span>
<span class="s2">   2   # #-#   #</span>
<span class="s2">       |/   \ /</span>
<span class="s2">   1   #     #</span>
<span class="s2">      / \    |</span>
<span class="s2">   0 #   #---#-#</span>

<span class="s2">   + 0 1 2 3 4 5</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP3_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#---#   #</span>
<span class="s2">  |  / \ /</span>
<span class="s2">  # /   #</span>
<span class="s2">  |/    |</span>
<span class="s2">  #     #</span>
<span class="s2">  |\   / \</span>
<span class="s2">  # #-#   #</span>
<span class="s2">  |/   \ /</span>
<span class="s2">  #     #</span>
<span class="s2"> / \    |</span>
<span class="s2">#   #---#-#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">MAP4</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2"> + 0 1 2 3 4</span>

<span class="s2"> 4 #-# #---#</span>
<span class="s2">      x   /</span>
<span class="s2"> 3   #-#-#</span>
<span class="s2">     |x x|</span>
<span class="s2"> 2 #-#-#-#</span>
<span class="s2">   | |   |</span>
<span class="s2"> 1 #-+-#-+-#</span>
<span class="s2">     |   |</span>
<span class="s2"> 0   #---#</span>

<span class="s2"> + 0 1 2 3 4</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP4_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-# #---#</span>
<span class="s2">   x   /</span>
<span class="s2">  #-#-#</span>
<span class="s2">  |x x|</span>
<span class="s2">#-#-#-#</span>
<span class="s2">| |   |</span>
<span class="s2">#-+-#-+-#</span>
<span class="s2">  |   |</span>
<span class="s2">  #---#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">MAP5</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1 2</span>

<span class="s2">2 #-#</span>
<span class="s2">  | |</span>
<span class="s2">1 #&gt;#</span>

<span class="s2">0 #&gt;#</span>

<span class="s2">+ 0 1 2</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP5_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#</span>
<span class="s2">| |</span>
<span class="s2">#&gt;#</span>

<span class="s2">#&gt;#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">MAP6</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2"> + 0 1 2 3 4</span>

<span class="s2"> 4 #-#-#-#</span>
<span class="s2">     ^   |</span>
<span class="s2"> 3   |   #&gt;#</span>
<span class="s2">     |   | |</span>
<span class="s2"> 2   #-#-#-#</span>
<span class="s2">     ^   v</span>
<span class="s2"> 1   #---#-#</span>
<span class="s2">     |   | |</span>
<span class="s2"> 0 #-#&gt;#-#&lt;#</span>

<span class="s2"> + 0 1 2 3 4</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP6_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#-#-#</span>
<span class="s2">  ^   |</span>
<span class="s2">  |   #&gt;#</span>
<span class="s2">  |   | |</span>
<span class="s2">  #-#-#-#</span>
<span class="s2">  ^   v</span>
<span class="s2">  #---#-#</span>
<span class="s2">  |   | |</span>
<span class="s2">#-#&gt;#-#&lt;#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="n">MAP7</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">+ 0 1 2</span>

<span class="s2">2 #-#</span>
<span class="s2">    |</span>
<span class="s2">1 #-o-#</span>
<span class="s2">    |</span>
<span class="s2">0   #-#</span>

<span class="s2">+ 0 1 2</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP7_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#</span>
<span class="s2">  |</span>
<span class="s2">#-o-#</span>
<span class="s2">  |</span>
<span class="s2">  #-#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="n">MAP8</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">+ 0 1 2 3 4 5</span>

<span class="s2">4 #-#-o o o-o</span>
<span class="s2">  |  \|/| | |</span>
<span class="s2">3 #-o-o-# o-#</span>
<span class="s2">  |  /|\    |</span>
<span class="s2">2 o-o-#-#   o</span>
<span class="s2">    | |    /</span>
<span class="s2">1   #-o-#-o-#</span>
<span class="s2">      |  /</span>
<span class="s2">0 #---#-o</span>

<span class="s2">+ 0 1 2 3 4 5</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP8_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#-o o o-o</span>
<span class="s2">|  \|/| | |</span>
<span class="s2">#-o-o-# o-#</span>
<span class="s2">|  /|\    |</span>
<span class="s2">o-o-#-#   o</span>
<span class="s2">  | |    /</span>
<span class="s2">  #-o-#-o-#</span>
<span class="s2">    |  /</span>
<span class="s2">#---#-o</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="n">MAP9</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">+ 0 1 2 3</span>

<span class="s2">3 #-#-#-#</span>
<span class="s2">    d d d</span>
<span class="s2">2   | | |</span>
<span class="s2">    u u u</span>
<span class="s2">1 #-# #-#</span>
<span class="s2">  u   d</span>
<span class="s2">0 #d# #u#</span>

<span class="s2">+ 0 1 2 3</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP9_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#-#-#</span>
<span class="s2">  d d d</span>
<span class="s2">  | | |</span>
<span class="s2">  u u u</span>
<span class="s2">#-# #-#</span>
<span class="s2">u   d</span>
<span class="s2">#d# #u#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="n">MAP10</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2"> + 0 1 2 3</span>

<span class="s2"> 4 #---#-#</span>
<span class="s2">      b  |</span>
<span class="s2"> 3 #i#---#</span>
<span class="s2">   |/|</span>
<span class="s2"> 2 # #-I-#</span>
<span class="s2">     |</span>
<span class="s2"> 1 #-#b#-#</span>
<span class="s2">   | |   b</span>
<span class="s2"> 0 #b#-#-#</span>

<span class="s2"> + 0 1 2 3</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># note that I,i,b are invisible</span>
<span class="n">MAP10_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#---#-#</span>
<span class="s2">   /  |</span>
<span class="s2">#-#---#</span>
<span class="s2">|/|</span>
<span class="s2"># #-#-#</span>
<span class="s2">  |</span>
<span class="s2">#-#-#-#</span>
<span class="s2">| |   |</span>
<span class="s2">#-#-#-#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="n">MAP11</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1 2 3</span>

<span class="s2">2 #-#</span>
<span class="s2">   \</span>
<span class="s2">1   t t</span>
<span class="s2">       \</span>
<span class="s2">0     #-#</span>

<span class="s2">+ 0 1 2 3</span>

<span class="s2">&quot;&quot;&quot;</span>


<span class="n">MAP11_DISPLAY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">#-#</span>
<span class="s2"> \</span>

<span class="s2">     \</span>
<span class="s2">    #-#</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="n">MAP12a</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1</span>

<span class="s2">1 #-T</span>
<span class="s2">  |</span>
<span class="s2">0 #-#</span>

<span class="s2">+ 0 1</span>

<span class="s2">&quot;&quot;&quot;</span>


<span class="n">MAP12b</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1</span>

<span class="s2">1 #-#</span>
<span class="s2">    |</span>
<span class="s2">0 T-#</span>

<span class="s2">+ 0 1</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP13a</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1</span>

<span class="s2">1 #-#</span>
<span class="s2">  |</span>
<span class="s2">0 #</span>

<span class="s2">+ 0 1</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP13b</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1</span>

<span class="s2">1   #</span>

<span class="s2">0</span>

<span class="s2">+ 0 1</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP13c</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1</span>

<span class="s2">1   #</span>

<span class="s2">0</span>

<span class="s2">+ 0 1</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">MAP13d</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>

<span class="s2">+ 0 1</span>

<span class="s2">1 #-#</span>
<span class="s2">  |</span>
<span class="s2">0 #</span>

<span class="s2">+ 0 1</span>

<span class="s2">&quot;&quot;&quot;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_MapTest</span><span class="p">(</span><span class="n">BaseEvenniaTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parent for map tests</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP1</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map1&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP1_DISPLAY</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set up grid and map&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">xyzgrid</span><span class="o">.</span><span class="n">XYZGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;testgrid&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">add_maps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_data</span><span class="p">[</span><span class="s2">&quot;zcoord&quot;</span><span class="p">])</span>

        <span class="c1"># output to console</span>
        <span class="c1"># def _log(msg):</span>
        <span class="c1">#     print(msg)</span>
        <span class="c1"># self.grid.log = _log</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>


<div class="viewcode-block" id="TestMap1">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap1">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap1</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the Map class with a simple 4-node map</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestMap1.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap1.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">MAP1_DISPLAY</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMap1.test_node_from_coord">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap1.test_node_from_coord">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_node_from_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_node_from_coord</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMap1.test_get_shortest_path">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap1.test_get_shortest_path">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">directions</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">path</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">node_index_map</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="s2">&quot;&lt;LinkNode &#39;-&#39; XY=(0.5,0)&gt;&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">node_index_map</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="s2">&quot;&lt;LinkNode &#39;|&#39; XY=(1,0.5)&gt;&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">node_index_map</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
            <span class="p">],</span>
        <span class="p">)</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;| </span><span class="se">\n</span><span class="s2">#-&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">]]),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot; |</span><span class="se">\n</span><span class="s2">-#&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">]]),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;#-</span><span class="se">\n</span><span class="s2">| &quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">]]),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;-#</span><span class="se">\n</span><span class="s2"> |&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;#&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">]]),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range__scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">expectstr</span><span class="p">,</span> <span class="n">expectlst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test displaying a part of the map around a central point.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">maplst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span>
            <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">return_str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">maplst</span> <span class="o">=</span> <span class="p">[[</span><span class="n">part</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">partlst</span><span class="p">]</span> <span class="k">for</span> <span class="n">partlst</span> <span class="ow">in</span> <span class="n">maplst</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectstr</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectlst</span><span class="p">,</span> <span class="n">maplst</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;| </span><span class="se">\n</span><span class="s2">@-&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">]]),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot; |</span><span class="se">\n</span><span class="s2">-@&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">]]),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;@-</span><span class="se">\n</span><span class="s2">| &quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">]]),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;-@</span><span class="se">\n</span><span class="s2"> |&quot;</span><span class="p">,</span> <span class="p">[[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">]]),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range__scan__character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">expectstr</span><span class="p">,</span> <span class="n">expectlst</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test displaying a part of the map around a central point, showing the</span>
<span class="sd">        character @-symbol in that spot.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>
        <span class="n">maplst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span>
            <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">return_str</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span>
        <span class="p">)</span>
        <span class="n">maplst</span> <span class="o">=</span> <span class="p">[[</span><span class="n">part</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">partlst</span><span class="p">]</span> <span class="k">for</span> <span class="n">partlst</span> <span class="ow">in</span> <span class="n">maplst</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectstr</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expectlst</span><span class="p">,</span> <span class="n">maplst</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># flip y-axis for print</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;#  </span><span class="se">\n</span><span class="s2">|  </span><span class="se">\n</span><span class="s2">@-#&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;@-#</span><span class="se">\n</span><span class="s2">|  </span><span class="se">\n</span><span class="s2">#  &quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;  #</span><span class="se">\n</span><span class="s2">  |</span><span class="se">\n</span><span class="s2">#-@&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;#-@</span><span class="se">\n</span><span class="s2">  |</span><span class="se">\n</span><span class="s2">  #&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;#-#</span><span class="se">\n</span><span class="s2">| |</span><span class="se">\n</span><span class="s2">@-#&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range__nodes__character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get sub-part of map with node-mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap1.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap1.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">8</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap2">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap2">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap2</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test with Map2 - a bigger map with multi-step links</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP2</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map2&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP2_DISPLAY</span>

<div class="viewcode-block" id="TestMap2.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap2.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="c1"># strip the leftover spaces on the right to better</span>
        <span class="c1"># work with text editor stripping this automatically ...</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">),</span> <span class="n">MAP2_DISPLAY</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMap2.test_node_from_coord">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap2.test_node_from_coord">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_node_from_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">mapnode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">node_index_map</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_node_from_coord</span><span class="p">((</span><span class="n">mapnode</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">mapnode</span><span class="o">.</span><span class="n">Y</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">mapnode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">x</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">y</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>  <span class="c1"># straight path</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>  <span class="c1"># shortcut over long link</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">)),</span>  <span class="c1"># shortcut over long link (vertical)</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>  <span class="c1"># shortcut over long link (vertical)</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>  <span class="c1"># across entire grid</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>  <span class="c1"># across entire grid</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">)),</span>  <span class="c1"># down and back</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;#-#-#-#</span><span class="se">\n</span><span class="s2">|   |  </span><span class="se">\n</span><span class="s2">#-#-#--</span><span class="se">\n</span><span class="s2">  |    </span><span class="se">\n</span><span class="s2">  @-#-#&quot;</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span>
                    <span class="s2">&quot;    #---#</span><span class="se">\n</span><span class="s2">    |   |</span><span class="se">\n</span><span class="s2">#   |   #</span><span class="se">\n</span><span class="s2">|   |    </span><span class="se">\n</span><span class="s2">#-#-@-#--</span><span class="se">\n</span><span class="s2">|   &quot;</span>
                    <span class="s2">&quot;|    </span><span class="se">\n</span><span class="s2">#-#-#---#</span><span class="se">\n</span><span class="s2">  |     |</span><span class="se">\n</span><span class="s2">  #-#-#-#&quot;</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="s2">&quot;#-#-@  </span><span class="se">\n</span><span class="s2">|   |  </span><span class="se">\n</span><span class="s2">#---#  </span><span class="se">\n</span><span class="s2">|   |  </span><span class="se">\n</span><span class="s2">|   #-#&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;--#  </span><span class="se">\n</span><span class="s2">  |  </span><span class="se">\n</span><span class="s2">  #-#</span><span class="se">\n</span><span class="s2">    |</span><span class="se">\n</span><span class="s2">#---@</span><span class="se">\n</span><span class="s2">     </span><span class="se">\n</span><span class="s2">--#-#</span><span class="se">\n</span><span class="s2">  |  </span><span class="se">\n</span><span class="s2">#-#  &quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range__scan__character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test showing smaller part of grid, showing @-character in the middle.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;scan&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap2.test_extended_path_tracking__horizontal">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap2.test_extended_path_tracking__horizontal">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_extended_path_tracking__horizontal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crossing multi-gridpoint links should be tracked properly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_node_from_coord</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">direction</span><span class="p">:</span> <span class="p">[</span><span class="n">step</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">direction</span><span class="p">,</span> <span class="n">steps</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">xy_steps_to_node</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">]},</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestMap2.test_extended_path_tracking__vertical">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap2.test_extended_path_tracking__vertical">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_extended_path_tracking__vertical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Testing multi-gridpoint links in the vertical direction.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_node_from_coord</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">direction</span><span class="p">:</span> <span class="p">[</span><span class="n">step</span><span class="o">.</span><span class="n">symbol</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">direction</span><span class="p">,</span> <span class="n">steps</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">xy_steps_to_node</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">],</span> <span class="s2">&quot;e&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;|&quot;</span><span class="p">],</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">]},</span>
        <span class="p">)</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">),</span>  <span class="c1"># outside of any known node</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;@&quot;</span><span class="p">),</span>  <span class="c1"># 0 distance</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;#-#-#  </span><span class="se">\n</span><span class="s2">  |    </span><span class="se">\n</span><span class="s2">  @-#-#&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;@-#&quot;</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                <span class="mi">4</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;@-#-#-#-#</span><span class="se">\n</span><span class="s2">    |    </span><span class="se">\n</span><span class="s2">    #---#</span><span class="se">\n</span><span class="s2">    |    </span><span class="se">\n</span><span class="s2">    |    </span><span class="se">\n</span><span class="s2">    |    </span><span class="se">\n</span><span class="s2">    #    &quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;  #      </span><span class="se">\n</span><span class="s2">  |      </span><span class="se">\n</span><span class="s2">#-#---#-@</span><span class="se">\n</span><span class="s2">      |  </span><span class="se">\n</span><span class="s2">    #-#  &quot;</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s2">&quot;    #      </span><span class="se">\n</span><span class="s2">    |      </span><span class="se">\n</span><span class="s2">    #---#  </span><span class="se">\n</span><span class="s2">    |      </span><span class="se">\n</span><span class="s2">    |      </span><span class="se">\n</span><span class="s2">    |      </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;#-#-@-#---#</span><span class="se">\n</span><span class="s2">    |      </span><span class="se">\n</span><span class="s2">  #-#---#  &quot;</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="s2">&quot;  |  </span><span class="se">\n</span><span class="s2">  |  </span><span class="se">\n</span><span class="s2">#-@-#</span><span class="se">\n</span><span class="s2">  |  </span><span class="se">\n</span><span class="s2">#-#--&quot;</span><span class="p">),</span>  <span class="c1"># limit display size</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s2">&quot; | </span><span class="se">\n</span><span class="s2">-@-</span><span class="se">\n</span><span class="s2"> | &quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;@&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range__nodes__character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get sub-part of map with node-mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span>
            <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap2.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap2.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">54</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap3">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap3">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap3</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map3 - Map with diagonal links</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP3</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map3&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP3_DISPLAY</span>

<div class="viewcode-block" id="TestMap3.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap3.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP3_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">()),</span>  <span class="c1"># no node at (1, 0)!</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>  <span class="c1"># straight path</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ne&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ne&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;ne&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;ne&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;sw&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;sw&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;sw&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;sw&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s2">&quot;      #  </span><span class="se">\n</span><span class="s2">     /   </span><span class="se">\n</span><span class="s2">  # /    </span><span class="se">\n</span><span class="s2">  |/     </span><span class="se">\n</span><span class="s2">  #     #</span><span class="se">\n</span><span class="s2">  |</span><span class="se">\\</span><span class="s2">   / </span><span class="se">\n</span><span class="s2">  # @-#  </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;  |/   </span><span class="se">\\</span><span class="s2"> </span><span class="se">\n</span><span class="s2">  #     #</span><span class="se">\n</span><span class="s2"> / </span><span class="se">\\</span><span class="s2">     </span><span class="se">\n</span><span class="s2">#   #    &quot;</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;  #  </span><span class="se">\n</span><span class="s2">  |  </span><span class="se">\n</span><span class="s2">  #  </span><span class="se">\n</span><span class="s2"> / </span><span class="se">\\</span><span class="s2"> </span><span class="se">\n</span><span class="s2">#   @</span><span class="se">\n</span><span class="s2"> </span><span class="se">\\</span><span class="s2"> / </span><span class="se">\n</span><span class="s2">  #  </span><span class="se">\n</span><span class="s2">  |  </span><span class="se">\n</span><span class="s2">  #  &quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range__nodes__character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get sub-part of map with node-mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span>
            <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap3.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap3.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">18</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">44</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap4">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap4">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap4</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map4 - Map with + and x crossing links</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP4</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map4&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP4_DISPLAY</span>

<div class="viewcode-block" id="TestMap4.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap4.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP4_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,)),</span>  <span class="c1"># cross + vertically</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,)),</span>  <span class="c1"># cross + horizontally</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ne&quot;</span><span class="p">,)),</span>  <span class="c1"># cross x</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;ne&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;ne&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap4.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap4.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">44</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap5">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap5">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap5</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map5 - Small map with one-way links</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP5</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map5&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP5_DISPLAY</span>

<div class="viewcode-block" id="TestMap5.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap5.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP5_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,)),</span>  <span class="c1"># cross one-way</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">()),</span>  <span class="c1"># blocked</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,)),</span>  <span class="c1"># should still take shortest</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)),</span>  <span class="c1"># take long way around</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap5.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap5.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">8</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap6">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap6">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap6</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map6 - Bigger map with one-way links in different directions</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP6</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map6&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP6_DISPLAY</span>

<div class="viewcode-block" id="TestMap6.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap6.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP6_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>  <span class="c1"># cross one-way</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>  <span class="c1"># blocked, long way around</span>
            <span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap6.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap6.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">18</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">38</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap7">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap7">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap7</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map7 - Small test of dynamic link node</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP7</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map7&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP7_DISPLAY</span>

<div class="viewcode-block" id="TestMap7.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap7.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP7_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap7.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap7.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">8</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap8">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap8">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap8</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map8 - Small test of dynamic link node</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP8</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map8&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP8_DISPLAY</span>

<div class="viewcode-block" id="TestMap8.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap8.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP8_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">()),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;  #-o  </span><span class="se">\n</span><span class="s2">    |  </span><span class="se">\n</span><span class="s2">#   o  </span><span class="se">\n</span><span class="s2">|   |  </span><span class="se">\n</span><span class="s2">o-o-@-#</span><span class="se">\n</span><span class="s2">    |  </span><span class="se">\n</span><span class="s2">    o  </span><span class="se">\n</span><span class="s2">    |  </span><span class="se">\n</span><span class="s2">    #  &quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range__nodes__character</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get sub-part of map with node-mode.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span>
            <span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;  #-o  </span><span class="se">\n</span><span class="s2">    |  </span><span class="se">\n</span><span class="s2">#   o  </span><span class="se">\n</span><span class="s2">|   |  </span><span class="se">\n</span><span class="s2">o-o-@..</span><span class="se">\n</span><span class="s2">    |  </span><span class="se">\n</span><span class="s2">    o  </span><span class="se">\n</span><span class="s2">    |  </span><span class="se">\n</span><span class="s2">    #  &quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="mi">1</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;  #-o  </span><span class="se">\n</span><span class="s2">    |  </span><span class="se">\n</span><span class="s2">#   o  </span><span class="se">\n</span><span class="s2">|   |  </span><span class="se">\n</span><span class="s2">o-o-@-#</span><span class="se">\n</span><span class="s2">    .  </span><span class="se">\n</span><span class="s2">    .  </span><span class="se">\n</span><span class="s2">    .  </span><span class="se">\n</span><span class="s2">    ...&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s2">&quot;#-#-o      </span><span class="se">\n</span><span class="s2">|  </span><span class="se">\\</span><span class="s2">|      </span><span class="se">\n</span><span class="s2">#-o-o-#   .</span><span class="se">\n</span><span class="s2">|   |</span><span class="se">\\</span><span class="s2">    .</span><span class="se">\n</span><span class="s2">o-o-@-&quot;</span>
                    <span class="s2">&quot;#   .</span><span class="se">\n</span><span class="s2">    .    . </span><span class="se">\n</span><span class="s2">    .   .  </span><span class="se">\n</span><span class="s2">    .  .   </span><span class="se">\n</span><span class="s2">#---...    &quot;</span>
                <span class="p">),</span>
            <span class="p">),</span>
            <span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="s2">&quot;    o-o</span><span class="se">\n</span><span class="s2">    | |</span><span class="se">\n</span><span class="s2">    o-@</span><span class="se">\n</span><span class="s2">      .</span><span class="se">\n</span><span class="s2">.     .</span><span class="se">\n</span><span class="s2">.    . &quot;</span><span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="mi">2</span><span class="p">,</span>
                <span class="kc">None</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="s2">&quot;        o-o</span><span class="se">\n</span><span class="s2">        | |</span><span class="se">\n</span><span class="s2">        o-@</span><span class="se">\n</span><span class="s2">.         .</span><span class="se">\n</span><span class="s2">.....     &quot;</span>
                    <span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">    .    . </span><span class="se">\n</span><span class="s2">    .   .  </span><span class="se">\n</span><span class="s2">    .  .   </span><span class="se">\n</span><span class="s2">#---...    &quot;</span>
                <span class="p">),</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range_with_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get visual range with a path-to-target marked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span>
            <span class="n">coord</span><span class="p">,</span>
            <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
            <span class="n">target_path_style</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">,</span>
            <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">mapstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap8.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap8.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">28</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap9">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap9">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap9</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map9 - a map with up/down links.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP9</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map9&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP9_DISPLAY</span>

<div class="viewcode-block" id="TestMap9.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap9.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP9_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap9.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap9.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">24</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap10">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap10">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap10</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map10 - a map with blocked- and interrupt links/nodes. These are</span>
<span class="sd">    &#39;invisible&#39; nodes and won&#39;t show up in the map display.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP10</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map10&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP10_DISPLAY</span>

<div class="viewcode-block" id="TestMap10.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap10.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP10_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="c1"># interrupts are only relevant to the auto-stepper</span>
    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">()),</span>  <span class="c1"># the blockage hinders this</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,)),</span>
            <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,),</span> <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span>
                <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">,</span> <span class="n">expected_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test path locations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>
        <span class="n">strpositions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">step</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_path</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">strpositions</span><span class="p">))</span>

<div class="viewcode-block" id="TestMap10.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap10.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">18</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">42</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMap11">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap11">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMap11</span><span class="p">(</span><span class="n">_MapTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test Map11 - a map teleporter links.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">map_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP11</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map11&quot;</span><span class="p">}</span>
    <span class="n">map_display</span> <span class="o">=</span> <span class="n">MAP11_DISPLAY</span>

<div class="viewcode-block" id="TestMap11.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap11.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP11_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;nw&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;se&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;nw&quot;</span><span class="p">,),</span>
                <span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
            <span class="p">),</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;se&quot;</span><span class="p">,),</span>
                <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">,</span> <span class="n">expected_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test path locations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>
        <span class="n">strpositions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">step</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span> <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">path</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_path</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">strpositions</span><span class="p">))</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;...    </span><span class="se">\n</span><span class="s2"> .     </span><span class="se">\n</span><span class="s2">  . .  </span><span class="se">\n</span><span class="s2">     . </span><span class="se">\n</span><span class="s2">    @..&quot;</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;..@    </span><span class="se">\n</span><span class="s2"> .     </span><span class="se">\n</span><span class="s2">  . .  </span><span class="se">\n</span><span class="s2">     . </span><span class="se">\n</span><span class="s2">    ...&quot;</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_visual_range_with_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">max_size</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get visual range with a path-to-target marked.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapstr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span>
            <span class="n">coord</span><span class="p">,</span>
            <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
            <span class="n">target_path_style</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">,</span>
            <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">mapstr</span><span class="p">)</span>

<div class="viewcode-block" id="TestMap11.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMap11.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the map into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">6</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMapStressTest">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestMapStressTest">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestMapStressTest</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performance test of map patfinder and visualizer.</span>

<span class="sd">    #-#-#-#-#....</span>
<span class="sd">    |x|x|x|x|</span>
<span class="sd">    #-#-#-#-#</span>
<span class="sd">    |x|x|x|x|</span>
<span class="sd">    #-#-#-#-#</span>
<span class="sd">    |x|x|x|x|</span>
<span class="sd">    #-#-#-#-#</span>
<span class="sd">    ...</span>

<span class="sd">    This should be a good stress-testing scenario because most each internal node has a maxiumum</span>
<span class="sd">    number of connections and options to consider.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Xsize</span><span class="p">,</span> <span class="n">Ysize</span><span class="p">):</span>
        <span class="n">edge</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;+ </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Xsize</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;#-&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Xsize</span><span class="si">}</span><span class="s2">#&quot;</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="s1">&#39;|x&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Xsize</span><span class="si">}</span><span class="s2">|&quot;</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="p">(</span><span class="n">l1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Ysize</span><span class="si">}{</span><span class="n">l1</span><span class="si">}</span><span class="se">\n\n</span><span class="si">{</span><span class="n">edge</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mf">0.03</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_grid_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">,</span> <span class="n">max_time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test of grid-creataion performance for Nx, Ny grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># import cProfile</span>
        <span class="n">Xmax</span><span class="p">,</span> <span class="n">Ymax</span> <span class="o">=</span> <span class="n">gridsize</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid</span><span class="p">(</span><span class="n">Xmax</span><span class="p">,</span> <span class="n">Ymax</span><span class="p">)</span>
        <span class="n">mapobj</span> <span class="o">=</span> <span class="n">xymap</span><span class="o">.</span><span class="n">XYMap</span><span class="p">({</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">grid</span><span class="p">},</span> <span class="n">Z</span><span class="o">=</span><span class="s2">&quot;testmap&quot;</span><span class="p">)</span>
        <span class="c1"># t0 = time()</span>
        <span class="n">mapobj</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
        <span class="c1"># cProfile.runctx(&#39;mapobj.parse()&#39;, globals(), locals())</span>
        <span class="c1"># t1 = time()</span>
        <span class="c1"># if (t1 - t0 &gt; max_time):</span>
        <span class="c1">#     print(f&quot;Map creation of ({Xmax}x{Ymax}) grid slower &quot;</span>
        <span class="c1">#           f&quot;than expected {max_time}s.&quot;)</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_grid_pathfind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">,</span> <span class="n">max_time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test pathfinding performance for Nx, Ny grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Xmax</span><span class="p">,</span> <span class="n">Ymax</span> <span class="o">=</span> <span class="n">gridsize</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid</span><span class="p">(</span><span class="n">Xmax</span><span class="p">,</span> <span class="n">Ymax</span><span class="p">)</span>
        <span class="n">mapobj</span> <span class="o">=</span> <span class="n">xymap</span><span class="o">.</span><span class="n">XYMap</span><span class="p">({</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">grid</span><span class="p">},</span> <span class="n">Z</span><span class="o">=</span><span class="s2">&quot;testmap&quot;</span><span class="p">)</span>
        <span class="n">mapobj</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

        <span class="c1"># t0 = time()</span>
        <span class="n">mapobj</span><span class="o">.</span><span class="n">calculate_path_matrix</span><span class="p">()</span>
        <span class="c1"># t1 = time()</span>
        <span class="c1"># print(f&quot;pathfinder matrix for grid {Xmax}x{Ymax}: {t1 - t0}s&quot;)</span>

        <span class="c1"># get the maximum distance and 9 other random points in the grid</span>
        <span class="n">start_end_points</span> <span class="o">=</span> <span class="p">[((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">Xmax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Ymax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="n">start_end_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">((</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xmax</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ymax</span><span class="p">)),</span> <span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xmax</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ymax</span><span class="p">)))</span>
            <span class="p">)</span>

        <span class="c1"># t0 = time()</span>
        <span class="k">for</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span> <span class="ow">in</span> <span class="n">start_end_points</span><span class="p">:</span>
            <span class="n">mapobj</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="c1"># t1 = time()</span>
        <span class="c1"># if (t1 - t0) / 10 &gt; max_time:</span>
        <span class="c1">#     print(f&quot;Pathfinding for ({Xmax}x{Ymax}) grid slower &quot;</span>
        <span class="c1">#           f&quot;than expected {max_time}s.&quot;)</span>

    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
            <span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_grid_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gridsize</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">max_time</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test grid visualization performance for Nx, Ny grid for</span>
<span class="sd">        different visibility distances.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Xmax</span><span class="p">,</span> <span class="n">Ymax</span> <span class="o">=</span> <span class="n">gridsize</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid</span><span class="p">(</span><span class="n">Xmax</span><span class="p">,</span> <span class="n">Ymax</span><span class="p">)</span>
        <span class="n">mapobj</span> <span class="o">=</span> <span class="n">xymap</span><span class="o">.</span><span class="n">XYMap</span><span class="p">({</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">grid</span><span class="p">},</span> <span class="n">Z</span><span class="o">=</span><span class="s2">&quot;testmap&quot;</span><span class="p">)</span>
        <span class="n">mapobj</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

        <span class="c1"># t0 = time()</span>
        <span class="n">mapobj</span><span class="o">.</span><span class="n">calculate_path_matrix</span><span class="p">()</span>
        <span class="c1"># t1 = time()</span>
        <span class="c1"># print(f&quot;pathfinder matrix for grid {Xmax}x{Ymax}: {t1 - t0}s&quot;)</span>

        <span class="c1"># get random center points in grid and a range of targets to visualize the</span>
        <span class="c1"># path to</span>
        <span class="n">start_end_points</span> <span class="o">=</span> <span class="p">[((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">Xmax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Ymax</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span>  <span class="c1"># include max distance</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="n">start_end_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">((</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xmax</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ymax</span><span class="p">)),</span> <span class="p">(</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xmax</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Ymax</span><span class="p">)))</span>
            <span class="p">)</span>

        <span class="c1"># t0 = time()</span>
        <span class="k">for</span> <span class="n">coord</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">start_end_points</span><span class="p">:</span>
            <span class="n">mapobj</span><span class="o">.</span><span class="n">get_visual_range</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nodes&quot;</span><span class="p">,</span> <span class="n">character</span><span class="o">=</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span></div>

        <span class="c1"># t1 = time()</span>
        <span class="c1"># if (t1 - t0) / 10 &gt; max_time:</span>
        <span class="c1">#     print(f&quot;Visual Range calculation for ({Xmax}x{Ymax}) grid &quot;</span>
        <span class="c1">#           f&quot;slower than expected {max_time}s.&quot;)</span>


<div class="viewcode-block" id="TestXYZGrid">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestXYZGrid</span><span class="p">(</span><span class="n">BaseEvenniaTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test base grid class with a single map, including spawning objects.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">zcoord</span> <span class="o">=</span> <span class="s2">&quot;map1&quot;</span>

<div class="viewcode-block" id="TestXYZGrid.setUp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGrid.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">xyzgrid</span><span class="o">.</span><span class="n">XYZGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;testgrid&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_data1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP1</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zcoord</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">add_maps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_data1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXYZGrid.tearDown">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGrid.tearDown">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestXYZGrid.test_str_output">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGrid.test_str_output">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_str_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the display_map&quot;&quot;&quot;</span>
        <span class="n">xymap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">zcoord</span><span class="p">)</span>
        <span class="n">stripped_map</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">xymap</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">MAP1_DISPLAY</span><span class="p">,</span> <span class="n">stripped_map</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;||&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestXYZGrid.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGrid.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Spawn objects for the grid&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="c1"># import sys</span>
        <span class="c1"># sys.stderr.write(&quot;\nrooms: &quot; + repr(xyzroom.XYZRoom.objects.all()))</span>
        <span class="c1"># sys.stderr.write(&quot;\n\nexits: &quot; + repr(xyzroom.XYZExit.objects.all()) + &quot;\n&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">8</span><span class="p">)</span></div>
</div>



<span class="c1"># map transitions</span>
<div class="viewcode-block" id="Map12aTransition">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.Map12aTransition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Map12aTransition</span><span class="p">(</span><span class="n">xymap_legend</span><span class="o">.</span><span class="n">TransitionMapNode</span><span class="p">):</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>
    <span class="n">target_map_xyz</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;map12b&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Map12bTransition">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.Map12bTransition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Map12bTransition</span><span class="p">(</span><span class="n">xymap_legend</span><span class="o">.</span><span class="n">TransitionMapNode</span><span class="p">):</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>
    <span class="n">target_map_xyz</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;map12a&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="TestXYZGridTransition">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGridTransition">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestXYZGridTransition</span><span class="p">(</span><span class="n">BaseEvenniaTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test the XYZGrid class and transitions between maps.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestXYZGridTransition.setUp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGridTransition.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">xyzgrid</span><span class="o">.</span><span class="n">XYZGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;testgrid&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_data12a</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP12a</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map12a&quot;</span><span class="p">,</span> <span class="s2">&quot;legend&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="n">Map12aTransition</span><span class="p">}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_data12b</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP12b</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map12b&quot;</span><span class="p">,</span> <span class="s2">&quot;legend&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;T&quot;</span><span class="p">:</span> <span class="n">Map12bTransition</span><span class="p">}}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">add_maps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_data12a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_data12b</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXYZGridTransition.tearDown">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGridTransition.tearDown">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_shortest_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">,</span> <span class="n">expected_directions</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test shortest-path calculations throughout the grid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">directions</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">get_map</span><span class="p">(</span><span class="s2">&quot;map12a&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get_shortest_path</span><span class="p">(</span><span class="n">startcoord</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expected_directions</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">directions</span><span class="p">))</span>

<div class="viewcode-block" id="TestXYZGridTransition.test_spawn">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXYZGridTransition.test_spawn">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_spawn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Spawn the two maps into actual objects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>

        <span class="n">room1</span> <span class="o">=</span> <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;map12a&quot;</span><span class="p">))</span>
        <span class="n">room2</span> <span class="o">=</span> <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;map12b&quot;</span><span class="p">))</span>
        <span class="n">east_exit</span> <span class="o">=</span> <span class="p">[</span><span class="n">exi</span> <span class="k">for</span> <span class="n">exi</span> <span class="ow">in</span> <span class="n">room1</span><span class="o">.</span><span class="n">exits</span> <span class="k">if</span> <span class="n">exi</span><span class="o">.</span><span class="n">db_key</span> <span class="o">==</span> <span class="s2">&quot;east&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">west_exit</span> <span class="o">=</span> <span class="p">[</span><span class="n">exi</span> <span class="k">for</span> <span class="n">exi</span> <span class="ow">in</span> <span class="n">room2</span><span class="o">.</span><span class="n">exits</span> <span class="k">if</span> <span class="n">exi</span><span class="o">.</span><span class="n">db_key</span> <span class="o">==</span> <span class="s2">&quot;west&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># make sure exits traverse the maps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">east_exit</span><span class="o">.</span><span class="n">db_destination</span><span class="p">,</span> <span class="n">room2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">west_exit</span><span class="o">.</span><span class="n">db_destination</span><span class="p">,</span> <span class="n">room1</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestBuildExampleGrid">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestBuildExampleGrid">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestBuildExampleGrid</span><span class="p">(</span><span class="n">BaseEvenniaTest</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Test building the map-example (this takes about 30s)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestBuildExampleGrid.setUp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestBuildExampleGrid.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># build and populate grid</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">xyzgrid</span><span class="o">.</span><span class="n">XYZGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;testgrid&quot;</span><span class="p">)</span></div>


        <span class="c1"># def _log(msg):</span>
        <span class="c1">#     print(msg)</span>
        <span class="c1"># self.grid.log = _log</span>

<div class="viewcode-block" id="TestBuildExampleGrid.tearDown">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestBuildExampleGrid.tearDown">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestBuildExampleGrid.test_build">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestBuildExampleGrid.test_build">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_build</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build the map example.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mapdatas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">maps_from_module</span><span class="p">(</span><span class="s2">&quot;evennia.contrib.grid.xyzgrid.example&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mapdatas</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">add_maps</span><span class="p">(</span><span class="o">*</span><span class="n">mapdatas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>

        <span class="c1"># testing</span>
        <span class="n">room1a</span> <span class="o">=</span> <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;the large tree&quot;</span><span class="p">))</span>
        <span class="n">room1b</span> <span class="o">=</span> <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;the large tree&quot;</span><span class="p">))</span>
        <span class="n">room2a</span> <span class="o">=</span> <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;the small cave&quot;</span><span class="p">))</span>
        <span class="n">room2b</span> <span class="o">=</span> <span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;the small cave&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">room1a</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;Dungeon Entrance&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">room1a</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;To the east&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">room1b</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;A gorgeous view&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">room1b</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;The view from here is breathtaking,&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">room2a</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;The entrance&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">room2a</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;This is the entrance to&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">room2b</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;North-west corner of the atrium&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">room2b</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Sunlight sifts down&quot;</span><span class="p">))</span></div>
</div>



<span class="n">mock_room_callbacks</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>
<span class="n">mock_exit_callbacks</span> <span class="o">=</span> <span class="n">mock</span><span class="o">.</span><span class="n">MagicMock</span><span class="p">()</span>


<div class="viewcode-block" id="TestXyzRoom">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXyzRoom">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestXyzRoom</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZRoom</span><span class="p">):</span>
<div class="viewcode-block" id="TestXyzRoom.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXyzRoom.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mock_room_callbacks</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="TestXyzExit">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXyzExit">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestXyzExit</span><span class="p">(</span><span class="n">xyzroom</span><span class="o">.</span><span class="n">XYZExit</span><span class="p">):</span>
<div class="viewcode-block" id="TestXyzExit.at_object_creation">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestXyzExit.at_object_creation">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mock_exit_callbacks</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span></div>
</div>



<span class="n">MAP_DATA</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>

<span class="s2">    + 0 1</span>

<span class="s2">    0 #-#</span>

<span class="s2">    + 0 1</span>

<span class="s2">  &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="s2">&quot;map1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;prototypes&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">):</span> <span class="p">{</span>
            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;room&quot;</span><span class="p">,</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A room.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;xyz_room&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">):</span> <span class="p">{</span>
            <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A passage.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;xyz_exit&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;map_visual_range&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;map_mode&quot;</span><span class="p">:</span> <span class="s2">&quot;scan&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>


<div class="viewcode-block" id="TestCallbacks">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestCallbacks">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestCallbacks</span><span class="p">(</span><span class="n">BaseEvenniaTest</span><span class="p">):</span>
<div class="viewcode-block" id="TestCallbacks.setUp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestCallbacks.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="n">mock_room_callbacks</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span>
        <span class="n">mock_exit_callbacks</span><span class="o">.</span><span class="n">reset_mock</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestCallbacks.setup_grid">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestCallbacks.setup_grid">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">map_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">xyzgrid</span><span class="o">.</span><span class="n">XYZGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;testgrid&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_log</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">_log</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_data</span> <span class="o">=</span> <span class="n">map_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">add_maps</span><span class="p">(</span><span class="n">map_data</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestCallbacks.tearDown">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestCallbacks.tearDown">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestCallbacks.test_typeclassed_xyzroom_and_xyzexit_with_at_object_creation_are_called">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestCallbacks.test_typeclassed_xyzroom_and_xyzexit_with_at_object_creation_are_called">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_typeclassed_xyzroom_and_xyzexit_with_at_object_creation_are_called</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">map_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">MAP_DATA</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">prototype_key</span><span class="p">,</span> <span class="n">prototype_value</span> <span class="ow">in</span> <span class="n">map_data</span><span class="p">[</span><span class="s2">&quot;prototypes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prototype_key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">prototype_value</span><span class="p">[</span><span class="s2">&quot;typeclass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;evennia.contrib.grid.xyzgrid.tests.TestXyzRoom&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">prototype_key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">prototype_value</span><span class="p">[</span><span class="s2">&quot;typeclass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;evennia.contrib.grid.xyzgrid.tests.TestXyzExit&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_grid</span><span class="p">(</span><span class="n">map_data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span>

        <span class="c1"># Two rooms and 2 exits, Each one should have gotten one `at_object_creation` callback.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">mock_room_callbacks</span><span class="o">.</span><span class="n">at_object_creation</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="p">[</span><span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="p">(),</span> <span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="p">()]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">mock_exit_callbacks</span><span class="o">.</span><span class="n">at_object_creation</span><span class="o">.</span><span class="n">mock_calls</span><span class="p">,</span> <span class="p">[</span><span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="p">(),</span> <span class="n">mock</span><span class="o">.</span><span class="n">call</span><span class="p">()]</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestFlyDiveCommand">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestFlyDiveCommand">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TestFlyDiveCommand</span><span class="p">(</span><span class="n">BaseEvenniaCommandTest</span><span class="p">):</span>
<div class="viewcode-block" id="TestFlyDiveCommand.setUp">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestFlyDiveCommand.setUp">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">xyzgrid</span><span class="o">.</span><span class="n">XYZGrid</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;testgrid&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_data13a</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP13a</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">2</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_data13b</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP13b</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_data13c</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP13c</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map_data13d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;map&quot;</span><span class="p">:</span> <span class="n">MAP13d</span><span class="p">,</span> <span class="s2">&quot;zcoord&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>  <span class="c1"># not contiguous</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">add_maps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_data13a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_data13b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_data13c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_data13d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">spawn</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestFlyDiveCommand.tearDown">
<a class="viewcode-back" href="../../../../../api/evennia.contrib.grid.xyzgrid.tests.html#evennia.contrib.grid.xyzgrid.tests.TestFlyDiveCommand.tearDown">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></div>


    <span class="nd">@parameterized</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="c1"># startcoord, cmd, succeed?, endcoord</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;fly&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;dive&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;dive&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;dive&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;dive&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span>
            <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;dive&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">test_fly_and_dive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startcoord</span><span class="p">,</span> <span class="n">cmdstring</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test flying up and down and seeing if it works at different locations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">start_room</span> <span class="o">=</span> <span class="n">xyzgrid</span><span class="o">.</span><span class="n">XYZRoom</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_xyz</span><span class="p">(</span><span class="n">xyz</span><span class="o">=</span><span class="n">startcoord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char1</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">start_room</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">CmdFlyAndDive</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;You&quot;</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="s2">&quot;Can&#39;t&quot;</span><span class="p">,</span> <span class="n">cmdstring</span><span class="o">=</span><span class="n">cmdstring</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">char1</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">xyz</span><span class="p">,</span> <span class="n">endcoord</span><span class="p">)</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../../index.html">
              <img class="logo" src="../../../../../_static/evennia_logo.png" alt="Logo of Evennia"/>
            </a></p>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com/docs/latest/index.html">Documentation Top</a> </li>
  <li><a href="https://www.evennia.com">Evennia Home</a> </li>
  <li><a href="https://github.com/evennia/evennia">Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Blog</a>
  </li>
</ul>
<h3>Doc Versions</h3>
<ul>
  
    <li>
      <a href="https://www.evennia.com/docs/latest/index.html">latest (main branch)</a>
    </li>
  
  
    <li>
      <a href="https://www.evennia.com/docs/5.x/index.html">v5.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/4.x/index.html">v4.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/3.x/index.html">v3.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/2.x/index.html">v2.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/1.x/index.html">v1.0.0 branch (outdated)</a>
    </li>
  
    <li>
      <a href="https://www.evennia.com/docs/0.x/index.html">v0.9.5 branch (outdated)</a>
    </li>
  
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">Evennia</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../../evennia.html" >evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.grid.xyzgrid.tests</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>