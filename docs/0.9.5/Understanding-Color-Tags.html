
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Understanding Color Tags &#8212; Evennia 0.9.5 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial World Introduction" href="Tutorial-World-Introduction.html" />
    <link rel="prev" title="Building Quickstart" href="Building-Quickstart.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Tutorial-World-Introduction.html" title="Tutorial World Introduction"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Building-Quickstart.html" title="Building Quickstart"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Evennia 0.9.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Tutorials.html" accesskey="U">Tutorials</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Understanding Color Tags</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="understanding-color-tags">
<h1>Understanding Color Tags<a class="headerlink" href="#understanding-color-tags" title="Permalink to this headline">¶</a></h1>
<p>This tutorial aims at dispelling confusions regarding the use of color tags within Evennia.</p>
<p>Correct understanding of this topic requires having read the <a class="reference internal" href="TextTags.html"><span class="doc">TextTags</span></a> page and learned
Evennia’s color tags. Here we’ll explain by examples the reasons behind the unexpected (or
apparently incoherent) behaviors of some color tags, as mentioned <em>en passant</em> in the
<a class="reference internal" href="TextTags.html"><span class="doc">TextTags</span></a> page.</p>
<p>All you’ll need for this tutorial is access to a running instance of Evennia via a color-enabled
client. The examples provided are just commands that you can type in your client.</p>
</section>
<section id="evennia-ansi-and-xterm256">
<h1>Evennia, ANSI and Xterm256<a class="headerlink" href="#evennia-ansi-and-xterm256" title="Permalink to this headline">¶</a></h1>
<p>All modern MUD clients support colors; nevertheless, the standards to which all clients abide dates
back to old day of terminals, and when it comes to colors we are dealing with ANSI and Xterm256
standards.</p>
<p>Evennia handles transparently, behind the scenes, all the code required to enforce these
standards—so, if a user connects with a client which doesn’t support colors, or supports only ANSI
(16 colors), Evennia will take all due steps to ensure that the output will be adjusted to look
right at the client side.</p>
<p>As for you, the developer, all you need to care about is knowing how to correctly use the color tags
within your MUD. Most likely, you’ll be adding colors to help pages, descriptions, automatically
generated text, etc.</p>
<p>You are free to mix together ANSI and Xterm256 color tags, but you should be aware of a few
pitfalls. ANSI and Xterm256 coexist without conflicts in Evennia, but in many ways they don’t «see»
each other: ANSI-specific color tags will have no effect on Xterm-defined colors, as we shall see
here.</p>
</section>
<section id="ansi">
<h1>ANSI<a class="headerlink" href="#ansi" title="Permalink to this headline">¶</a></h1>
<p>ANSI has a set of 16 colors, to be more precise: ANSI has 8 basic colors which come in <em>dark</em> and
<em>bright</em> flavours—with <em>dark</em> being <em>normal</em>. The colors are: red, green, yellow, blue, magenta,
cyan, white and black. White in its dark version is usually referred to as gray, and black in its
bright version as darkgray. Here, for sake of simplicity they’ll be referred to as dark and bright:
bright/dark black, bright/dark white.</p>
<p>The default colors of MUD clients is normal (dark) white on normal black (ie: gray on black).</p>
<p>It’s important to grasp that in the ANSI standard bright colors apply only to text (foreground), not
to background. Evennia allows to bypass this limitation via Xterm256, but doing so will impact the
behavior of ANSI tags, as we shall see.</p>
<p>Also, it’s important to remember that the 16 ANSI colors are a convention, and the final user can
always customize their appearance—he might decide to have green show as red, and dark green as blue,
etc.</p>
</section>
<section id="xterm256">
<h1>Xterm256<a class="headerlink" href="#xterm256" title="Permalink to this headline">¶</a></h1>
<p>The 16 colors of ANSI should be more than enough to handle simple coloring of text. But when an
author wants to be sure that a given color will show as he intended it, she might choose to rely on
Xterm256 colors.</p>
<p>Xterm256 doesn’t rely on a palette of named colors, it instead represent colors by their values. So,
a red color could be <code class="docutils literal notranslate"><span class="pre">|[500</span></code> (bright and pure red), or <code class="docutils literal notranslate"><span class="pre">|[300</span></code> (darker red), and so on.</p>
</section>
<section id="ansi-color-tags-in-evennia">
<h1>ANSI Color Tags in Evennia<a class="headerlink" href="#ansi-color-tags-in-evennia" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>NOTE: for ease of reading, the examples contain extra white spaces after the
color tags (eg: <code class="docutils literal notranslate"><span class="pre">|g</span> <span class="pre">green</span> <span class="pre">|b</span> <span class="pre">blue</span></code> ). This is done only so that it’s easier
to see the tags separated from their context; it wouldn’t be good practice
in real-life coding.</p>
</div></blockquote>
<p>Let’s proceed by examples. In your MUD client type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">say</span> <span class="n">Normal</span> <span class="o">|*</span> <span class="n">Negative</span>
</pre></div>
</div>
<p>Evennia should output the word “Normal” normally (ie: gray on black) and “Negative” in reversed
colors (ie: black on gray).</p>
<p>This is pretty straight forward, the <code class="docutils literal notranslate"><span class="pre">|*</span></code> ANSI <em>invert</em> tag switches between foreground and
background—from now on, <strong>FG</strong> and <strong>BG</strong> shorthands will be used to refer to foreground and
background.</p>
<p>But take mental note of this: <code class="docutils literal notranslate"><span class="pre">|*</span></code> has switched <em>dark white</em> and <em>dark black</em>.</p>
<p>Now try this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">say</span> <span class="o">|</span><span class="n">w</span> <span class="n">Bright</span> <span class="n">white</span> <span class="n">FG</span> <span class="o">|*</span> <span class="n">Negative</span>
</pre></div>
</div>
<p>You’ll notice that the word “Negative” is not black on white, it’s darkgray on gray. Why is this?
Shouldn’t it be black text on a white BG? Two things are happening here.</p>
<p>As mentioned, ANSI has 8 base colors, the dark ones. The bright ones are achieved by means of
<em>highlighting</em> the base/dark/normal colors, and they only apply to FG.</p>
<p>What happened here is that when we set the bright white FG with <code class="docutils literal notranslate"><span class="pre">|w</span></code>, Evennia translated this into
the ANSI sequence of Highlight On + White FG. In terms of Evennia’s color tags, it’s as if we typed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>say |h|!W Bright white FG |* Negative
</pre></div>
</div>
<p>Furthermore, the Highlight-On property (which only works for BG!) is preserved after the FG/BG
switch, this being the reason why we see black as darkgray: highlighting makes it <em>bright black</em>
(ie: darkgray).</p>
<p>As for the BG being also grey, that is normal—ie: you are seeing <em>normal white</em> (ie: dark white =
gray). Remember that since there are no bright BG colors, the ANSI <code class="docutils literal notranslate"><span class="pre">|*</span></code> tag will transpose any FG
color in its normal/dark version. So here the FG’s bright white became dark white in the BG! In
reality, it was always normal/dark white, except that in the FG is seen as bright because of the
highlight tag behind the scenes.</p>
<p>Let’s try the same thing with some color:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">say</span> <span class="o">|</span><span class="n">m</span> <span class="o">|</span><span class="p">[</span><span class="n">G</span> <span class="n">Bright</span> <span class="n">Magenta</span> <span class="n">on</span> <span class="n">Dark</span> <span class="n">Green</span> <span class="o">|*</span> <span class="n">Negative</span>
</pre></div>
</div>
<p>Again, the BG stays dark because of ANSI rules, and the FG stays bright because of the implicit <code class="docutils literal notranslate"><span class="pre">|h</span></code>
in <code class="docutils literal notranslate"><span class="pre">|m</span></code>.</p>
<p>Now, let’s see what happens if we set a bright BG and then invert—yes, Evennia kindly allows us to
do it, even if it’s not within ANSI expectations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">say</span> <span class="o">|</span><span class="p">[</span><span class="n">b</span> <span class="n">Dark</span> <span class="n">White</span> <span class="n">on</span> <span class="n">Bright</span> <span class="n">Blue</span> <span class="o">|*</span> <span class="n">Negative</span>
</pre></div>
</div>
<p>Before color inversion, the BG does show in bright blue, and after inversion (as expected) it’s
<em>dark white</em> (gray). The bright blue of the BG survived the inversion and gave us a bright blue FG.
This behavior is tricky though, and not as simple as it might look.</p>
<p>If the inversion were to be pure ANSI, the bright blue would have been accounted just as normal
blue, and should have converted to normal blue in the FG (after all, there was no highlighting on).
The fact is that in reality this color is not bright blue at all, it just an Xterm version of it!</p>
<p>To demonstrate this, type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">say</span> <span class="o">|</span><span class="p">[</span><span class="n">b</span> <span class="n">Dark</span> <span class="n">White</span> <span class="n">on</span> <span class="n">Bright</span> <span class="n">Blue</span> <span class="o">|*</span> <span class="n">Negative</span> <span class="o">|</span><span class="n">H</span> <span class="n">un</span><span class="o">-</span><span class="n">bright</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">|H</span></code> Highlight-Off tag should have turned <em>dark blue</em> the last word; but it didn’t because it
couldn’t: in order to enforce the non-ANSI bright BG Evennia turned to Xterm, and Xterm entities are
not affected by ANSI tags!</p>
<p>So, we are getting at the heart of all confusions and possible odd-behaviors pertaining color tags
in Evennia: apart from Evennia’s translations from- and to- ANSI/Xterm, the two systems are
independent and transparent to each other.</p>
<p>The bright blue of the previous example was just an Xterm representation of the ANSI standard blue.
Try to change the default settings of your client, so that blue shows as some other color, you’ll
then realize the difference when Evennia is sending a true ANSI color (which will show up according
to your settings) and when instead it’s sending an Xterm representation of that color (which will
show up always as defined by Evennia).</p>
<p>You’ll have to keep in mind that the presence of an Xterm BG or FG color might affect the way your
tags work on the text. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>say |[b Bright Blue BG |* Negative |!Y Dark Yellow |h not bright
</pre></div>
</div>
<p>Here the <code class="docutils literal notranslate"><span class="pre">|h</span></code> tag no longer affects the FG color. Even though it was changed via the <code class="docutils literal notranslate"><span class="pre">|!</span></code> tag, the
ANSI system is out-of-tune because of the intrusion of an Xterm color (bright blue BG, then moved to
FG with <code class="docutils literal notranslate"><span class="pre">|*</span></code>).</p>
<p>All unexpected ANSI behaviours are the result of mixing Xterm colors (either on purpose or either
via bright BG colors). The <code class="docutils literal notranslate"><span class="pre">|n</span></code> tag will restore things in place and ANSI tags will respond properly
again. So, at the end is just an issue of being mindful when using Xterm colors or bright BGs, and
avoid wild mixing them with ANSI tags without normalizing (<code class="docutils literal notranslate"><span class="pre">|n</span></code>) things again.</p>
<p>Try this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>say |[b Bright Blue BG |* Negative |!R Red FG
</pre></div>
</div>
<p>And then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>say |[B Dark Blue BG |* Negative |!R Red BG??
</pre></div>
</div>
<p>In this second example the <code class="docutils literal notranslate"><span class="pre">|!</span></code> changes the BG color instead of the FG! In fact, the odd behavior is
the one from the former example, non the latter. When you invert FG and BG with <code class="docutils literal notranslate"><span class="pre">|*</span></code> you actually
inverting their references. This is why the last example (which has a normal/dark BG!) allows <code class="docutils literal notranslate"><span class="pre">|!</span></code>
to change the BG color. In the first example, it’s again the presence of an Xterm color (bright blue
BG) which changes the default behavior.</p>
<p>Try this:</p>
<p><code class="docutils literal notranslate"><span class="pre">say</span> <span class="pre">Normal</span> <span class="pre">|*</span> <span class="pre">Negative</span> <span class="pre">|!R</span> <span class="pre">Red</span> <span class="pre">BG</span></code></p>
<p>This is the normal behavior, and as you can see it allows <code class="docutils literal notranslate"><span class="pre">|!</span></code> to change BG color after the
inversion of FG and BG.</p>
<p>As long as you have an understanding of how ANSI works, it should be easy to handle color tags
avoiding the pitfalls of Xterm-ANSI promisquity.</p>
<p>One last example:</p>
<p><code class="docutils literal notranslate"><span class="pre">say</span> <span class="pre">Normal</span> <span class="pre">|*</span> <span class="pre">Negative</span> <span class="pre">|*</span> <span class="pre">still</span> <span class="pre">Negative</span></code></p>
<p>Shows that <code class="docutils literal notranslate"><span class="pre">|*</span></code> only works once in a row and will not (and should not!) revert back if used again.
Nor it will have any effect until the <code class="docutils literal notranslate"><span class="pre">|n</span></code> tag is called to “reset” ANSI back to normal. This is how
it is meant to work.</p>
<p>ANSI operates according to a simple states-based mechanism, and it’s important to understand the
positive effect of resetting with the <code class="docutils literal notranslate"><span class="pre">|n</span></code> tag, and not try to
push it over the limit, so to speak.</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/evennia_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<p><h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Understanding Color Tags</a></li>
<li><a class="reference internal" href="#evennia-ansi-and-xterm256">Evennia, ANSI and Xterm256</a></li>
<li><a class="reference internal" href="#ansi">ANSI</a></li>
<li><a class="reference internal" href="#xterm256">Xterm256</a></li>
<li><a class="reference internal" href="#ansi-color-tags-in-evennia">ANSI Color Tags in Evennia</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="Building-Quickstart.html"
                        title="previous chapter">Building Quickstart</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Tutorial-World-Introduction.html"
                        title="next chapter">Tutorial World Introduction</a></p>
  <div role="note" aria-label="source link">
    <!--h3>This Page</h3-->
    <ul class="this-page-menu">
      <li><a href="_sources/Understanding-Color-Tags.md.txt"
            rel="nofollow">Show Page Source</a></li>
    </ul>
   </div><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com">Home page</a> </li>
  <li><a href="https://github.com/evennia/evennia">Evennia Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Dev blog</a>
  </li>
</ul>
<h3>Versions</h3>
<ul>
  <li><a href="../1.0-dev/index.html">1.0-dev (develop branch)</a></li>
  <li><a href="Understanding-Color-Tags.html">0.9.5 (v0.9.5 branch)</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Tutorial-World-Introduction.html" title="Tutorial World Introduction"
             >next</a> |</li>
        <li class="right" >
          <a href="Building-Quickstart.html" title="Building Quickstart"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Evennia 0.9.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Tutorials.html" >Tutorials</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Understanding Color Tags</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>