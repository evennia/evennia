
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>evennia.contrib.tutorial_world.objects &#8212; Evennia 0.9.5 documentation</title>
    <link rel="stylesheet" href="../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">Evennia 0.9.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../evennia.html" accesskey="U">evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorial_world.objects</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evennia.contrib.tutorial_world.objects</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">TutorialWorld - basic objects - Griatch 2011</span>

<span class="sd">This module holds all &quot;dead&quot; object definitions for</span>
<span class="sd">the tutorial world. Object-commands and -cmdsets</span>
<span class="sd">are also defined here, together with the object.</span>

<span class="sd">Objects:</span>

<span class="sd">TutorialObject</span>

<span class="sd">TutorialReadable</span>
<span class="sd">TutorialClimbable</span>
<span class="sd">Obelisk</span>
<span class="sd">LightSource</span>
<span class="sd">CrumblingWall</span>
<span class="sd">TutorialWeapon</span>
<span class="sd">TutorialWeaponRack</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">evennia</span> <span class="kn">import</span> <span class="n">DefaultObject</span><span class="p">,</span> <span class="n">DefaultExit</span><span class="p">,</span> <span class="n">Command</span><span class="p">,</span> <span class="n">CmdSet</span>
<span class="kn">from</span> <span class="nn">evennia.utils</span> <span class="kn">import</span> <span class="n">search</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">dedent</span>
<span class="kn">from</span> <span class="nn">evennia.prototypes.spawner</span> <span class="kn">import</span> <span class="n">spawn</span>

<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># TutorialObject</span>
<span class="c1">#</span>
<span class="c1"># The TutorialObject is the base class for all items</span>
<span class="c1"># in the tutorial. They have an attribute &quot;tutorial_info&quot;</span>
<span class="c1"># on them that the global tutorial command can use to extract</span>
<span class="c1"># interesting behind-the scenes information about the object.</span>
<span class="c1">#</span>
<span class="c1"># TutorialObjects may also be &quot;reset&quot;. What the reset means</span>
<span class="c1"># is up to the object. It can be the resetting of the world</span>
<span class="c1"># itself, or the removal of an inventory item from a</span>
<span class="c1"># character&#39;s inventory when leaving the tutorial, for example.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="TutorialObject"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialObject">[docs]</a><span class="k">class</span> <span class="nc">TutorialObject</span><span class="p">(</span><span class="n">DefaultObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is the baseclass for all objects in the tutorial.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TutorialObject.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialObject.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when the object is first created.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="s2">&quot;No tutorial info is available for this object.&quot;</span></div>

<div class="viewcode-block" id="TutorialObject.reset"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialObject.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets the object, whatever that may mean.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span></div></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Readable - an object that can be &quot;read&quot;</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>

<span class="c1">#</span>
<span class="c1"># Read command</span>
<span class="c1">#</span>


<div class="viewcode-block" id="CmdRead"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdRead">[docs]</a><span class="k">class</span> <span class="nc">CmdRead</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">      read [obj]</span>

<span class="sd">    Read some text of a readable object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;read&quot;</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdRead.func"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdRead.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements the read command. This simply looks for an</span>
<span class="sd">        Attribute &quot;readable_text&quot; on the object and displays that.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># we want an attribute read_text to be defined.</span>
        <span class="n">readtext</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">readable_text</span>
        <span class="k">if</span> <span class="n">readtext</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;You read |C</span><span class="si">%s</span><span class="s2">|n:</span><span class="se">\n</span><span class="s2">  </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">readtext</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;There is nothing to read on </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdSetReadable"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetReadable">[docs]</a><span class="k">class</span> <span class="nc">CmdSetReadable</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A CmdSet for readables.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CmdSetReadable.at_cmdset_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetReadable.at_cmdset_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when the cmdset is created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdRead</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="TutorialReadable"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialReadable">[docs]</a><span class="k">class</span> <span class="nc">TutorialReadable</span><span class="p">(</span><span class="n">TutorialObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This simple object defines some attributes and</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TutorialReadable.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialReadable.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when object is created. We make sure to set the needed</span>
<span class="sd">        Attribute and add the readable cmdset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;This is an object with a &#39;read&#39; command defined in a command set on itself.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">readable_text</span> <span class="o">=</span> <span class="s2">&quot;There is no text written on </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
        <span class="c1"># define a command on the object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="n">CmdSetReadable</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Climbable object</span>
<span class="c1">#</span>
<span class="c1"># The climbable object works so that once climbed, it sets</span>
<span class="c1"># a flag on the climber to show that it was climbed. A simple</span>
<span class="c1"># command &#39;climb&#39; handles the actual climbing. The memory</span>
<span class="c1"># of what was last climbed is used in a simple puzzle in the</span>
<span class="c1"># tutorial.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="CmdClimb"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdClimb">[docs]</a><span class="k">class</span> <span class="nc">CmdClimb</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Climb an object</span>

<span class="sd">    Usage:</span>
<span class="sd">      climb &lt;object&gt;</span>

<span class="sd">    This allows you to climb.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;climb&quot;</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdClimb.func"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdClimb.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements function&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;What do you want to climb?&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Try as you might, you cannot climb that.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ostring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">climb_text</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ostring</span><span class="p">:</span>
            <span class="n">ostring</span> <span class="o">=</span> <span class="s2">&quot;You climb </span><span class="si">%s</span><span class="s2">. Having looked around, you climb down again.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">ostring</span><span class="p">)</span>
        <span class="c1"># set a tag on the caller to remember that we climbed.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;tutorial_climbed_tree&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;tutorial_world&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdSetClimbable"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetClimbable">[docs]</a><span class="k">class</span> <span class="nc">CmdSetClimbable</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Climbing cmdset&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CmdSetClimbable.at_cmdset_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetClimbable.at_cmdset_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;populate set&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdClimb</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="TutorialClimbable"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialClimbable">[docs]</a><span class="k">class</span> <span class="nc">TutorialClimbable</span><span class="p">(</span><span class="n">TutorialObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A climbable object. All that is special about it is that it has</span>
<span class="sd">    the &quot;climb&quot; command available on it.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TutorialClimbable.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialClimbable.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called at initial creation only&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="n">CmdSetClimbable</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Obelisk - a unique item</span>
<span class="c1">#</span>
<span class="c1"># The Obelisk is an object with a modified return_appearance method</span>
<span class="c1"># that causes it to look slightly different every time one looks at it.</span>
<span class="c1"># Since what you actually see is a part of a game puzzle, the act of</span>
<span class="c1"># looking also stores a key attribute on the looking object (different</span>
<span class="c1"># depending on which text you saw) for later reference.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="Obelisk"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.Obelisk">[docs]</a><span class="k">class</span> <span class="nc">Obelisk</span><span class="p">(</span><span class="n">TutorialObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object changes its description randomly, and which is shown</span>
<span class="sd">    determines which order &quot;clue id&quot; is stored on the Character for</span>
<span class="sd">    future puzzles.</span>

<span class="sd">    Important Attribute:</span>
<span class="sd">       puzzle_descs (list): list of descriptions. One of these is</span>
<span class="sd">        picked randomly when this object is looked at and its index</span>
<span class="sd">        in the list is used as a key for to solve the puzzle.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Obelisk.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.Obelisk.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when object is created.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;This object changes its desc randomly, and makes sure to remember which one you saw.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">puzzle_descs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;You see a normal stone slab&quot;</span><span class="p">]</span>
        <span class="c1"># make sure this can never be picked up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;get:false()&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Obelisk.return_appearance"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.Obelisk.return_appearance">[docs]</a>    <span class="k">def</span> <span class="nf">return_appearance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This hook is called by the look command to get the description</span>
<span class="sd">        of the object. We overload it with our own version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># randomly get the index for one of the descriptions</span>
        <span class="n">descs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">puzzle_descs</span>
        <span class="n">clueindex</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">descs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># set this description, with the random extra</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;The surface of the obelisk seem to waver, shift and writhe under your gaze, with &quot;</span>
            <span class="s2">&quot;different scenes and structures appearing whenever you look at it. &quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="n">string</span> <span class="o">+</span> <span class="n">descs</span><span class="p">[</span><span class="n">clueindex</span><span class="p">]</span>
        <span class="c1"># remember that this was the clue we got. The Puzzle room will</span>
        <span class="c1"># look for this later to determine if you should be teleported</span>
        <span class="c1"># or not.</span>
        <span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">puzzle_clue</span> <span class="o">=</span> <span class="n">clueindex</span>
        <span class="c1"># call the parent function as normal (this will use</span>
        <span class="c1"># the new desc Attribute we just set)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">return_appearance</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span></div></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># LightSource</span>
<span class="c1">#</span>
<span class="c1"># This object emits light. Once it has been turned on it</span>
<span class="c1"># cannot be turned off. When it burns out it will delete</span>
<span class="c1"># itself.</span>
<span class="c1">#</span>
<span class="c1"># This could be implemented using a single-repeat Script or by</span>
<span class="c1"># registering with the TickerHandler. We do it simpler by</span>
<span class="c1"># using the delay() utility function. This is very simple</span>
<span class="c1"># to use but does not survive a server @reload. Because of</span>
<span class="c1"># where the light matters (in the Dark Room where you can</span>
<span class="c1"># find new light sources easily), this is okay here.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="CmdLight"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdLight">[docs]</a><span class="k">class</span> <span class="nc">CmdLight</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates light where there was none. Something to burn.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;on&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;burn&quot;</span><span class="p">]</span>
    <span class="c1"># only allow this command if command.obj is carried by caller.</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:holds()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdLight.func"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdLight.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements the light command. Since this command is designed</span>
<span class="sd">        to sit on a &quot;lightable&quot; object, we operate only on self.obj.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">light</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You light </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> lights </span><span class="si">%s</span><span class="s2">!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">),</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is already burning.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdSetLight"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetLight">[docs]</a><span class="k">class</span> <span class="nc">CmdSetLight</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;CmdSet for the lightsource commands&quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;lightsource_cmdset&quot;</span>
    <span class="c1"># this is higher than the dark cmdset - important!</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">3</span>

<div class="viewcode-block" id="CmdSetLight.at_cmdset_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetLight.at_cmdset_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;called at cmdset creation&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdLight</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="LightSource"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.LightSource">[docs]</a><span class="k">class</span> <span class="nc">LightSource</span><span class="p">(</span><span class="n">TutorialObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This implements a light source object.</span>

<span class="sd">    When burned out, the object will be deleted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LightSource.at_init"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.LightSource.at_init">[docs]</a>    <span class="k">def</span> <span class="nf">at_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If this is called with the Attribute is_giving_light already</span>
<span class="sd">        set, we know that the timer got killed by a server</span>
<span class="sd">        reload/reboot before it had time to finish. So we kill it here</span>
<span class="sd">        instead. This is the price we pay for the simplicity of the</span>
<span class="sd">        non-persistent delay() method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_giving_light</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span></div>

<div class="viewcode-block" id="LightSource.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.LightSource.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when object is first created.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">tutorial_info</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;This object can be lit to create light. It has a timeout for how long it burns.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_giving_light</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">burntime</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">3</span>  <span class="c1"># 3 minutes</span>
        <span class="c1"># this is the default desc, it can of course be customized</span>
        <span class="c1"># when created.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;A splinter of wood with remnants of resin on it, enough for burning.&quot;</span>
        <span class="c1"># add the Light command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="n">CmdSetLight</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_burnout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called when this light source burns out. We make no</span>
<span class="sd">        use of the return value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># delete ourselves from the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_giving_light</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&#39;s </span><span class="si">%s</span><span class="s2"> flickers and dies.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">),</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Your </span><span class="si">%s</span><span class="s2"> flickers and dies.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="s2">&quot;A </span><span class="si">%s</span><span class="s2"> on the floor flickers and dies.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># Mainly happens if we happen to be in a None location</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<div class="viewcode-block" id="LightSource.light"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.LightSource.light">[docs]</a>    <span class="k">def</span> <span class="nf">light</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Light this object - this is called by Light command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_giving_light</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># burn for 3 minutes before calling _burnout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">is_giving_light</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># if we are in a dark room, trigger its light check</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># maybe we are directly in the room</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">check_light_state</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="c1"># we are in a None location</span>
                <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># start the burn timer. When it runs out, self._burnout</span>
            <span class="c1"># will be called. We store the deferred so it can be</span>
            <span class="c1"># killed in unittesting.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deferred</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_burnout</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Crumbling wall - unique exit</span>
<span class="c1">#</span>
<span class="c1"># This implements a simple puzzle exit that needs to be</span>
<span class="c1"># accessed with commands before one can get to traverse it.</span>
<span class="c1">#</span>
<span class="c1"># The puzzle-part is simply to move roots (that have</span>
<span class="c1"># presumably covered the wall) aside until a button for a</span>
<span class="c1"># secret door is revealed. The original position of the</span>
<span class="c1"># roots blocks the button, so they have to be moved to a certain</span>
<span class="c1"># position - when they have, the &quot;press button&quot; command</span>
<span class="c1"># is made available and the Exit is made traversable.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>

<span class="c1"># There are four roots - two horizontal and two vertically</span>
<span class="c1"># running roots. Each can have three positions: top/middle/bottom</span>
<span class="c1"># and left/middle/right respectively. There can be any number of</span>
<span class="c1"># roots hanging through the middle position, but only one each</span>
<span class="c1"># along the sides. The goal is to make the center position clear.</span>
<span class="c1"># (yes, it&#39;s really as simple as it sounds, just move the roots</span>
<span class="c1"># to each side to &quot;win&quot;. This is just a tutorial, remember?)</span>
<span class="c1">#</span>
<span class="c1"># The ShiftRoot command depends on the root object having an</span>
<span class="c1"># Attribute root_pos (a dictionary) to describe the current</span>
<span class="c1"># position of the roots.</span>


<div class="viewcode-block" id="CmdShiftRoot"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdShiftRoot">[docs]</a><span class="k">class</span> <span class="nc">CmdShiftRoot</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shifts roots around.</span>

<span class="sd">    Usage:</span>
<span class="sd">      shift blue root left/right</span>
<span class="sd">      shift red root left/right</span>
<span class="sd">      shift yellow root up/down</span>
<span class="sd">      shift green root up/down</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;shift&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;shiftroot&quot;</span><span class="p">,</span> <span class="s2">&quot;push&quot;</span><span class="p">,</span> <span class="s2">&quot;pull&quot;</span><span class="p">,</span> <span class="s2">&quot;move&quot;</span><span class="p">]</span>
    <span class="c1"># we only allow to use this command while the</span>
    <span class="c1"># room is properly lit, so we lock it to the</span>
    <span class="c1"># setting of Attribute &quot;is_lit&quot; on our location.</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:locattr(is_lit)&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdShiftRoot.parse"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdShiftRoot.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Custom parser; split input by spaces for simplicity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arglist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span></div>

<div class="viewcode-block" id="CmdShiftRoot.func"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdShiftRoot.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the command.</span>
<span class="sd">          blue/red - vertical roots</span>
<span class="sd">          yellow/green - horizontal roots</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">arglist</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;What do you want to move, and in what direction?&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s2">&quot;root&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">arglist</span><span class="p">:</span>
            <span class="c1"># we clean out the use of the word &quot;root&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arglist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>

        <span class="c1"># we accept arguments on the form &lt;color&gt; &lt;direction&gt;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arglist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s2">&quot;You must define which colour of root you want to move, and in which direction.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arglist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arglist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># get current root positions dict</span>
        <span class="n">root_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">root_pos</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">root_pos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;No such root to move.&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># first, vertical roots (red/blue) - can be moved left/right</span>
        <span class="k">if</span> <span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shift the reddish root to the left.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                        <span class="s2">&quot;The root with blue flowers gets in the way and is pushed to the right.&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shove the reddish root to the right.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                        <span class="s2">&quot;The root with blue flowers gets in the way and is pushed to the left.&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                    <span class="s2">&quot;The root hangs straight down - you can only move it left or right.&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;left&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shift the root with small blue flowers to the left.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                        <span class="s2">&quot;The reddish root is too big to fit as well, so that one falls away to the left.&quot;</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;right&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shove the root adorned with small blue flowers to the right.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                        <span class="s2">&quot;The thick reddish root gets in the way and is pushed back to the left.&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                    <span class="s2">&quot;The root hangs straight down - you can only move it left or right.&quot;</span>
                <span class="p">)</span>

        <span class="c1"># now the horizontal roots (yellow/green). They can be moved up/down</span>
        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;yellow&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shift the root with small yellow flowers upwards.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The green weedy root falls down.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shove the root adorned with small yellow flowers downwards.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;green&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The weedy green root is shifted upwards to make room.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The root hangs across the wall - you can only move it up or down.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;up&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shift the weedy green root upwards.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;yellow&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;yellow&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The root with yellow flowers falls down.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;You shove the weedy green root downwards.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">root_pos</span><span class="p">[</span><span class="n">color</span><span class="p">]</span> <span class="o">==</span> <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;yellow&quot;</span><span class="p">]:</span>
                    <span class="n">root_pos</span><span class="p">[</span><span class="s2">&quot;yellow&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                        <span class="s2">&quot;The root with yellow flowers gets in the way and is pushed upwards.&quot;</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The root hangs across the wall - you can only move it up or down.&quot;</span><span class="p">)</span>

        <span class="c1"># we have moved the root. Store new position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">root_pos</span> <span class="o">=</span> <span class="n">root_pos</span>

        <span class="c1"># Check victory condition</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">root_pos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># no roots in middle position</span>
            <span class="c1"># This will affect the cmd: lock of CmdPressButton</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">button_exposed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Holding aside the root you think you notice something behind it ...&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdPressButton"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdPressButton">[docs]</a><span class="k">class</span> <span class="nc">CmdPressButton</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Presses a button.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;press&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;press button&quot;</span><span class="p">,</span> <span class="s2">&quot;button&quot;</span><span class="p">,</span> <span class="s2">&quot;push button&quot;</span><span class="p">]</span>
    <span class="c1"># only accessible if the button was found and there is light. This checks</span>
    <span class="c1"># the Attribute button_exposed on the Wall object so that</span>
    <span class="c1"># you can only push the button when the puzzle is solved. It also</span>
    <span class="c1"># checks the is_lit Attribute on the location.</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:objattr(button_exposed) and objlocattr(is_lit)&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdPressButton.func"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdPressButton.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements the command&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">crumbling_wall_found_exit</span><span class="p">:</span>
            <span class="c1"># we already pushed the button</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s2">&quot;The button folded away when the secret passage opened. You cannot push it again.&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># pushing the button</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;You move your fingers over the suspicious depression, then gives it a &quot;</span>
            <span class="s2">&quot;decisive push. First nothing happens, then there is a rumble and a hidden &quot;</span>
            <span class="s2">&quot;|wpassage|n opens, dust and pebbles rumbling as part of the wall moves aside.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> moves their fingers over the suspicious depression, then gives it a &quot;</span>
            <span class="s2">&quot;decisive push. First nothing happens, then there is a rumble and a hidden &quot;</span>
            <span class="s2">&quot;|wpassage|n opens, dust and pebbles rumbling as part of the wall moves aside.&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="n">string</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">open_wall</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The exit leads nowhere, there&#39;s just more stone behind it ...&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdSetCrumblingWall"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetCrumblingWall">[docs]</a><span class="k">class</span> <span class="nc">CmdSetCrumblingWall</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Group the commands for crumblingWall&quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;crumblingwall_cmdset&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">2</span>

<div class="viewcode-block" id="CmdSetCrumblingWall.at_cmdset_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetCrumblingWall.at_cmdset_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;called when object is first created.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdShiftRoot</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdPressButton</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="CrumblingWall"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall">[docs]</a><span class="k">class</span> <span class="nc">CrumblingWall</span><span class="p">(</span><span class="n">TutorialObject</span><span class="p">,</span> <span class="n">DefaultExit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a custom Exit.</span>

<span class="sd">    The CrumblingWall can be examined in various ways, but only if a</span>
<span class="sd">    lit light source is in the room. The traversal itself is blocked</span>
<span class="sd">    by a traverse: lock on the exit that only allows passage if a</span>
<span class="sd">    certain attribute is set on the trying account.</span>

<span class="sd">    Important attribute</span>
<span class="sd">     destination - this property must be set to make this a valid exit</span>
<span class="sd">                   whenever the button is pushed (this hides it as an exit</span>
<span class="sd">                   until it actually is)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CrumblingWall.at_init"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall.at_init">[docs]</a>    <span class="k">def</span> <span class="nf">at_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when object is recalled from cache.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>

<div class="viewcode-block" id="CrumblingWall.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;called when the object is first created.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="s2">&quot;secret passage&quot;</span><span class="p">,</span> <span class="s2">&quot;passage&quot;</span><span class="p">,</span> <span class="s2">&quot;crack&quot;</span><span class="p">,</span> <span class="s2">&quot;opening&quot;</span><span class="p">,</span> <span class="s2">&quot;secret&quot;</span><span class="p">])</span>

        <span class="c1"># starting root positions. H1/H2 are the horizontally hanging roots,</span>
        <span class="c1"># V1/V2 the vertically hanging ones. Each can have three positions:</span>
        <span class="c1"># (-1, 0, 1) where 0 means the middle position. yellow/green are</span>
        <span class="c1"># horizontal roots and red/blue vertical, all may have value 0, but n</span>
        <span class="c1"># ever any other identical value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">root_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>

        <span class="c1"># flags controlling the puzzle victory conditions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">button_exposed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">exit_open</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># this is not even an Exit until it has a proper destination, and we won&#39;t assign</span>
        <span class="c1"># that until it is actually open. Until then we store the destination here. This</span>
        <span class="c1"># should be given a reasonable value at creation!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="s2">&quot;#2&quot;</span>

        <span class="c1"># we lock this Exit so that one can only execute commands on it</span>
        <span class="c1"># if its location is lit and only traverse it once the Attribute</span>
        <span class="c1"># exit_open is set to True.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;cmd:locattr(is_lit);traverse:objattr(exit_open)&quot;</span><span class="p">)</span>
        <span class="c1"># set cmdset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdSetCrumblingWall</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="CrumblingWall.open_wall"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall.open_wall">[docs]</a>    <span class="k">def</span> <span class="nf">open_wall</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called by the push button command once the puzzle</span>
<span class="sd">        is solved. It opens the wall and sets a timer for it to reset</span>
<span class="sd">        itself.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># this will make it into a proper exit (this returns a list)</span>
        <span class="n">eloc</span> <span class="o">=</span> <span class="n">search</span><span class="o">.</span><span class="n">search_object</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">destination</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">eloc</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="n">eloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">exit_open</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># start a 45 second timer before closing again. We store the deferred so it can be</span>
        <span class="c1"># killed in unittesting.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deferred</span> <span class="o">=</span> <span class="n">delay</span><span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_translate_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">ipos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translates the position into words&quot;&quot;&quot;</span>
        <span class="n">rootnames</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="s2">&quot;The |rreddish|n vertical-hanging root &quot;</span><span class="p">,</span>
            <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="s2">&quot;The thick vertical root with |bblue|n flowers &quot;</span><span class="p">,</span>
            <span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="s2">&quot;The thin horizontal-hanging root with |yyellow|n flowers &quot;</span><span class="p">,</span>
            <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="s2">&quot;The weedy |ggreen|n horizontal root &quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">vpos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;hangs far to the |wleft|n on the wall.&quot;</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;hangs straight down the |wmiddle|n of the wall.&quot;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;hangs far to the |wright|n of the wall.&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">hpos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;covers the |wupper|n part of the wall.&quot;</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;passes right over the |wmiddle|n of the wall.&quot;</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;nearly touches the floor, near the |wbottom|n of the wall.&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">root</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">rootnames</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">+</span> <span class="n">hpos</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">rootnames</span><span class="p">[</span><span class="n">root</span><span class="p">]</span> <span class="o">+</span> <span class="n">vpos</span><span class="p">[</span><span class="n">ipos</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">string</span>

<div class="viewcode-block" id="CrumblingWall.return_appearance"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall.return_appearance">[docs]</a>    <span class="k">def</span> <span class="nf">return_appearance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called when someone looks at the wall. We need to echo the</span>
<span class="sd">        current root positions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">button_exposed</span><span class="p">:</span>
            <span class="c1"># we found the button by moving the roots</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;Having moved all the roots aside, you find that the center of the wall, &quot;</span>
                <span class="s2">&quot;previously hidden by the vegetation, hid a curious square depression. It was maybe once &quot;</span>
                <span class="s2">&quot;concealed and made to look a part of the wall, but with the crumbling of stone around it, &quot;</span>
                <span class="s2">&quot;it&#39;s now easily identifiable as some sort of button.&quot;</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">exit_open</span><span class="p">:</span>
            <span class="c1"># we pressed the button; the exit is open</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;With the button pressed, a crack has opened in the root-covered wall, just wide enough &quot;</span>
                <span class="s2">&quot;to squeeze through. A cold draft is coming from the hole and you get the feeling the &quot;</span>
                <span class="s2">&quot;opening may close again soon.&quot;</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># puzzle not solved yet.</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;The wall is old and covered with roots that here and there have permeated the stone. &quot;</span>
                <span class="s2">&quot;The roots (or whatever they are - some of them are covered in small nondescript flowers) &quot;</span>
                <span class="s2">&quot;crisscross the wall, making it hard to clearly see its stony surface. Maybe you could &quot;</span>
                <span class="s2">&quot;try to |wshift|n or |wmove|n them (like &#39;|wshift red up|n&#39;).</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">]</span>
            <span class="c1"># display the root positions to help with the puzzle</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">root_pos</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate_position</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">pos</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">desc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># call the parent to continue execution (will use the desc we just set)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">return_appearance</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span></div>

<div class="viewcode-block" id="CrumblingWall.at_after_traverse"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall.at_after_traverse">[docs]</a>    <span class="k">def</span> <span class="nf">at_after_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traverser</span><span class="p">,</span> <span class="n">source_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is called after we traversed this exit. Cleans up and resets</span>
<span class="sd">        the puzzle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="n">traverser</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">crumbling_wall_found_buttothe</span>
        <span class="k">del</span> <span class="n">traverser</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">crumbling_wall_found_exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span></div>

<div class="viewcode-block" id="CrumblingWall.at_failed_traverse"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall.at_failed_traverse">[docs]</a>    <span class="k">def</span> <span class="nf">at_failed_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traverser</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is called if the account fails to pass the Exit.&quot;&quot;&quot;</span>
        <span class="n">traverser</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;No matter how you try, you cannot force yourself through </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="CrumblingWall.reset"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CrumblingWall.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by tutorial world runner, or whenever someone successfully</span>
<span class="sd">        traversed the Exit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
            <span class="s2">&quot;The secret door closes abruptly, roots falling back into place.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># reset the flags and remove the exit destination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">button_exposed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">exit_open</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destination</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Reset the roots with some random starting positions for the roots:</span>
        <span class="n">start_pos</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;yellow&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">root_pos</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">start_pos</span><span class="p">)</span></div></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># TutorialWeapon - object type</span>
<span class="c1">#</span>
<span class="c1"># A weapon is necessary in order to fight in the tutorial</span>
<span class="c1"># world. A weapon (which here is assumed to be a bladed</span>
<span class="c1"># melee weapon for close combat) has three commands,</span>
<span class="c1"># stab, slash and defend. Weapons also have a property &quot;magic&quot;</span>
<span class="c1"># to determine if they are usable against certain enemies.</span>
<span class="c1">#</span>
<span class="c1"># Since Characters don&#39;t have special skills in the tutorial,</span>
<span class="c1"># we let the weapon itself determine how easy/hard it is</span>
<span class="c1"># to hit with it, and how much damage it can do.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>


<div class="viewcode-block" id="CmdAttack"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdAttack">[docs]</a><span class="k">class</span> <span class="nc">CmdAttack</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attack the enemy. Commands:</span>

<span class="sd">      stab &lt;enemy&gt;</span>
<span class="sd">      slash &lt;enemy&gt;</span>
<span class="sd">      parry</span>

<span class="sd">    stab - (thrust) makes a lot of damage but is harder to hit with.</span>
<span class="sd">    slash - is easier to land, but does not make as much damage.</span>
<span class="sd">    parry - forgoes your attack but will make you harder to hit on next</span>
<span class="sd">            enemy attack.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># this is an example of implementing many commands as a single</span>
    <span class="c1"># command class, using the given command alias to separate between them.</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;attack&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">,</span>
        <span class="s2">&quot;kill&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fight&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thrust&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pierce&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stab&quot;</span><span class="p">,</span>
        <span class="s2">&quot;slash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;chop&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bash&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">,</span>
        <span class="s2">&quot;defend&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdAttack.func"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdAttack.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Implements the stab&quot;&quot;&quot;</span>

        <span class="n">cmdstring</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmdstring</span>

        <span class="k">if</span> <span class="n">cmdstring</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;attack&quot;</span><span class="p">,</span> <span class="s2">&quot;fight&quot;</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;How do you want to fight? Choose one of &#39;stab&#39;, &#39;slash&#39; or &#39;defend&#39;.&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># parry mode</span>
        <span class="k">if</span> <span class="n">cmdstring</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;parry&quot;</span><span class="p">,</span> <span class="s2">&quot;defend&quot;</span><span class="p">):</span>
            <span class="n">string</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;You raise your weapon in a defensive pose, ready to block the next enemy attack.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">combat_parry_mode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> takes a defensive stance&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;Who do you attack?&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">target</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">cmdstring</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;thrust&quot;</span><span class="p">,</span> <span class="s2">&quot;pierce&quot;</span><span class="p">,</span> <span class="s2">&quot;stab&quot;</span><span class="p">):</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hit</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.7</span>  <span class="c1"># modified due to stab</span>
            <span class="n">damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">damage</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># modified due to stab</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;You stab with </span><span class="si">%s</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span>
            <span class="n">tstring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> stabs at you with </span><span class="si">%s</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="n">ostring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> stabs at </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%s</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">combat_parry_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="n">cmdstring</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;slash&quot;</span><span class="p">,</span> <span class="s2">&quot;chop&quot;</span><span class="p">,</span> <span class="s2">&quot;bash&quot;</span><span class="p">):</span>
            <span class="n">hit</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hit</span><span class="p">)</span>  <span class="c1"># un modified due to slash</span>
            <span class="n">damage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">damage</span>  <span class="c1"># un modified due to slash</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;You slash with </span><span class="si">%s</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span>
            <span class="n">tstring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> slash at you with </span><span class="si">%s</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="n">ostring</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> slash at </span><span class="si">%s</span><span class="s2"> with </span><span class="si">%s</span><span class="s2">. &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">combat_parry_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span>
                <span class="s2">&quot;You fumble with your weapon, unsure of whether to stab, slash or parry ...&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> fumbles with their weapon.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">combat_parry_mode</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">combat_parry_mode</span><span class="p">:</span>
            <span class="c1"># target is defensive; even harder to hit!</span>
            <span class="n">target</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;|GYou defend, trying to avoid the attack.|n&quot;</span><span class="p">)</span>
            <span class="n">hit</span> <span class="o">*=</span> <span class="mf">0.5</span>

        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">hit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="s2">&quot;|gIt&#39;s a hit!|n&quot;</span><span class="p">)</span>
            <span class="n">target</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">tstring</span> <span class="o">+</span> <span class="s2">&quot;|rIt&#39;s a hit!|n&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                <span class="n">ostring</span> <span class="o">+</span> <span class="s2">&quot;It&#39;s a hit!&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># call enemy hook</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="s2">&quot;at_hit&quot;</span><span class="p">):</span>
                <span class="c1"># should return True if target is defeated, False otherwise.</span>
                <span class="n">target</span><span class="o">.</span><span class="n">at_hit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">,</span> <span class="n">damage</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="n">target</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span><span class="p">:</span>
                <span class="n">target</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">health</span> <span class="o">-=</span> <span class="n">damage</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># sorry, impossible to fight this enemy ...</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s2">&quot;The enemy seems unaffected.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="s2">&quot;|rYou miss.|n&quot;</span><span class="p">)</span>
            <span class="n">target</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">tstring</span> <span class="o">+</span> <span class="s2">&quot;|gThey miss you.|n&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span><span class="n">ostring</span> <span class="o">+</span> <span class="s2">&quot;They miss.&quot;</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">])</span></div></div>


<div class="viewcode-block" id="CmdSetWeapon"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetWeapon">[docs]</a><span class="k">class</span> <span class="nc">CmdSetWeapon</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Holds the attack command.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="CmdSetWeapon.at_cmdset_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetWeapon.at_cmdset_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;called at first object creation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdAttack</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="TutorialWeapon"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialWeapon">[docs]</a><span class="k">class</span> <span class="nc">TutorialWeapon</span><span class="p">(</span><span class="n">TutorialObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This defines a bladed weapon.</span>

<span class="sd">    Important attributes (set at creation):</span>
<span class="sd">      hit - chance to hit (0-1)</span>
<span class="sd">      parry - chance to parry (0-1)</span>
<span class="sd">      damage - base damage given (modified by hit success and</span>
<span class="sd">               type of attack) (0-10)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TutorialWeapon.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialWeapon.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called at first creation of the object&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">hit</span> <span class="o">=</span> <span class="mf">0.4</span>  <span class="c1"># hit chance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">parry</span> <span class="o">=</span> <span class="mf">0.8</span>  <span class="c1"># parry chance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">damage</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">magic</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="n">CmdSetWeapon</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TutorialWeapon.reset"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialWeapon.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        When reset, the weapon is simply deleted, unless it has a place</span>
<span class="sd">        to return to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">has_account</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg_contents</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> suddenly and magically fades into nothingness, as if it was never there ...&quot;</span>
                <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span></div></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># Weapon rack - spawns weapons</span>
<span class="c1">#</span>
<span class="c1"># This is a spawner mechanism that creates custom weapons from a</span>
<span class="c1"># spawner prototype dictionary. Note that we only create a single typeclass</span>
<span class="c1"># (Weapon) yet customize all these different weapons using the spawner.</span>
<span class="c1"># The spawner dictionaries could easily sit in separate modules and be</span>
<span class="c1"># used to create unique and interesting variations of typeclassed</span>
<span class="c1"># objects.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>

<span class="n">WEAPON_PROTOTYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;weapon&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;typeclass&quot;</span><span class="p">:</span> <span class="s2">&quot;evennia.contrib.tutorial_world.objects.TutorialWeapon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Weapon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
        <span class="s2">&quot;magic&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A generic blade.&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;knife&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;weapon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="s2">&quot;sword&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Kitchen knife&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A rusty kitchen knife. Better than nothing.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;dagger&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;knife&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rusty dagger&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;knife&quot;</span><span class="p">,</span> <span class="s2">&quot;dagger&quot;</span><span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A double-edged dagger with a nicked edge and a wooden handle.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;sword&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;weapon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Rusty sword&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sword&quot;</span><span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A rusty shortsword. It has a leather-wrapped handle covered i food grease.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;club&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;weapon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Club&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A heavy wooden club, little more than a heavy branch.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;axe&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;weapon&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Axe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A woodcutter&#39;s axe with a keen edge.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;ornate longsword&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;sword&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Ornate longsword&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A fine longsword with some swirling patterns on the handle.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;magic&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;warhammer&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;club&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Silver Warhammer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hammer&quot;</span><span class="p">,</span> <span class="s2">&quot;warhammer&quot;</span><span class="p">,</span> <span class="s2">&quot;war&quot;</span><span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A heavy war hammer with silver ornaments. This huge weapon causes massive damage - if you can hit.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s2">&quot;magic&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;rune axe&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;axe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Runeaxe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;axe&quot;</span><span class="p">],</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s2">&quot;magic&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;thruning&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;ornate longsword&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Broadsword named Thruning&quot;</span><span class="p">,</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;This heavy bladed weapon is marked with the name &#39;Thruning&#39;. It is very powerful in skilled hands.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;slayer waraxe&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;rune axe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;Slayer waraxe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;waraxe&quot;</span><span class="p">,</span> <span class="s2">&quot;war&quot;</span><span class="p">,</span> <span class="s2">&quot;slayer&quot;</span><span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;A huge double-bladed axe marked with the runes for &#39;Slayer&#39;.&quot;</span>
        <span class="s2">&quot; It has more runic inscriptions on its head, which you cannot decipher.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;ghostblade&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;ornate longsword&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;The Ghostblade&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;blade&quot;</span><span class="p">,</span> <span class="s2">&quot;ghost&quot;</span><span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;This massive sword is large as you are tall, yet seems to weigh almost nothing.&quot;</span>
        <span class="s2">&quot; It&#39;s almost like it&#39;s not really there.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;hawkblade&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;prototype_parent&quot;</span><span class="p">:</span> <span class="s2">&quot;ghostblade&quot;</span><span class="p">,</span>
        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;The Hawkblade&quot;</span><span class="p">,</span>
        <span class="s2">&quot;aliases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hawk&quot;</span><span class="p">,</span> <span class="s2">&quot;blade&quot;</span><span class="p">],</span>
        <span class="s2">&quot;desc&quot;</span><span class="p">:</span> <span class="s2">&quot;The weapon of a long-dead heroine and a more civilized age,&quot;</span>
        <span class="s2">&quot; the hawk-shaped hilt of this blade almost has a life of its own.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hit&quot;</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
        <span class="s2">&quot;parry&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
        <span class="s2">&quot;damage&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>


<div class="viewcode-block" id="CmdGetWeapon"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdGetWeapon">[docs]</a><span class="k">class</span> <span class="nc">CmdGetWeapon</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Usage:</span>
<span class="sd">      get weapon</span>

<span class="sd">    This will try to obtain a weapon from the container.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;get weapon&quot;</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="s2">&quot;get weapon&quot;</span>
    <span class="n">locks</span> <span class="o">=</span> <span class="s2">&quot;cmd:all()&quot;</span>
    <span class="n">help_category</span> <span class="o">=</span> <span class="s2">&quot;TutorialWorld&quot;</span>

<div class="viewcode-block" id="CmdGetWeapon.func"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdGetWeapon.func">[docs]</a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a weapon from the container. It will</span>
<span class="sd">        itself handle all messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="o">.</span><span class="n">produce_weapon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">caller</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="CmdSetWeaponRack"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetWeaponRack">[docs]</a><span class="k">class</span> <span class="nc">CmdSetWeaponRack</span><span class="p">(</span><span class="n">CmdSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The cmdset for the rack.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;weaponrack_cmdset&quot;</span>

<div class="viewcode-block" id="CmdSetWeaponRack.at_cmdset_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.CmdSetWeaponRack.at_cmdset_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_cmdset_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called at first creation of cmdset&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">CmdGetWeapon</span><span class="p">())</span></div></div>


<div class="viewcode-block" id="TutorialWeaponRack"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialWeaponRack">[docs]</a><span class="k">class</span> <span class="nc">TutorialWeaponRack</span><span class="p">(</span><span class="n">TutorialObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object represents a weapon store. When people use the</span>
<span class="sd">    &quot;get weapon&quot; command on this rack, it will produce one</span>
<span class="sd">    random weapon from among those registered to exist</span>
<span class="sd">    on it. This will also set a property on the character</span>
<span class="sd">    to make sure they can&#39;t get more than one at a time.</span>

<span class="sd">    Attributes to set on this object:</span>
<span class="sd">        available_weapons: list of prototype-keys from</span>
<span class="sd">            WEAPON_PROTOTYPES, the weapons available in this rack.</span>
<span class="sd">        no_more_weapons_msg - error message to return to accounts</span>
<span class="sd">            who already got one weapon from the rack and tries to</span>
<span class="sd">            grab another one.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TutorialWeaponRack.at_object_creation"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialWeaponRack.at_object_creation">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        called at creation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmdset</span><span class="o">.</span><span class="n">add_default</span><span class="p">(</span><span class="n">CmdSetWeaponRack</span><span class="p">,</span> <span class="n">persistent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">rack_id</span> <span class="o">=</span> <span class="s2">&quot;weaponrack_1&quot;</span>
        <span class="c1"># these are prototype names from the prototype</span>
        <span class="c1"># dictionary above.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_weapon_msg</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            You find |c%s|n. While carrying this weapon, these actions are available:</span>
<span class="sd">              |wstab/thrust/pierce &lt;target&gt;|n - poke at the enemy. More damage but harder to hit.</span>
<span class="sd">              |wslash/chop/bash &lt;target&gt;|n - swipe at the enemy. Less damage but easier to hit.</span>
<span class="sd">              |wdefend/parry|n - protect yourself and make yourself harder to hit.)</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">no_more_weapons_msg</span> <span class="o">=</span> <span class="s2">&quot;you find nothing else of use.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">available_weapons</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;knife&quot;</span><span class="p">,</span> <span class="s2">&quot;dagger&quot;</span><span class="p">,</span> <span class="s2">&quot;sword&quot;</span><span class="p">,</span> <span class="s2">&quot;club&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="TutorialWeaponRack.produce_weapon"><a class="viewcode-back" href="../../../../api/evennia.contrib.tutorial_world.objects.html#evennia.contrib.tutorial_world.objects.TutorialWeaponRack.produce_weapon">[docs]</a>    <span class="k">def</span> <span class="nf">produce_weapon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caller</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This will produce a new weapon from the rack,</span>
<span class="sd">        assuming the caller hasn&#39;t already gotten one. When</span>
<span class="sd">        doing so, the caller will get Tagged with the id</span>
<span class="sd">        of this rack, to make sure they cannot keep</span>
<span class="sd">        pulling weapons from it indefinitely.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rack_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">rack_id</span>
        <span class="k">if</span> <span class="n">caller</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rack_id</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;tutorial_world&quot;</span><span class="p">):</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">no_more_weapons_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prototype</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">available_weapons</span><span class="p">)</span>
            <span class="c1"># use the spawner to create a new Weapon from the</span>
            <span class="c1"># spawner dictionary, tag the caller</span>
            <span class="n">wpn</span> <span class="o">=</span> <span class="n">spawn</span><span class="p">(</span><span class="n">WEAPON_PROTOTYPES</span><span class="p">[</span><span class="n">prototype</span><span class="p">],</span> <span class="n">prototype_parents</span><span class="o">=</span><span class="n">WEAPON_PROTOTYPES</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">rack_id</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s2">&quot;tutorial_world&quot;</span><span class="p">)</span>
            <span class="n">wpn</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">caller</span>
            <span class="n">caller</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_weapon_msg</span> <span class="o">%</span> <span class="n">wpn</span><span class="o">.</span><span class="n">key</span><span class="p">)</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/evennia_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com">Home page</a> </li>
  <li><a href="https://github.com/evennia/evennia">Evennia Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Blog</a>
  </li>
</ul>
<h3>Versions</h3>
<ul>
  <li><a href="../../../../../1.0-dev/index.html">1.0-dev (develop branch)</a></li>
  <li><a href="objects.html">0.9.5 (v0.9.5 branch)</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">Evennia 0.9.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../evennia.html" >evennia</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">evennia.contrib.tutorial_world.objects</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>